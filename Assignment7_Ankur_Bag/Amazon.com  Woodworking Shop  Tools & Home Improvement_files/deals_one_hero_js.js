if(!window.Deal){(function(){window.Deal={};Deal.availableStr="Available";Deal.inCartStr="InCart";Deal.claimedStr="Claimed";Deal.expiredStr="Expired";Deal.waitInLineStr="WaitInLine";Deal.pendingAtcStr="PendingAddToCart";Deal.stateAlertsEnum={ATC_EXPIRES_SOON:0,ATC_EXPIRED:1,WL_PATC:2,WL_PATC_EXPIRED:3,WL_SOLD_OUT:4,WL_DEAL_ENDED:5};Deal.pStateTypeEnum={CART:0,WAITLIST:1,EITHER:2,NO_ACTION:3};Deal.primeAccessTypeEnum={PRIME_EARLY_ACCESS:"PRIME_EARLY_ACCESS",PRIME_ONLY_LD:"PRIME_ONLY_LD",PRIME_ONLY_DOTD:"PRIME_ONLY_DOTD"};Deal.roundedReviewStarsEnum={LOW:0.3,HIGH:0.7};Deal.pStateTypeMap={};Deal.pStateTypeMap[Deal.availableStr]=Deal.pStateTypeEnum.NO_ACTION;Deal.pStateTypeMap[Deal.inCartStr]=Deal.pStateTypeEnum.CART;Deal.pStateTypeMap[Deal.claimedStr]=Deal.pStateTypeEnum.NO_ACTION;Deal.pStateTypeMap[Deal.expiredStr]=Deal.pStateTypeEnum.EITHER;Deal.pStateTypeMap[Deal.waitInLineStr]=Deal.pStateTypeEnum.WAITLIST;Deal.pStateTypeMap[Deal.pendingAtcStr]=Deal.pStateTypeEnum.WAITLIST;Deal.formatDealTime=function(h,e){var b=gbResources.getFeature("gbZoneInfo");var d=h.valueOf();if(!e){d+=h.getTimezoneOffset()*60*1000+b.offset}var f=new Date(d);var g=f.getMinutes()%5;if(g===1){d-=60*1000}else{if(g===4){d+=60*1000}}if(g===1||g===4){f=new Date(d)}var a=f.getHours();var c=f.getMinutes();return Deal.formatTime(a,c,e)};Deal.formatTime=function(c,e,d){if(e<10){e="0"+e}var a=gbResources.getCustomerData("realm");var b=gbResources.getFeature("gbZoneInfo");var h="";if(b&&!d){h=b.name}var g=c>=12?gbResources.getString("csld-pm"):gbResources.getString("csld-am");if(a=="US"||a=="UK"||a=="JP"||a=="IN"){c=c%12||12}else{if(c<10&&(a=="DE"||a=="FR")){c="0"+c}}var f=gbResources.getString("csld-start_time",{hours:c,minutes:e,period:g,timezone:h});f=jQuery.trim(f);return f};Deal.formatDate=function(c){var a=gbResources.getString("gb_month_"+c.getMonth());var b=c.getDate();if(b<10){b="0"+b}return gbResources.getString("gb_date_format",{month:a,day:b,date_suffix:gbResources.getString("gb_date")})};Deal.appendUrlParameter=function(b,d,c){var a="?";if(b.indexOf("?")!=-1){a="&"}return b+a+d+"="+c}})()};
Deal.constants={WIDGET_ID_START:100,GET_DEALS_MAX_JITTER:2};Deal.rankingStrategies={PERSONALIZED:"PERSONALIZED",CLAIMED_RATE:"CLAIMED_RATE"};Deal.statusFilters={AVAILABLE:"available",UPCOMING:"upcoming",MISSED:"missed"};Deal.availableStr="Available";Deal.inCartStr="InCart";Deal.claimedStr="Claimed";Deal.expiredStr="Expired";Deal.waitInLineStr="WaitInLine";Deal.waitlistFullStr="WaitlistFull";Deal.pendingAtcStr="PendingAddToCart";Deal.dealTypes={BD:"BEST_DEAL",LD:"LIGHTNING_DEAL",DOTD:"DEAL_OF_THE_DAY",LOCAL:"LOCAL_DEAL",COUPON:"COUPON_DEAL"};Deal.savingsBasisKind={LIST_PRICE:"LP",OUR_PRICE:"OP",PREV_PUBLISHED_PRICE:"PPP",UVP_LIST_PRICE:"ULP",ORIGINAL_EDITION_PRICE:"OEP",RETAIL_PREV_PRICE:"REP",SEPARATE_PURCHASE_LIST_PRICE:"SPLP",DIGITAL_LIST_PRICE:"DLP",PRINT_LIST_PRICE:"PLP",UNRECOGNIZED:"UNR"};Deal.categoryFilters={ALL:"all"};Deal.dealStateEnum={Available:1,Variation:2,WaitListed:3,WaitListFull:4,WaitListOnly:5,Claimed:6,InCart:7,PendingAddToCart:8,LearnMore:9,ClipCoupon:10,ViewDeal:11,Upcoming:12,SoldOut:13,Expired:14,InvalidPurchaseState:-1};Deal.itemTypes={SingleItem:"SINGLE_ITEM",MultiItem:"MULTI_ITEM",ContentOnly:"CONTENT_ONLY"};Deal.itemStates={Available:"AVAILABLE",Soldout:"SOLDOUT",Expired:"EXPIRED",Upcoming:"UPCOMING",Waitlist:"WAITLISTAVAILABLE",WaitlistFull:"WAITLISTFULL",Suppressed:"SUPPRESSED"};Deal.responseItemTypeToItemType={NONE:"CONTENT_ONLY",SINGLE_ITEM:"SINGLE_ITEM",MULTI_ITEM:"MULTI_ITEM",VARIATION_ITEM:"MULTI_ITEM"};Deal.clientActions={ADD_TO_CART:"A",JOIN_WAITLIST:"J",LEARN_MORE:"L",TITLE:"T",IMAGE:"P",REVIEWS:"R",DISCUSSION_BOARD:"D",IMPRESSION:"I"};Deal.purchaseTypes={ADD_TO_CART:"add_to_cart",JOIN_WAITLIST:"join_waitlist"};Deal.stateBasedSubTemplates={available:["image","price_block","title","checking_deal_status","prime","progress_bar","percent_claimed","prime_early_access","time_remaining","prime_only_access","claimed","reviews","state","variation_status_message","button","description","total_coupons_count","share_bar","geo_display_location","merchant_name","deal_action_content","deal_status_content","badge","fast_track"],expired:["image","price_block","title","prime","progress_bar","percent_claimed","claimed","reviews","state","button","total_coupons_count","merchant_name","description","geo_display_location","deal_action_content","deal_status_content","badge"],soldout:["image","price_block","title","prime","progress_bar","percent_claimed","claimed","reviews","button","total_coupons_count","merchant_name","description","deal_action_content"],coming_soon:["image","title","merchant_name","share_bar","reviews","prime","description","badge"],upcoming:["image","teaser","starts_in","description","early_access_message","prime_only_message"],loading:["checking_deal_status","available"],empty:[]};Deal.stateToTemplateMap={Available:"available",SoldOut:"soldout",Expired:"expired",Upcoming:"upcoming",Loading:"loading",ComingSoon:"coming_soon",Waitlist:"available",WaitlistFull:"available"};Deal.dealStates={AVAILABLE:"Available",SOLDOUT:"SoldOut",EXPIRED:"Expired",UPCOMING:"Upcoming",WAITLIST:"Waitlist",WAITLISTAVAILABLE:"Waitlist",WAITLISTFULL:"WaitlistFull"};Deal.customerStates={NONE:Deal.availableStr,INCART:Deal.inCartStr,CLAIMED:Deal.claimedStr,INWAITLIST:Deal.waitInLineStr,PENDINGATC:Deal.pendingAtcStr,EXPIRED:Deal.expiredStr};Deal.itemStateToPurchaseStateMap={AVAILABLE:Deal.dealStateEnum.Available,WAITLIST:Deal.dealStateEnum.WaitListOnly,WAITLISTED:Deal.dealStateEnum.WaitListed,WAITLISTFULL:Deal.dealStateEnum.WaitListFull,WAITLISTONLY:Deal.dealStateEnum.WaitListOnly,WAITLISTAVAILABLE:Deal.dealStateEnum.WaitListOnly,UPCOMING:Deal.dealStateEnum.Upcoming,SOLDOUT:Deal.dealStateEnum.SoldOut,EXPIRED:Deal.dealStateEnum.Expired};Deal.customerStateToPurchaseStateMap={AVAILABLE:Deal.dealStateEnum.Available,CLAIMED:Deal.dealStateEnum.Claimed,INCART:Deal.dealStateEnum.InCart,PENDINGADDTOCART:Deal.dealStateEnum.PendingAddToCart,PENDINGATC:Deal.dealStateEnum.PendingAddToCart,INWAITLIST:Deal.dealStateEnum.WaitListed,EXPIRED:Deal.dealStateEnum.Expired};Deal.apiName={GET_DEAL_METADATA:"GetDealMetadata",GET_DEALS:"GetDeals",GET_DEAL_STATUS:"GetDealStatus",REDEEM_DEAL:"RedeemDeal",CLAIM_DEAL:"ClaimDeal"};Deal.Class=function(c,b){if(b!==undefined){for(var a in b){c[a]=b[a]}}var d=(c&&c.__init__)||function(){};d.prototype=c;return d};Deal.log=function(a){if(window.gbResources===undefined||window.gbResources===null||!window.gbResources.getDealDebug()){return}a=new Date()+": "+a;if(window.console){window.console.log(a)}else{jQuery("#DealsLog").append(jQuery("div").append(a))}};Deal.parseBool=function(a){return a===true||a===1||a==="1"};Deal.areNestedKeysPresent=function(c,b){if(!_.isObject(c)||!_.isString(b)){return false}b=b.split(".");for(var a=0;a<b.length;a++){if(!c||!c.hasOwnProperty(b[a])){return false}c=c[b[a]]}return true};Deal.checkIfDealExpired=function(a){if(a===undefined||a===null){return false}if(a.status!==undefined&&a.status!==null&&(a.status.msToEnd!==undefined&&a.status.msToEnd!==null&&a.status.msToEnd<=0)||(a.status.ended!==undefined&&a.status.ended!==null&&a.status.ended)||(a.status.endDate!==undefined&&a.status.endDate!==null&&a.status.endDate<new Date())){return true}return false};Deal.sortByAsinTimes=function(e,d){var c=e.status.purchaseStatus.expiresDate;var f=d.status.purchaseStatus.expiresDate;return c-f};Deal.sortByDealAsinDAOTimes=function(e,d){var c=e.status.expiresDate;var f=d.status.expiresDate;return c-f};Deal.setSafeTimeout=function(a,b){if(a===undefined||a===null||b===undefined||b===null){Deal.log("Cannot setTimeout on undefined/null fn/timeout.");return null}var c;if(b>2147483647){c=window.setTimeout(a,1073741823)}else{c=window.setTimeout(a,10)}return c};Deal.objectsIdentical=function(b,a){if(b===undefined||a===undefined){Deal.log("Cannot check for objectsIdentical for undefined requestArgs.");return false}return _.isEqual(b,a)};Deal.keys=function(a){return _.isObject(a)?_.keys(a):[]};Deal.filterAsinsByState=function(a,b){var c=[];_.each(a,function(d){_.each(b,function(e){if(d.status.purchaseStatus.state===e){c.push(d)}})});return c};Deal.filterAsinsHashByState=function(a,b){var c=[];_.each(a,function(d){_.each(b,function(e){if(d.status.state===e){c.push(d)}})});return c};Deal.filterDealIdsByParams=function(c,e){var b=[];if(c===null||c===undefined){return b}if(e===null||e===undefined){return b}for(var a=0;a<c.length;a++){var d=c[a];if(d in e){b=_.union(b,e[d])}}return b};Deal.trimSortedDealIDs=function(e,a,b,g){var c=Deal.filterDealIdsByParams(b,g);var f=e;if(a.length>0){var d=Deal.filterDealIdsByParams(a,g);f=_.difference(e,_.difference(e,d))}f=_.difference(f,c);return f};Deal.getPaginationCellPositions=function(e,d,f,a){var c=[];if(e&&d&&f){var b=1;if(!a){b=Math.ceil(f/d)}if(b<=3){c=_.range(0,(f<b*d)?f:b*d)}else{if(e==1){c=_.union(_.range(0,d*2),_.range((b-1)*d,f))}else{c=_.range((e-2)*d,((f<(e+1)*d)?f:((e+1)*d)))}}}return c};Deal.getCrypticPrice=function(a){if(!_.isNumber(a)){return null}return a.toString().split("").map(function(b){return String.fromCharCode(b.charCodeAt(0)+17).replace("?","X")}).join("")};Deal.logRedirectPurchaseAttributes=function(f,b,e){if(!f||!b){return}if(!e&&!f.impressionAsin){return}if(!e){e=f.impressionAsin}var d="/gp/deal/ajax/logPurchaseAttributes.html?asin="+e+"&et="+b+"&ht=redirect";if(f.parentAsin){d+="&ca="+f.parentAsin}if(Deal.areNestedKeysPresent(f,"auxiliaryData.merchantDetails.merchantID")){d+="&mt="+f.auxiliaryData.merchantDetails.merchantID}var c=null;var a=null;if(f.dealAsinsHash[e]&&f.dealAsinsHash[e].dealPrice){c=f.dealAsinsHash[e].dealPrice.price;a=f.dealAsinsHash[e].dealPrice.currency}if(c!==null&&a!==null){d+="&pr="+Deal.getCrypticPrice(c);d+="&cu="+a}jQuery.ajax({url:d,async:false})};Deal.DecryptObfuscatedResponse=function(h){if(h===null||h===undefined){Deal.log("Cannot decrypt null/undefined obfuscatedResponse");return}var j={};var e={ResponseMetadata:{bRI:"baseRetryInterval",c:"continueRequests"},DealStatus:{mID:"marketplaceID",dID:"dealID",pC:"percentClaimed",pS:"percentSoldOut",tA:"totalAvailable",cU:"currentlyUnavailable",mS:"msToStart",mE:"msToEnd",mCE:"msToCacheExpires"},DealAsinStatus:{mID:"marketplaceID",dID:"dealID",a:"asin",oSSo:"offerServiceSoldOut",pC:"percentClaimed",pS:"percentSoldOut",tA:"totalAvailable",cU:"currentlyUnavailable"},PurchaseStatus:{st:"state",mEx:"msToExpiry",lu:"lastUpdated"},WaitListStatus:{inCI:"inCartIndicator",pos:"position",ttW:"timeToWait"}};var c=function(i,o,m){var l=(i===null)?null:{};if(o===undefined||o===null){return i}for(var k in i){if(k!==m){var n=o[k];if(n===undefined){n=k}l[n]=i[k]}}return l};if(h.hasOwnProperty("RM")){j.responseMetadata=c(h.RM,e.ResponseMetadata)}if(h.hasOwnProperty("dSts")){var d=(h.dSts===null)?null:{};for(var f in h.dSts){d[f]=c(h.dSts[f],e.DealStatus)}j.dealStatus=d}if(h.hasOwnProperty("dASts")){var g=(h.dASts===null)?null:[];for(var b=0;b<h.dASts.length;b++){var a=c(h.dASts[b],e.DealAsinStatus,"pSt");if(h.dASts[b].hasOwnProperty("pSt")){a.purchaseStatus=c(h.dASts[b].pSt,e.PurchaseStatus,"wlSts");if(h.dASts[b].pSt.hasOwnProperty("wlSts")){a.purchaseStatus.waitListStatus=c(h.dASts[b].pSt.wlSts,e.WaitListStatus)}}g.push(a)}j.dealAsinStatuses=g}return j};Deal.Price={currencies:{USD:{decimals:2,format:function(a){return"$"+a}},MXN:{decimals:2,format:function(a){return"$"+a}},BRL:{decimals:2,format:function(a){return"R$ "+a}},GBP:{decimals:2,format:function(a){return"&pound;"+a}},EUR:{decimals:2,format:function(a){return(a+" &euro;").replace(".",",")}},JPY:{decimals:0,format:function(a){return"&yen; "+a}},CNY:{decimals:2,format:function(a){return"&yen;"+a}},CAD:{decimals:2,format:function(a){return("C$"+a).replace(",","")}},INR:{decimals:2,format:function(a){return"&#8377;"+a}},other:{decimals:2,format:function(a){return a+" "+a.currency}}},make_price:function(a,b){return{currency:a,price:b}},test_same_currency:function(d,c){if(d.currency!=c.currency){throw new Error("Currencies don't match: "+d.currency+" and "+c.currency)}},minus:function(d,c){if(!d||!c){return undefined}this.test_same_currency(d,c);return this.make_price(d.currency,d.price-c.price)},percent_off:function(a,d){if(!a||!d){return null}if(a.price===null||a.price===undefined){return null}if(d.price===null||d.price===undefined||d.price===0){return null}this.test_same_currency(a,d);var e=a.price-d.price;if(e<=0){return null}var c=0;var b;if(gbResources.getCustomerData("realm")=="CN"){c=1;b=(1-(e/a.price))*10}else{b=e*100/a.price}return Math.round(b*Math.pow(10,c))/Math.pow(10,c)},displayable_percent_off:function(a){if(!a||typeof(a)!=="number"){return null}if(gbResources.getCustomerData("realm")=="CN"){return((100-a)/10)}return a},format:function(b,e){if(!b){return e}var d=this.currencies[b.currency]||this.currencies.other;var a=d.format(Deal.commify(b.price,d.decimals));var c=Deal.DOM.span();c.innerHTML=a;return c.innerText||c.textContent},getEmptyPriceHash:function(){return{price:null,formattedPrice:null,currency:null}},getEmptyPriceObject:function(){return{maxBasisPrice:Deal.Price.getEmptyPriceHash(),minBasisPrice:Deal.Price.getEmptyPriceHash(),maxDealPrice:Deal.Price.getEmptyPriceHash(),minDealPrice:Deal.Price.getEmptyPriceHash()}},isEmptyPriceObject:function(b){var a=Deal.Price.getEmptyPriceObject();if(_.isEqual(b,a)){return true}return false},findMaxMinPrices:function(f,g){if(f===undefined||!f){Deal.log("Cannot findMaxMinPrices on undefined/null deal obj");return{}}if(!f.dealAsinsHash){Deal.log("Cannot operate on undefined/null dealAsinsHash");return{}}var h=null;var a=null;var e=null;var d=null;for(var b in f.dealAsinsHash){var i=f.dealAsinsHash[b];if(i.basisPrice){if(h===null){h=i.basisPrice}else{if(h.price<i.basisPrice.price){h=i.basisPrice}}if(a===null){a=i.basisPrice}else{if(a.price>i.basisPrice.price){a=i.basisPrice}}}if(i.dealPrice){if(e===null){e=i.dealPrice}else{if(e.price<i.dealPrice.price){e=i.dealPrice}}if(d===null){d=i.dealPrice}else{if(d.price>i.dealPrice.price){d=i.dealPrice}}}}if(f.dealAsins&&f.dealAsins.length===0&&g&&g.currencyCode){if(g.maxBAmount!==null&&g.maxBAmount!==undefined&&g.minBAmount!==null&&g.minBAmount!==undefined){h={price:parseFloat(g.maxBAmount),currency:g.currencyCode};a={price:parseFloat(g.minBAmount),currency:g.currencyCode}}if(g.maxDealPrice!==null&&g.maxDealPrice!==undefined&&g.minDealPrice!==null&&g.minDealPrice!==undefined){e={price:parseFloat(g.maxDealPrice),currency:g.currencyCode};d={price:parseFloat(g.minDealPrice),currency:g.currencyCode}}}var c=Deal.Price.getEmptyPriceObject();if(h!==null){c.maxBasisPrice={price:h.price,currency:h.currency,formattedPrice:Deal.Price.format(h)}}if(a!==null){c.minBasisPrice={price:a.price,currency:a.currency,formattedPrice:Deal.Price.format(a)}}if(e!==null){c.maxDealPrice={price:e.price,currency:e.currency,formattedPrice:Deal.Price.format(e)}}if(d!==null){c.minDealPrice={price:d.price,currency:d.currency,formattedPrice:Deal.Price.format(d)}}return c},hasPriceData:function(a){if(a===undefined||a===null){return false}if(a.max===undefined||a.max===null){return false}if(a.max.price===undefined||a.max.price===null){return false}if(a.min===undefined||a.min===null){return false}if(a.min.price===undefined||a.min.price===null){return false}if(a.min.price>a.max.price){return false}return true},compareTo:function(c,b){if(c===undefined||c===null||b===undefined||b===null){Deal.log("Cannot do compareTo on undefined/null prices");return 2}var d=2;try{if(c==b){d=0}else{if(c>b){d=1}else{if(c<b){d=-1}}}}catch(a){Deal.log("Error caught during attempting compareTo"+a)}return d},maxEqualMin:function(a){if(a===undefined||!a){Deal.log("Cannot check if an undefined/null object has pricedata.");return false}if(Deal.Price.compareTo(a.max.price,a.min.price)===0){return true}return false}};Deal.commify=function(b,a){b=parseFloat(b);if(a!==undefined){b=b.toFixed(a)}else{b=b.toString()}var e=b.split(".");var d=e[0];for(var c=d.length-3;c>0;c-=3){d=d.substr(0,c)+","+d.substr(c,d.length-c)}if(e.length==2){return d+"."+e[1]}else{return d}};Deal.generateRefTaggedExternalRedirectURL=function(b,d,e,a){if(b===undefined||!b){Deal.log("Cannot apend refTags for undefined/null URI");return""}var c="/gp/redirect.html";c=Deal.ref_tag_appender(c,d,e,a);b=encodeURIComponent(b);c=c+"?_encoding=UTF8&location="+b;return c};Deal.amabotParams={pf_rd_p:"placementID",pf_rd_s:"slotName",pf_rd_t:"pageType",pf_rd_i:"pageIndent",pf_rd_m:"merchantID",pf_rd_r:"requestID"};Deal.reverseMapAmabotParams={placementID:"pf_rd_p",slotName:"pf_rd_s",pageType:"pf_rd_t",pageIndent:"pf_rd_i",merchantID:"pf_rd_m",requestID:"pf_rd_r"};Deal.stripRecordClickParams=function(c){if(!c){Deal.log("Cannot strip recordclickparams from undefined/null domid.");return}var b=jQuery("#"+c);if(b.length==0){Deal.log("No amabot link with request args to strip from.");return{}}var f=b.html();f=f.split("?");if(f.length<=1){Deal.log("No amabot args in url.");return{}}f=f[1].split("&amp;");var e;var d={};for(var a=0;a<f.length;a++){e=f[a].split("=");if(e.length<=1){continue}if(!Deal.amabotParams[e[0]]){continue}d[Deal.amabotParams[e[0]]]=jQuery.trim(e[1])}return d};Deal.addAmabotRecordClickParameters=function(b,c){if(!b||!c){Deal.log("Cannot add amabot record click params for undefined/null uri/params.");return b}var a=Deal.reverseMapAmabotParams;if(c.merchantID){b=Deal.param_appender(b,a.merchantID+"="+c.merchantID)}if(c.pageType){b=Deal.param_appender(b,a.pageType+"="+c.pageType)}if(c.slotName){b=Deal.param_appender(b,a.slotName+"="+c.slotName)}if(c.requestID){b=Deal.param_appender(b,a.requestID+"="+c.requestID)}if(c.pageIndent){b=Deal.param_appender(b,a.pageIndent+"="+c.pageIndent)}if(c.placementID){b=Deal.param_appender(b,a.placementID+"="+c.placementID)}return b};Deal.ref_tag_appender=function(d,g,h,a){if(d===undefined||!d){Deal.log("Cannot apend refTags for undefined/null URI");return""}if(g===undefined||g===null){Deal.log("Cannot apend refTags for undefined/null refTag");return d}var c="xs_gb_";var e=Deal.getSlotRefTag(a);var b=Deal.getPlacementID(a);if(h!==undefined&&h){g=h+e+b+g}else{g=c+e+b+g}var f=Deal.addRefTag(d,g);if(a){f=Deal.addAmabotRecordClickParameters(f,a)}return f};Deal.getSlotRefTag=function(a){if(!a){Deal.log("Cannot get slot ref tag for undefined/null amabotParams.");return""}if(a.slotName===undefined||a.slotName===null){Deal.log("Cannot get slot ref tag for undefined/null slotName.");return""}var b=a.slotName;if(b.length<4){return b+"_"}var c=b.substring(0,1)+b.substring(b.length-2,b.length)+"_";return c};Deal.getPlacementID=function(a){if(!a){Deal.log("Cannot get placement id for undefined/null amabotParams.");return""}if(a.placementID===undefined||a.placementID===null){Deal.log("Cannot get placement id for undefined/null slotName.");return""}var b=a.placementID;if(b.length<5){return b+"_"}return b.substring(b.length-4,b.length)+"_"};Deal.addRefTag=function(c,h){var i=c;var j=/^(.*)\?(.*)$/;var g=/^(.*)#(.*)$/;var e=/^(.*)\/$/;var b=/^(.*)$/;var l;var a="ref="+h;if(j.test(c)){var d=/.*\/\?/;var f="/";if(d.test(c)){f=""}i=c.replace(j,"$1"+f+a+"?$2")}else{if(g.test(c)){var f="/";var k=/.*\/#/;if(k.test(c)){f=""}i=c.replace(g,"$1"+f+a+"#$2")}else{if(e.test(c)){i=c.replace(e,"$1/"+a)}else{i=c.replace(b,"$1/"+a)}}}return i};Deal.param_appender=function(a,c){if(!a||!c){Deal.log("Cannot apend refTags for undefined/null URI/refTag");return""}var b="?";if(a.match(/\?/)){if(a.charAt(a.length-1)==="?"){b=""}else{b="&"}}return a+b+c};Deal.getWidgetCDSRef=function(c){var a=Deal.controller.getAmabotParams(c);var d=Deal.controller.widgetIdToWidgetNameMap[c];var b=Deal.configManager[d].widgetViewConfig;var e=b.clickStreamRefMarker;if(!_.isEmpty(a)){e+="_";e+=Deal.getSlotRefTag(a);e+=Deal.getPlacementID(a)}return e};Deal.shouldRecordClickAction=function(b){if(b===null||b===undefined){return false}var a=Deal.controller.getDeal(b).impressionAsin;if(a){return true}return false};Deal.truncate_description=function(b,a){if(!b||!a){Deal.log("Cannot truncate undefined string / to undefined length");return""}var f=b;var c=b;if(f.length>a){var e=f.substr(0,a);var d=e.split(" ");if(d.length>1){d[d.length-1]="";c=d.join(" ")}else{c=f.substr(0,a-3)}c+="..."}else{c=f}return c};Deal.resizeImage=function(a,b,c){var e={jpg:true,jpeg:true,png:true,gif:true,tif:true};var d=a.substring(a.lastIndexOf(".")+1);if(!(d.toLowerCase() in e)){Deal.log("Fudging invalid Image URL "+a);a=gbResources.getImage("hero_upcoming")}c=c||"AA";a=a.replace(/\.((_.*_)\.)?(\w+)$/,".$2_"+c+b+"_.$3");return a};Deal.checkAndSetSSLImageUrl=function(c){if(c===null){return c}if(window.location.protocol==="https:"){var b="images-na.ssl-images-amazon.com";var a=gbResources.getCustomerData("realm");if(a==="CN"){b="images-cn.ssl-images-amazon.com"}var d=document.createElement("a");d.href=c;d.protocol="https:";d.hostname=b;c=d.href}return c};Deal.findBackBoneDealAsin=function(a,c){if(!a||!a.dealAsinsHash){return null}var b=_.find(a.dealAsinsHash,function(d){return !c||d.ASIN===c});return b||null};Deal.generateDetailPageUrl=function(h){var g=null;var c=true;if(h.detail.URL){g=h.detail.URL;var i=(g.split("?")[1])?("&"+g.split("?")[1]):null;var f=["smid","m","me"];if(i){for(var d in f){var b=f[d];if(i.indexOf("&"+b+"=")>=0){c=false;break}}}}else{if(Deal.keys(h.dealAsinsHash).length==1||h.itemType==Deal.itemTypes.SingleItem){var j=Deal.findBackBoneDealAsin(h);var e=null;if(j){e=j.ASIN}else{if(h.buyAsin){e=h.buyAsin}}if(e){g="/gp/product/"+e}}else{if((Deal.keys(h.dealAsinsHash).length>1||h.itemType===Deal.itemTypes.MultiItem)&&h.parentAsin){g="/gp/product/"+h.parentAsin}}}if(!g){Deal.log("Fudging title href");return"/gp/goldbox"}if(c){var a=null;if(h.auxiliaryData.merchantDetails){a=h.auxiliaryData.merchantDetails.merchantID}if(a){g=Deal.appendUrlParameter(g,"smid",a)}}return g};Deal.PurchaseStatusGatherer=Deal.Class({__init__:function(b){var a=this;if(!b){return}a.deal=b;a.now=new Date();a.timeSensitiveStates={};a.timeSensitiveStates[Deal.inCartStr]=1;a.timeSensitiveStates[Deal.pendingAtcStr]=1;a.stateAsins={};a.gatherStates()},gatherStates:function(){var b=this;if(!b.deal||!b.deal.dealAsinsHash){return}var e;for(e in b.deal.dealAsinsHash){var c=b.deal.dealAsinsHash[e];if(!c||!c.status){continue}var a=c.status.state;if(!a){continue}if(b.stateAsins[a]===undefined){b.stateAsins[a]=[]}if(b.timeSensitiveStates[a]!==undefined&&c&&c.status&&c.status.expiresDate!==null&&c.status.expiresDate<=b.now){continue}b.stateAsins[a].push(c)}var d;for(d in b.timeSensitiveStates){if(b.stateAsins[d]!==undefined&&b.stateAsins[d]!==null){b.stateAsins[d].sort(Deal.sortByPurchaseStatusExpirations)}}},hasTimeSensitiveState:function(){var a=this;if(a.stateAsins===undefined||a.stateAsins===null){Deal.log("Cannot check if a timesensitive stateexists on undefined/null stateAsins.");return false}var b=false;var c;for(c in a.stateAsins){if(c===Deal.inCartStr||c===Deal.pendingAtcStr||c===Deal.waitInLineStr){if(a.stateAsins[c]!==undefined&&a.stateAsins[c]!==null&&a.stateAsins[c].length>0){b=true;break}}}return b},getStateDisplayData:function(){var h=this;var b={};var a=false;var d=0;var g;for(g in h.stateAsins){if(b[g]===undefined){b[g]=[]}if(g!=Deal.availableStr&&g!=Deal.expiredStr&&g!=Deal.claimedStr&&h.stateAsins[g].length>0){a=true}var f=h.stateAsins[g];var e;for(e=0;e<f.length;e++){d++;var i=f[e];var c={asin:i.ASIN};if(h.timeSensitiveStates[g]==1&&i.status!==undefined&&i.status.expiresDate!==undefined){c.expiresDate=i.status.expiresDate}b[g].push(c)}}b.hasActionableStatus=a;b.totalAsins=d;return b}});Deal.sortByPurchaseStatusExpirations=function(e,d){var c=e.status.expiresDate;var f=d.status.expiresDate;return c-f};Deal.HeroTimer=function(d,a,e,b){var c={};c.t=d;c.noHours=e;c.cssClassName="ticker";if(a!==null&&a!==undefined){c.cssClassName=a}c.useTextSeparators=b;c.span=null;c.spanID=null;c.viewElement=null;c.onTimeoutFunction=null;c.setOnTimeoutFunction=function(f){c.onTimeoutFunction=f};c.update=function(){var l=Deal.max(c.t.getTime()-new Date().getTime(),0);if(l<=0){c.disconnect();if(c.onTimeoutFunction!=null){c.onTimeoutFunction()}}var r=Math.floor(l/(60*60*1000*24));var k=Math.floor(l/(60*60*1000)%60);if(k<10){k="0"+k}var i=Math.floor(l/(60*1000)%60);if(i<10&&!c.noHours){i="0"+i}var z=Math.floor(l/(1000)%60);if(z<10){z="0"+z}var y=Math.floor(l/(60*60*1000*24*7));var p=":";var t=":";var v="";if(c.useTextSeparators){p=gbResources.getString("gbd_hour_separator")+" ";t=gbResources.getString("gbd_minute_separator")+" ";v=gbResources.getString("gbd_seconds_separator")+" "}var g=" "+((r==1)?gbResources.getString("gbd_day_countdown"):gbResources.getString("gbd_days_countdown"));var q=" "+((r==7)?gbResources.getString("gbd_week_countdown"):gbResources.getString("gbd_weeks_countdown"));var u=Deal.DOM.span({"class":c.cssClassName},[z]);var x=Deal.DOM.span({"class":c.cssClassName},[i]);var o=Deal.DOM.span({"class":c.cssClassName},[k]);var n=Deal.DOM.span({"class":c.cssClassName},[r]);var f=Deal.DOM.span({"class":c.cssClassName},[(r%7==0)?y:(y+gbResources.getString("gbd_prefix_weeks_countdown"))]);c.timeString="";var j="";if(c.noHours){j=[x,t,u]}else{j=[o,p,x,t,u,v];if(r>0&&r<8){j=[n,g]}else{if(r>7){j=[gbResources.getString("gbd_weeks_countdown_message")]}}}c.timeString=jQuery(Deal.DOM.span({},[j])).html();if(c.span==null){if(c.viewElement==null||c.spanID==null){return}c.span=jQuery(c.viewElement).find("#"+c.spanID)}jQuery(c.span).html(c.timeString)};c.disconnect=function(){c.cx.disconnect()};c.cx=Deal.clock.connect("tick",c.update);c.update();return c};Deal.UDPTimer=function(c,b,d){var a={};a.t=c;a.span=null;a.onTimeoutFunction=null;a.setOnTimeoutFunction=function(e){a.onTimeoutFunction=e};a.update=function(){var e=Deal.max(a.t.getTime()-new Date().getTime(),0);if(e<=0){a.disconnect();if(a.onTimeoutFunction!=null){a.onTimeoutFunction()}return}a.timeString=Deal.getUDPTimeString(e,b,d);if(a.span!=null&&a.span!=undefined){a.span.html(a.timeString)}};a.disconnect=function(){a.cx.disconnect()};a.cx=Deal.clock.connect("tick",a.update);a.update();return a};Deal.getUDPTimeString=function(i,l,k){var g=Math.floor(i/(60*60*1000));var d=Math.floor(i/(60*1000)%60);var o=Math.floor(i/(1000)%60);var e=gbResources.getString("gbd_ends_in_label");var n=gbResources.getString("gbd_prime_starts_in_label");var c=gbResources.getString("gbd_hour_label");var j=gbResources.getString("gbd_min_label");var b=gbResources.getString("gbd_sec_label");var f=" ";var a="";if(l){a=" "}else{if(k){a=n+" "}else{a=e+" "}}if(l==0){if(g<10){a+=("0"+g+c+f)}else{a+=(g+c+f)}if(d<10){a+=("0"+d+j+f)}else{a+=(d+j+f)}if(o<10){a+=("0"+o+b)}else{a+=(o+b)}}else{f=":";a+=(d+f);if(o<10){a+=("0"+o)}else{a+=o}}return a};Deal.isSingleAsinWithNoAction=function(a){if(a.itemType!=Deal.itemTypes.MultiItem&&a.stateDisplayData!==undefined&&a.stateDisplayData!==null&&((a.stateDisplayData[Deal.inCartStr]!==undefined&&a.stateDisplayData[Deal.inCartStr]!==null&&a.stateDisplayData[Deal.inCartStr].length>0)||(a.stateDisplayData[Deal.waitInLineStr]!==undefined&&a.stateDisplayData[Deal.waitInLineStr]!==null&&a.stateDisplayData[Deal.waitInLineStr].length>0))){return true}return false};Deal.getOfferListingID=function(a,b){if(a===undefined||a===null||a.dealAsinsHash===undefined||a.dealAsinsHash===null||a.dealAsinsHash[b]===undefined||a.dealAsinsHash[b]===null){if(a.offerListingID===undefined||a.offerListingID===null){return null}return a.offerListingID}return a.dealAsinsHash[b].offerID};Deal.escapeHtml=function(b){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(b).replace(/[&<>"'\/]/g,function(c){return a[c]})};Deal.MergeMaps=function(c,a){for(var b in a){try{if(_.isObject(a[b])){c[b]=MergeMaps(c[b],a[b])}else{if(_.isArray(a[b])){if(c[b]===undefined||c[b]===null){c[b]=a[b]}else{if(_.isArray(c[b])){c[b]=_.union(c[b],a[b])}else{Deal.log("MergeMaps: Data type mismatch; Taking the mapB's type.");c[b]=a[b]}}}else{c[b]=a[b]}}}catch(d){Deal.log("MergeMaps: Property in destination object not set; create it and set its value.");c[b]=a[b]}}return c};Deal.getReviewStars=function(d){if(d===null||d===undefined||d<0||d>5){d=0}var b=Math.floor(d);var c=d-b;var a=false;if(c>Deal.roundedReviewStarsEnum.HIGH){b+=1}else{if(c>=Deal.roundedReviewStarsEnum.LOW){a=true}}return{fullStars:b,hasHalfStar:a}};Deal.ConvertToPaladinUrl=function(a){if(a===undefined||a===null){return null}return a.replace(/^https?:\/\/[a-z0-9\.\-]*\.amazon.com\//i,window.location.protocol+"//"+window.location.host+"/")};Deal.digitalCategories={US:["16261631","2350149011","154606011","163856011","979455011","1233514011","2402172011"]};Deal.hasDigitalCategory=function(c){var a=gbResources.getCustomerData("realm");var b=Deal.digitalCategories[a];return _.intersection(c,b).length?true:false};Deal.isDealInEarlyAccessWindow=function(b){var a=false;if(b.detail&&b.detail.primeAccessType===Deal.primeAccessTypeEnum.PRIME_EARLY_ACCESS&&b.status&&b.status.msToStart<=0&&-(b.status.msToStart)<b.detail.primeAccessDurationInMs){a=true}return a};Deal.isPrimeEarlyAccessDeal=function(b){var a=false;if(b.detail&&b.detail.primeAccessType===Deal.primeAccessTypeEnum.PRIME_EARLY_ACCESS){a=true}return a};Deal.isPrimeOnlyDeal=function(b){var a=false;if(b.detail&&(b.detail.primeAccessType===Deal.primeAccessTypeEnum.PRIME_ONLY_LD||b.detail.primeAccessType===Deal.primeAccessTypeEnum.PRIME_ONLY_DOTD)){a=true}return a};Deal.isPrimeOnlyDotd=function(b){var a=false;if(b.detail&&b.detail.primeAccessType===Deal.primeAccessTypeEnum.PRIME_ONLY_DOTD){a=true}return a};Deal.getPrimeEarlyAccessEndTime=function(a){return(new Date(a.detail.primeAccessDurationInMs+a.status.startDate.getTime()))};Deal.setURLParameter=function(d,b,e){if(d){var a=d.indexOf("#");var g=a===-1?"":d.substr(a);d=a===-1?d:d.substr(0,a);var c=new RegExp("([?&])"+b+"=.*?(&|$)","i");var f=d.indexOf("?")!==-1?"&":"?";if(d.match(c)){d=d.replace(c,"$1"+b+"="+e+"$2")}else{d=d+f+b+"="+e}return d+g}return null};Deal.getURLFilters=function(d){var c={};var f=Deal.controller.widgetIdToWidgetNameMap[d];var a=Deal.configManager[f].widgetViewConfig;var e=gbResources.getParamValueFromUrl(a.filterPrefix+d,window.location);if(e){var h=e.split(a.separatorFilters);for(var b=0;b<h.length;b++){var g=h[b].split(a.separatorKeyVal);if(g.length>1){c[g[0]]=g[1]}}}return c};Deal.setURLFilters=function(h){var f=Deal.controller.page[h];var a=Deal.controller.filter[h];var c=Deal.controller.status[h];var e=Deal.controller.widgetIdToWidgetNameMap[h];var b=Deal.configManager[e].widgetViewConfig;if(b&&f&&a&&c){var i=b.filterPrefix+h;var g=b.pageKey+b.separatorKeyVal+f+b.separatorFilters+b.categoryKey+b.separatorKeyVal+a+b.separatorFilters+b.statusKey+b.separatorKeyVal+c;var d=Deal.setURLParameter(window.location.href,i,g);if(d&&window.history&&typeof window.history.replaceState==="function"){window.history.replaceState({},"",d)}}};Deal.getParameterByName=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),b=c.exec(location.search);return b===null?"":decodeURIComponent(b[1].replace(/\+/g," "))};Deal.isPEAEnabledMarketplace=function(a){return(a==="US"||a==="UK"||a==="CA"||a==="DE"||a==="FR"||a==="ES"||a==="IT"||a==="JP")};Deal.incrementCounter=function(a){if(a&&window.ue&&typeof window.ue.count==="function"){ue.count(a,(ue.count(a)||0)+1)}};Deal.setCounter=function(a,b){if(a&&window.ue&&typeof window.ue.count==="function"){ue.count(a,b)}};Deal._generateAPIMetricName=function(a){if(!a){return null}var c="goldbox";var b=":";if(a.apiName){c+=b+a.apiName;if(a.apiVersion){c+=b+a.apiVersion}}c+=b+(a.isSuccess?"success":"error");c+=b+(a.isRetry?"retry":"noretry");if(a.clientId){c+=b+a.clientId}return c.toLowerCase()};Deal.recordAPIMetrics=function(a){if(!a){return}var b=Deal._generateAPIMetricName(a);Deal.incrementCounter(b);if(a.latency){Deal.setCounter(b+":time",a.latency)}};
Deal.Signal={methods:["connect","disconnectAll","signal"],init:function(c){var a=this;var b;var d;if(c.__signals__){throw new Error("already registered")}if(c.signals===undefined){throw new Error("expected 'signals' attribute")}for(b=0;b<this.methods.length;b++){d=this.methods[b];if(c[d]!==undefined){throw new Error("method "+d+" is already defined")}}c.__signals__={};for(b=0;b<c.signals.length;b++){c.__signals__[c.signals[b]]={}}for(b=0;b<this.methods.length;b++){d=this.methods[b];c[d]=this[d]}},next_id:100,connect:function(c,d,f){var b=this;if(b.__signals__[c]===undefined){throw new Error("no such signal "+c)}var e=Deal.Signal.next_id++;var a={signals:["disconnect"],disconnect:function(){delete b.__signals__[c][e];this.signal("disconnect");this.disconnect=function(){}}};if(d instanceof Function){a.trigger=d}else{if(d[f]===undefined){throw new Error("method '"+f+"' for obj "+d+" doesn't exist")}if(!d[f] instanceof Function){throw new Error("method '"+f+"' for obj "+d+" isn't a Function")}a.trigger=function(){d[f].apply(d,arguments)}}b.__signals__[c][e]=a;Deal.Signal.init(a);return a},disconnectAll:function(b){var a=this;var c;if(b){if(a.__signals__[b]===undefined){throw new Error("no such signal "+b)}var d;for(d in this.__signals__[b]){this.__signals__[b][d].disconnect()}return}for(c in this.__signals__){this.disconnectAll(c)}},signal:function(h){var k=this;if(k.__signals__[h]===undefined){throw new Error("no such signal "+h)}var f=[];var c=1;if(arguments.length==1){c=0}for(c;c<arguments.length;c++){f.push(arguments[c])}var j=[];for(var a in this.__signals__[h]){var b=this.__signals__[h][a];try{b.trigger.apply(b,f)}catch(d){j.push(d)}}if(j.length>1){var g=new Error("multiple errors. See 'errors'");g.errors=j;throw g}else{if(j.length==1){throw j[0]}}}};
Deal.min=function(b){var d=arguments[0];for(var c=1;c<arguments.length;c++){if(arguments[c]<d){d=arguments[c]}}return d};Deal.max=function(c){var b=arguments[0];for(var d=1;d<arguments.length;d++){if(arguments[d]>b){b=arguments[d]}}return b};Deal.commify=function(b,a){b=parseFloat(b);if(a!==undefined){b=b.toFixed(a)}else{b=b.toString()}var e=b.split(".");var d=e[0];for(var c=d.length-3;c>0;c-=3){d=d.substr(0,c)+","+d.substr(c,d.length-c)}if(e.length==2){return d+"."+e[1]}else{return d}};Deal.DOM={set_attributes:function(d,b){for(var a in b){if(a=="style"){d.style.cssText=b[a]}else{var c={"class":"className",checked:"defaultChecked",usemap:"useMap","for":"htmlFor",readonly:"readOnly",colspan:"colSpan",bgcolor:"bgColor",cellspacing:"cellSpacing",cellpadding:"cellPadding",valign:"vAlign",nowrap:"noWrap"}[a]||a;d[c]=b[a]}}},el:function(d,a,b){var c=document.createElement(d);if(a){Deal.DOM.set_attributes(c,a)}if(b){this.appendChildren(c,b)}return c},img:function(a){a=a||{};a.border=a.border||0;return this.el("img",a)},div:function(a,b){return this.el("div",a,b)},span:function(a,b){return this.el("span",a,b)},p:function(a,b){return this.el("p",a,b)},a:function(a,b){return this.el("a",a,b)},table:function(a,b){if(!a){a={}}a.cellpadding=a.cellpadding||0;a.cellspacing=a.cellspacing||0;a.border=a.border||0;return this.el("table",a,[this.el("tbody",null,b)])},tr:function(a,b){return this.el("tr",a,b)},td:function(a,b){return this.el("td",a,b)},td_nowrap:function(a,b){return this.el("td",a,[this.span({style:"white-space:nowrap"},b)])},br:function(a,b){return this.el("br",a,b)},hr:function(a){return this.el("hr")},select:function(a,b){return this.el("select",a,b)},option:function(a,b){return this.el("option",a,b)},appendChildren:function(c,b){for(var a=0;a<b.length;a++){var d=b[a];if(typeof d=="string"||typeof d=="number"){d=this.text(d)}else{if(d instanceof Array){this.appendChildren(c,d);continue}else{if(d===null||d===undefined){continue}}}c.appendChild(d)}},clearChildren:function(a){while(a.firstChild){a.removeChild(a.firstChild)}},replaceChildren:function(b,a){this.clearChildren(b);this.appendChildren.call(this,b,a)},text:function(a){return document.createTextNode(a)}};Deal.clock={signals:["tick"]};Deal.Signal.init(Deal.clock);Deal.clock.tick=function(){Deal.clock.signal("tick")};window.setInterval(Deal.clock.tick,250);Deal.Timer=function(c,e,d){var b={};b.t=c;b.noHours=d;var a={};b.span=Deal.DOM.span(a);b.onTimeoutFunction=null;b.setOnTimeoutFunction=function(f){b.onTimeoutFunction=f};b.update=function(){var g=Deal.max(b.t.getTime()-new Date().getTime(),0);if(g<=0){b.disconnect();if(b.onTimeoutFunction!=null){b.onTimeoutFunction()}}var l=Math.floor(g/(60*60*1000));if(l<10){l="0"+l}var f=Math.floor(g/(60*1000)%60);if(f<10&&!b.noHours){f="0"+f}var k=Math.floor(g/(1000)%60);if(k<10){k="0"+k}var j=":";var i=":";var n="";if(gbResources.getCustomerData("realm")=="FR"){j="h ";i="min ";n="s"}if(b.noHours){b.span.innerHTML=f+i+k}else{b.span.innerHTML=l+j+f+i+k+n}};b.disconnect=function(){b.cx.disconnect()};b.cx=Deal.clock.connect("tick",b.update);b.update();return b};Deal.getPurchaseState=function(e,c){var h="Available";var g=c;if(g==null){if(e!=null&&e.asins!=null){if(e.asins.length>1){var h="Available";var a={};for(var f=0;f<e.asins.length;f++){var d=e.asins[f];var b=Deal.getPurchaseState(e,d);if(a[b]){a[b]+=1}else{a[b]=1}}for(var b in a){var j=a[b];if(e.asins.length==j){h=b;break}}return h}else{if(e.asins[0]!=null){g=e.asins[0]}}}else{}}if(g&&g.status&&g.status.purchaseStatus){h=g.status.purchaseStatus.state}else{if(g&&g.isCustomerClaimed){h="Claimed"}else{h="Available"}}return h};Deal.formatPricePercentage=function(b){var a=null;if(b==null){a=null}else{if(gbResources.getCustomerData("realm")=="CN"){a=b.toFixed(2)}else{a=Math.round(b)}}return a};Deal.isClaimed=function(b,a){return Deal.getPurchaseState(b,a)==Deal.claimedStr};Deal.inState=function(c,b,a){return Deal.getPurchaseState(c,b)==a};Deal.isPrimeEligible=function(b){if(b.asins){for(var a=0;a<b.asins.length;a++){if(b.asins[a].isPrimeEligible){return true}}}return false};
if(!window.Deal.Model){window.Deal.Model={}}Deal.Model.Deal=Deal.Class({signals:["change","expire","status_expire","pstatus_expires_soon","pstatus_expire"],__init__:function(b){var a=this;Deal.Signal.init(a);a.dealID=b;a.timeouts={};a.loading=true;a.expired=true;a.status={expired:true};a.detail={};a.asins=[];a.asinExpiresSoonStack=[];a.asinExpiredStack=[];a.purchaseStatusWarningThreshold=2*60*1000;if(window.gbResources.getFeature("notifier-waitlist")&&window.gbResources.getFeature("notifier-waitlist")!="C"){a.purchaseStatusWarningThreshold=parseInt(window.gbResources.getFeature("notifier-waitlist"),10)*60*1000}},_init_status:function(b){var a=this;a.status.cacheExpiresDate=new Date(b.getTime()+parseInt(a.status.msToCacheExpires,10));a.status.expired=false;a.status.startDate=new Date(b.getTime()+parseInt(a.status.msToStart,10));a.status.started=a.status.msToStart<=0;a.status.endDate=new Date(b.getTime()+parseInt(a.status.msToEnd,10));a.status.ended=a.status.msToEnd<=0;if(a.timeouts.start_timeout){window.clearTimeout(a.timeouts.start_timeout)}if(!a.status.started){a.timeouts.start_timeout=window.setTimeout(function(){a.status.started=true;a.signal("change",a)},a.status.startDate.getTime()-new Date().getTime())}if(a.timeouts.end_timeout){window.clearTimeout(a.timeouts.end_timeout)}if(!a.status.ended){a.timeouts.end_timeout=window.setTimeout(function(){a.status.ended=true;a.signal("change",a)},a.status.endDate.getTime()-new Date().getTime())}if(a.timeouts.status_expire_timeout){window.clearTimeout(a.timeouts.status_expire_timeout)}a.timeouts.status_expire_timeout=window.setTimeout(function(){a.status.expired=true;a.signal("status_expire",a)},a.status.cacheExpiresDate.getTime()-new Date().getTime())},_init_asin_statuses:function(){var a=this;if(!a.asins){Deal.log("No Asins, not initializing statuses.");return}var c=new Date();var b=Deal.filterAsinsByState(a.asins,[Deal.inCartStr,Deal.expiredStr,Deal.waitInLineStr,Deal.pendingAtcStr]);for(var d=0;d<b.length;d++){var g=b[d];if(a.purchaseStatusWarningThreshold){g.status.purchaseStatus.expiresDate=new Date(c.getTime()+parseInt(g.status.purchaseStatus.msToExpiry,10))}}b.sort(Deal.sortByAsinTimes);a.asinExpiresSoonStack=[];a.asinExpiredStack=[];for(var d=0;d<b.length;d++){var g=b[d];if(a.timeouts.pstatus_exp_soon[g.asin]){window.clearTimeout(a.timeouts.pstatus_exp_soon[g.asin])}var f=g.status.purchaseStatus.expiresDate.getTime()-new Date().getTime();var e=f-a.purchaseStatusWarningThreshold;if(e<0){e=0}var h=""+g.asin;if(f>0&&g.status.purchaseStatus.state!=Deal.waitInLineStr&&g.status.purchaseStatus.state!=Deal.pendingAtcStr){a.asinExpiresSoonStack.push(h);a.timeouts.pstatus_exp_soon[h]=window.setTimeout(function(){var i=a.asinExpiresSoonStack.shift();a.signal("pstatus_expires_soon",a,i)},e)}if(a.timeouts.pstatus_expire[g.asin]){window.clearTimeout(a.timeouts.pstatus_expire[g.asin])}a.asinExpiredStack.push(h);a.timeouts.pstatus_expire[g.asin]=window.setTimeout(function(){var i=a.asinExpiredStack.shift();a.signal("pstatus_expire",a,i);a.signal("change",a)},f)}},load_from_deal:function(e){var b=this;var c=new Date();var a;for(a in e){b[a]=e[a]}b.loading=false;b.startDate=new Date(b.startDate*1000);b.endDate=new Date(b.endDate*1000);b.cacheExpiresDate=new Date(c.getTime()+parseInt(b.msToCacheExpires,10));b.expired=false;if(b.timeouts.expire_timeout){window.clearTimeout(b.timeouts.expire_timeout)}b.timeouts.expire_timeout=window.setTimeout(function(){b.expired=true;b.signal("expire",b)},b.cacheExpiresDate.getTime()-new Date().getTime());b.limitedQuantity=b.limitedQuantity=="1";if(b.customer){b.customer.claimed=b.customer.claimed=="1"}if(b.asins){if(!b.timeouts.pstatus_exp_soon){b.timeouts.pstatus_exp_soon={}}if(!b.timeouts.pstatus_expire){b.timeouts.pstatus_expire={}}for(var d=0;d<b.asins.length;d++){b.asins[d].offerServiceSoldOut=b.asins[d].offerServiceSoldOut=="1"}}b._init_status(c);b._init_asin_statuses();b.signal("change",b)},load_from_status:function(a){var b=this;b.status=a;b._init_status(new Date());b.signal("change",b)},load_from_asin_status:function(d){var a=this;if(a.asins==null){return}if(d==null){return}var e=d.asin;for(var b=0;b<a.asins.length;b++){var c=a.asins[b];if(c.asin==e){a.asins[b].status=d;break}}a._init_asin_statuses();a.signal("change",a)},setPurchaseStatusWarningThreshold:function(a){if(a>0){self.purchaseStatusWarningThreshold=a}else{self.purchaseStatusWarningThreshold=2*60*1000}},getPurchaseStatusWarningThreshold:function(){var a=this;return a.purchaseStatusWarningThreshold},load_from_deal_dao:function(g){var b=this;var c=new Date();b.loading=false;b.marketplaceID=g.detail.marketplaceID;if(g.auxiliaryData.merchantDetails!==null&&g.auxiliaryData.merchantDetails!==undefined){b.merchantID=g.auxiliaryData.merchantDetails.merchantID}b.dealID=g.dealID;b.startDate=g.status.startDate;b.endDate=g.status.endDate;b.limitedQuantity=g.isLimitedQuantity;b.parentAsin=g.parentAsin;b.msToCacheExpires=g.status.msToCacheExpires;b.cacheExpiresDate=g.status.cacheExpiresDate;b.expired=g.expired;b.status={marketplaceID:g.detail.marketplaceID,dealID:g.dealID,percentClaimed:g.status.percentClaimed,msToStart:g.status.msToStart,startDate:g.status.startDate,started:g.status.started,msToEnd:g.status.msToEnd,endDate:g.status.endDate,ended:g.status.ended,msToCacheExpires:g.status.msToCacheExpires,cacheExpiresDate:g.status.cacheExpiresDate,expired:g.status.expired};b.detail={marketplaceID:g.detail.marketplaceID,dealID:g.dealID,title:g.detail.title,description:g.detail.description,imageAsin:g.detail.imageAsin,url:g.detail.URL,buyBoxUrl:g.detail.buyBoxURL};b.asins=[];var a=g.dealAsins;for(var d=0;d<a.length;d++){var e=a[d];var f={marketplaceID:g.detail.marketplaceID,dealID:g.dealID,asin:e.ASIN,basisPrice:e.basisPrice,basisKind:e.basisKind,dealPrice:e.dealPrice,percentOff:e.percentOff,offerServiceSoldOut:e.status.offerServiceSoldOut,variationData:e.variationData,imageURL:e.imageURL,status:{marketplaceID:g.detail.marketplaceID,dealID:g.dealID,asin:e.ASIN,percentClaimed:e.status.percentClaimed,percentSoldOut:e.status.percentSoldOut,itemState:e.status.itemState,offerServiceSoldOut:e.status.offerServiceSoldOut,currentlyUnavailable:e.status.currentlyUnavailable,purchaseStatus:{state:e.status.state,msToExpiry:e.status.msToExpiry}}};b.asins.push(f)}b.customer={marketplaceID:g.detail.marketplaceID,dealID:g.dealID,customerID:g.customerID,claimed:g.claimed}},load_status_from_deal_dao:function(c){var a=this;var b=new Date();a.load_from_deal_dao(c);if(a.timeouts.expire_timeout){window.clearTimeout(a.timeouts.expire_timeout)}if(a.cacheExpiresDate){a.timeouts.expire_timeout=window.setTimeout(function(){a.expired=true;a.signal("expire",a)},a.cacheExpiresDate.getTime()-new Date().getTime())}if(a.asins){if(!a.timeouts.pstatus_exp_soon){a.timeouts.pstatus_exp_soon={}}if(!a.timeouts.pstatus_expire){a.timeouts.pstatus_expire={}}}a._init_status(b);a._init_asin_statuses();a.signal("change",a)}});
Deal.CheckoutTimer=function(b){var a={};a.span=Deal.DOM.span();a.t=b;a.onTimeoutFunction=null;a.update=function(){var c=Deal.max(a.t.getTime()-new Date().getTime(),0);if(c<=0){a.disconnect();if(a.onTimeoutFunction!=null){a.onTimeoutFunction()}return}var d=Math.floor(c/(60*1000)%60);var f=Math.floor(c/(1000)%60);var g=" "+gbResources.getString("gbd_minutes")+" ";var e=" "+gbResources.getString("gbd_seconds")+" ";a.span.innerHTML='<span class="timeleft-large">'+d+"</span>"+g+'<span class="timeleft-large">'+f+"</span>"+e};a.disconnect=function(){a.cx.disconnect()};a.cx=Deal.clock.connect("tick",a.update);a.update();return a};Deal.LegacyCartPopover=Deal.Class({__init__:function(j,h,b,e,m,k,a){var o=this;o.deal=j;o.asin=h;o.waitlist=b;o.state=e;o.isAuiPage=window.P&&window.P.AUI_BUILD_DATE;var d=Deal.controller.getWidgetByID(m);var g=d.getDealViewByDealID(k);var i=g.deal;o.isPrimeOnlyDotd=Deal.isPrimeOnlyDotd(i);o.popover=o.getPopoverDiv();var c=835;var n=250;var l=true;var f=window.gbResources.getString("gbd_close_and_continue_shopping");if(o.state==Deal.waitInLineStr){c=410;f=null;l=false}if(o.isAuiPage){P.when("A","a-modal","ready").execute(function(q,t){var r=Deal.controller.getWidgetByID(m);var s=r.getDealViewByDealID(k);var p=s.$el.find("#dealTitle");var u="DealAtcPopover"+k;o.pop=t.create(p,{content:"<div class='inAuiPopover' style='padding:0 20px 20px 20px'>"+q.$(o.popover).html()+"</div>",name:u,width:c,height:(o.state===Deal.waitInLineStr)?n+40:n-25});q.on("a:popover:show:"+u,function(v){if(!o.waitlist&&o.state==Deal.inCartStr){o.timer_div=q.$("div.timeleft",".inAuiPopover").get(0);o.updateTimeRemaining()}});q.on("a:popover:afterHide:"+u,function(v){o.onHide();t.remove(p);a&&a()});o.pop.show()})}else{if(window.amznJQ){amznJQ.available("popover",function(){o.pop=jQuery.AmazonPopover.displayPopover({showCloseButton:true,width:c,height:n,modal:l,closeText:f,closeEventInclude:"CLICK_OUTSIDE",location:"centered",locationAlign:"middle",literalContent:o.popover,onHide:function(){o.onHide();a&&a()}})})}}},getPopoverDiv:function(){var k=this;var j="background:url("+gbResources.getImage("sprite_site_wide")+") -30px -189px;";var f=window.gbResources.getString("gbd_1_deal_to_cart");var g="";var e="";if(k.state==Deal.waitInLineStr){f=window.gbResources.getString("gbd_joined_waitlist");g="font-size: 15px; top:-3px; left:23px;";j="background:url("+gbResources.getImage("sprite_site_wide")+") -139px -189px; height: 20px; width: 20px;";e="width:350px !important;"}var c="";if(gbResources.getCustomerData("realm")=="DE"){c="font-size: 15px !important;"}var a=Deal.DOM.br();var i=null;var b=null;var d="width: 280px;";var h="image_title_price";if(k.state==Deal.waitInLineStr){h="image_title_price_waitlist";b=k.get_inner_message();d="width: 410px;";a=null}else{i=k.get_timer_atc_table()}return Deal.DOM.div({},[Deal.DOM.div({style:k.isAuiPage?"position:absolute; top:27px; left:20px;":"position:relative;"},[Deal.DOM.div({"class":"greencheck_img",style:j},[Deal.DOM.span({"class":"cart-popover-label",style:g+c+e},[f])])]),a,Deal.DOM.table({"class":"cart-popover-table"},[Deal.DOM.tr({},[Deal.DOM.td({"class":h,style:d},[k.get_image_title_price_table()]),i]),b])])},get_position_chance:function(){var n=this;var a=null;if(n.asin.status.purchaseStatus.waitListStatus==undefined||n.asin.status.purchaseStatus.waitListStatus==null){return null}else{var j=n.asin.status.purchaseStatus.waitListStatus;var k=j.inCartIndicator;var d=j.position;if(k==undefined||k==null||d==undefined||d==null){return null}}if(n.asin.status.purchaseStatus.waitListStatus!=undefined){var c=n.asin.status.purchaseStatus.waitListStatus.inCartIndicator;var d=n.asin.status.purchaseStatus.waitListStatus.position;if(d>500){d="500+"}else{d=jQuery("<span />").html(window.gbResources.getString("gbd_position_num",{num:d}));d=d[0]}var b=Deal.DOM.td({"class":"pc_value"},[d]);if(gbResources.getCustomerData("realm")=="CN"){jQuery(b).css("font-weight","")}var i=Deal.DOM.td({"class":"pc_label"},[window.gbResources.getString("gbd_place_on_waitlist")]);var g=Deal.DOM.td({"class":"pc_value"},[window.gbResources.getString("gbd_"+c.toLowerCase())]);var l=Deal.DOM.td({"class":"pc_label"},[window.gbResources.getString("gbd_chance_at_deal")]);var e;var m;var f;var h;if(gbResources.getCustomerData("realm")=="CN"){e=i;m=b;f=l;h=g}else{e=b;m=i;f=g;h=l}a=Deal.DOM.div({"class":"waitlist_position_chance"},[Deal.DOM.br(),Deal.DOM.table({},[Deal.DOM.tr({},[e,Deal.DOM.td(null,["\xA0"]),m]),Deal.DOM.tr({},[f,Deal.DOM.td(null,["\xA0"]),h])])])}return a},get_inner_message:function(){var b=this;var c=Deal.DOM.span({"class":"waitlist_message"},[window.gbResources.getString("gbd_continue_shopping_alert_msg")]);if(b.state==Deal.waitInLineStr&&!b.waitlist){jQuery(c).html(window.gbResources.getString("gbd_forced_waitlist_msg"))}var e="background:url("+gbResources.getImage("sprite_site_wide")+") -117px -189px;";var a=Deal.DOM.div({"class":"bubble",style:e},[" "]);var d=Deal.DOM.a({href:"#","class":"ap_custom_close"},[Deal.DOM.img({alt:window.gbResources.getString("gbd_continue_shopping"),style:"display: inline;",src:gbResources.getImage("continue_shopping")})]);return Deal.DOM.tr({},[Deal.DOM.td({},[Deal.DOM.table({"class":"inner_message_waitlist"},[Deal.DOM.tr({},[Deal.DOM.td({style:"padding: 8px 0 8px 8px;"},[a]),Deal.DOM.td({style:"padding: 8px;"},[c])]),Deal.DOM.tr({},[Deal.DOM.td({style:"padding: 0 8px 8px;",colSpan:2},[d])])])])])},get_timer_atc_table:function(){var a=this;return Deal.DOM.td({},[Deal.DOM.table({"class":"inner-cart-popover-table"},[Deal.DOM.tr({},[Deal.DOM.td({style:"text-align:left; padding:10px;"},[Deal.DOM.a({href:"/gp/cart/view.html/ref=gno_cart"},[Deal.DOM.img({alt:window.gbResources.getString("gbd_view_cart_proceed"),style:"display: inline;",src:gbResources.getImage("view_cart_proceed")})]),a.get_timer_message_table()])])])])},get_timer_message_table:function(){var a=this;var c=window.gbResources.getString("gbd_checkout_within");if(a.isPrimeOnlyDotd){c=window.gbResources.getString("gbd_checkout_within_dotd")}var b=null;if(window.gbResources.getFeature("notifier-waitlist")&&window.gbResources.getFeature("notifier-waitlist")!="C"){b=window.gbResources.getString("gbd_time_before_alert_msg",{time:window.gbResources.getFeature("notifier-waitlist")})}return Deal.DOM.table({"class":"inner-msg"},[Deal.DOM.tr({},[Deal.DOM.td({style:"padding: 8px 8px 0px;"},[Deal.DOM.div({"class":"alert",style:"background:url("+gbResources.getImage("sprite_site_wide")+");"},[])]),Deal.DOM.td({"class":"msgtitle"},[c])]),Deal.DOM.tr({},[Deal.DOM.td(null,[]),Deal.DOM.td({"class":"timeleft"},[a.timeRemaining()])]),Deal.DOM.tr({},[Deal.DOM.td(null,[]),Deal.DOM.td({"class":"smallprint",style:"width:100%;"},[b])])])},get_image_title_price_table:function(){var l=this;var a=l.asin.imageURL;a=a=Deal.resizeImage(a,85);var g=null;if(l.deal.detail.title){g=Deal.truncate_description(l.deal.detail.title,65)}var e=null;var i="";if(l.asin.basisPrice){e=l.asin.basisPrice;if(l.asin.basisKind===Deal.savingsBasisKind.LIST_PRICE){i=window.gbResources.getString("csld-multi-cat-list_price")+" "}else{i=window.gbResources.getString("csld-multi-cat-price")+" "}}var d=Deal.Price.format(e);var j=Deal.DOM.span({"class":"cart-popover-prevprice"},[d]);var b=window.gbResources.getString("csld-deal_price")+" ";var f=null;if(l.state==Deal.waitInLineStr){f=l.get_position_chance()}var k=null;if(l.state==Deal.waitInLineStr){k="width:247px"}var c="";if(d){c=[Deal.DOM.span({"class":"cart-popover-listprice"},[i]),j,Deal.DOM.br()]}var h=Deal.DOM.span({style:"white-space:nowrap"},[Deal.Price.format(l.asin.dealPrice)]);return Deal.DOM.table({style:"padding-top:10px;"},[Deal.DOM.tr({},[Deal.DOM.td({style:"padding-right: 10px; vertical-align: top;"},[Deal.DOM.img({alt:window.gbResources.getString("gbd_deal_image"),style:"display: inline",src:a})]),Deal.DOM.td({style:"vertical-align: top;"+k},[Deal.DOM.span({"class":"cart-popover-asintitle"},[g]),Deal.DOM.p(null,[]),c,Deal.DOM.span({"class":"cart-popover-dealprice"},[b,h]),f])])])},timeRemaining:function(){this.timer_div=Deal.DOM.div({"class":"timeleft"},[]);this.updateTimeRemaining();return this.timer_div},updateTimeRemaining:function(){var b=this;if(b.timer){b.timer.disconnect()}if(b.deal.status.ended){b.timer=null}else{var c=parseInt(b.asin.status.purchaseStatus.msToExpiry,10);var a=new Date();a.setTime(a.getTime()+c);b.timer=Deal.CheckoutTimer(a);if(b.timer){b.timer.onTimeoutFunction=function(){if(b.pop){if(b.isAuiPage){b.pop.hide()}else{b.pop.close()}}}}Deal.DOM.replaceChildren(b.timer_div,[b.timer.span])}},onHide:function(){if(this.timer){this.timer.disconnect()}}});
Deal.CombinationGenerator=Deal.Class({__init__:function(e,d){this.a=[];this.n=null;this.r=null;if(d>e){Deal.log("ERROR: r > n");return}if(e<1){Deal.log("ERROR: n < 1");return}this.n=e;this.r=d;this.a=new Array(d);var b=this.getFactorial(e);var c=this.getFactorial(d);var a=this.getFactorial(e-d);this.total=b/(c*a);this.reset()},reset:function(){for(var a=0;a<this.a.length;a++){this.a[a]=a}this.numLeft=this.total},hasMore:function(){return !!this.numLeft},getFactorial:function(c){var a=1;for(var b=c;b>1;b--){a*=b}return a},getNext:function(){if(this.numLeft===this.total){this.numLeft-=1;return this.a}var b=this.r-1;while(this.a[b]===this.n-this.r+b){b--}this.a[b]=this.a[b]+1;for(var a=b+1;a<this.r;a++){this.a[a]=this.a[b]+a-b}this.numLeft-=1;return this.a}});Deal.LegacyVariationPopover=Deal.Class({__init__:function(d,f,e){var c=this;c.backboneDeal=f;c.deal=f.legacyDeal;c.dropDownOptions={};c.currentSelections={};c.widgetID=e;c.isAuiPage=window.P&&window.P.AUI_BUILD_DATE;var b=window.gbResources.getString("csld-deal_options");if(Deal.isPrimeOnlyDotd(f)){b=window.gbResources.getString("csld-deal_options_dotd")}var a=-39;var g=-221;if(c.isAuiPage){P.when("A","a-modal","ready").execute(function(i,j){var k="DealVariationPopover"+f.dealID+(+new Date());var h=j.create(i.$(d),{content:"<div class='inAuiPopover dealVariationPopover' style='padding:0 20px 20px 20px'></div>",name:k,header:b});i.on("a:popover:beforeShow:"+k,function(){c.onShow(j,i)});i.on("a:popover:afterHide:"+k,function(){c.onHide()})})}else{if(window.amznJQ){amznJQ.available("popover",function(){jQuery(d).amazonPopoverTrigger({showOnHover:false,locationAlign:"middle",location:"auto",locationOffset:[a,g],literalContent:" ",closeEventInclude:"CLICK_OUTSIDE",onShow:function(h){c.onShow(h)},onHide:function(){c.onHide()},title:'<span style="color: #E47911;">'+b+"</span>",closeText:window.gbResources.getString("csld-close")})})}}},onShow:function(f,a){var c=this;if(window.Deal&&window.Deal.controller){window.Deal.controller.setVarPopCloseFunction(c.widgetID,f.close)}c.selection={};c.selectors={};c.selection_span={};c.selectionDropDownElements={};c.asinsForSelection();c.allValidCombinations={};c.getAllCombinations();var g="";if(!Deal.isPrimeOnlyDotd(c.backboneDeal)){g=c.progressBar()}var e=Deal.DOM.div({style:"padding-top: 4px;"},[Deal.DOM.a({href:window.gbResources.getString("csld-restrictions_link"),style:"font-size: 11px; text-decoration: none;"},[window.gbResources.getString("csld-restrictions_apply")])]);if(c.marketplaceID=="US"||c.marketplaceID=="UK"){e=Deal.DOM.div({style:"position:relative; left:0px; font-family: verdana;"},[window.gbResources.getString("gbd_ld_rules")])}var d=Deal.DOM.table({width:"430"},[Deal.DOM.tr({valign:"top"},[Deal.DOM.td({width:"120"},[c.image(),g,c.timeRemaining()]),Deal.DOM.td({width:"10"}),Deal.DOM.td({},[c.title(),c.selector(),c.price(),Deal.DOM.div({style:"margin-top:10px; position: relative;",height:"22"},[c.buyButton(),c.statusBox(),Deal.DOM.br(),e])])])]);var b;if(c.isAuiPage){b=a.$(".inAuiPopover.dealVariationPopover")}else{b=f.find(".ap_content")}b.empty().append(d);c.container=b;c.change_cx=c.deal.connect("change",c,"deal_change");return d},getSelectionCombinations:function(e,g){var f=[];var c=[];var a=new Deal.CombinationGenerator(e.length,g);while(a.hasMore()){f=a.getNext();var b=[];for(var d=0;d<f.length;d++){b.push(e[f[d]])}c.push(b.join(";"))}return c},onHide:function(){this.timer.cx.disconnect();this.change_cx.disconnect()},deal_change:function(){this.asinsForSelection();this.update()},update:function(){this.updateImage();this.updatePrice();this.updateSelectionBoxes();this.updateBuyButton();this.updateStatusBox();this.updateProgressBar();this.updateTimeRemaining()},image:function(){this.img=Deal.DOM.img();this.updateImage();return Deal.DOM.div(null,[this.img])},updateImage:function(){var a=this.imageURLForCurrentSelection();if(!a){a=gbResources.getImage("no_image")||"https://images-na.ssl-images-amazon.com/images/G/01/x-site/icons/no-img-sm.gif"}else{a=a.replace(/\.((_.*_)\.)?(gif|jpg)$/,".$2_AA120_.$3")}this.img.src=a},imageURLForCurrentSelection:function(){var c=this;var e;if(c.selectedAsin){c.selectedAsin.imageURL=Deal.checkAndSetSSLImageUrl(c.selectedAsin.imageURL);return c.selectedAsin.imageURL}var d=null;for(e=0;e<c.selectedAsins.length;e++){if(d){if(d!=c.selectedAsins[e].imageURL){d=null;break}}else{d=c.selectedAsins[e].imageURL}}if(d){d=Deal.checkAndSetSSLImageUrl(d);return d}for(var b in c.selection){var a=c.selection[b];d=c.imageURLForSelection(b,a);if(d){d=Deal.checkAndSetSSLImageUrl(d);return d}}return c.deal.detail.imageAsin},imageURLForSelection:function(c,b){var a=this;var e;for(var d=0;d<a.deal.asins.length;d++){var f=a.deal.asins[d];if(f.variationData[c]!=b){continue}if(e){if(e!=f.imageURL){return null}}else{e=f.imageURL}}return e},progressBar:function(){var a=this;a.progressBarInner=Deal.DOM.div({style:"position:absolute;background-color:#C9D7E4;height:19px;"});a.progressBarText=Deal.DOM.div({style:"font-size: 9px;overflow:hidden;position:absolute;padding:2px 0 0 0;text-align:center;vertical-align:middle;width:100%"});a.progressBarOuter=Deal.DOM.div({style:"border:1px solid #C9D7E4;height: 19px;position: relative;margin-top:10px;width: 118px;"},[a.progressBarInner,a.progressBarText]);a.updateProgressBar();return a.progressBarOuter},updateProgressBar:function(){var a=this;if(Deal.isPrimeOnlyDotd(a.backboneDeal)){return}if(a.deal.limitedQuantity){if(a.selectedAsins.length==a.deal.asins.length){a.showPercentClaimed(a.deal.status.percentClaimed)}else{if(a.selectedAsin){a.showPercentClaimed(a.selectedAsin.status.offerServiceSoldOut?100:a.selectedAsin.status.percentClaimed)}else{a.showPercentClaimed(null)}}}else{a.showPercentClaimed(null)}},showPercentClaimed:function(b){var a=this;b=Math.round(b);if(b!=null){a.progressBarOuter.style.visibility="";a.progressBarInner.style.width=b+"%";a.progressBarText.innerHTML=window.gbResources.getString("gbd_percent_now_claimed",{percent:b})}else{a.progressBarOuter.style.visibility="hidden"}},timeRemaining:function(){var a=this;a.timer_div=Deal.DOM.div({style:"font-size:9px;text-align:center; margin-top: 5px;"});a.updateTimeRemaining();return a.timer_div},updateTimeRemaining:function(){var a=this;if(a.timer){a.timer.cx.disconnect()}if(a.deal.status.ended){a.timer_div.innerHTML=window.gbResources.getString("csld-expired_status");a.timer=null}else{var b=a.deal;a.timer=Deal.Timer(b.status.endDate);a.timer.span.id="time-remaining-"+b.dealID;a.timer.span.style.fontWeight="bold";Deal.DOM.replaceChildren(a.timer_div,[window.gbResources.getString("csld_remaining")+" ",a.timer.span," "+window.gbResources.getString("csld_remaining_part2")])}},title:function(){var a=this;return Deal.DOM.span({style:"font-weight:bold"},[a.deal.detail.title])},selector:function(){var a=this;var h=a.deal.asins;a.options={};a.color_images={};for(var c=0;c<h.length;c++){var f=h[c].variationData;for(var b in f){var d=a.options[b];if(d===undefined){a.options[b]=d={}}d[f[b]]=1;if(b=="Color"){a.color_images[b]=h[c].imageURL}}}var g=[];var e=undefined;for(var b in a.options){if(b=="Color"){e=a.dropdownSelector(b)}else{g.push(a.dropdownSelector(b))}}if(e!=undefined){g.push(e)}return Deal.DOM.div(null,g)},colorSelector:function(a){},dropdownSelector:function(f){var c=this;var h=[Deal.DOM.option(null,[""])];h[0].value="Select";h[0].text=window.gbResources.getString("csld-select");var b=[];for(var g in c.options[f]){b.push(g)}b.sort(c.numOrderAsc);if(c.dropDownOptions[f]==undefined){c.dropDownOptions[f]=[]}for(var e=0;e<b.length;e++){var d=Deal.DOM.option({value:b[e]},[b[e]]);h.push(d);c.dropDownOptions[f].push(d)}var a=c.selectors[f]||Deal.DOM.select(null,h);if(!c.selectors[f]){c.selectors[f]=a}c.selectionDropDownElements[f]=a;a.onchange=function(){c.selectionChange(f,c.selectors[f][a.selectedIndex].value,c.selectors[f][a.selectedIndex].text)};c.selection_span[f]=Deal.DOM.span({style:"color:#E47911"});return Deal.DOM.div({style:"margin-top: 10px"},[Deal.DOM.span({style:"font-weight: bold; font-size: 13px;"},[gbResources.getString("csld-common-select_key",{key:f}),c.selection_span[f]]),Deal.DOM.br(),a])},isCurrentlyValidOption:function(b,c){var a=this;if(a.validOptions&&a.validOptions[b]&&a.validOptions[b][c]==1){return true}return false},resetAllOtherOptions:function(d){var c=this;for(var b in c.selectionDropDownElements){if(b==d){continue}var a=c.selectionDropDownElements[b];if(a){a.selectedIndex=0;a.onchange()}}},selectionChange:function(c,d,e){var b=this;if(d!="Select"){var a=false;if(!b.isCurrentlyValidOption(c,e)){a=true}b.currentSelections[c]=e;b.selection[c]=e;jQuery(b.selection_span[c]).html(e);if(a){b.resetAllOtherOptions(c)}}else{delete b.currentSelections[c];delete b.selection[c];jQuery(b.selection_span[c]).html("")}b.asinsForSelection();b.updateDropDownStyles(c,e);b.update()},getAllCombinations:function(){var k=this;for(var d=0;d<k.deal.asins.length;d++){var c=k.deal.asins[d];var e=c.variationData;var b=k.getSortedKeys(e);var l=new Array();for(var f=0;f<b.length;f++){var j=b[f];var g=j+":"+e[j];l.push(g)}var a=k.combine(l);for(var f=0;f<a.length;f++){a[f]=a[f].join(";");var h=a[f];if(!k.allValidCombinations[h]){k.allValidCombinations[h]=new Array()}k.allValidCombinations[h].push(c)}}},numOrderAsc:function(d,c){var f=parseInt(d);var e=parseInt(c);if(isNaN(f)&&isNaN(e)){if(d>c){return 1}else{if(d<c){return -1}else{return 0}}}else{if(isNaN(f)){return 1}else{if(isNaN(e)){return -1}else{if(f>e){return 1}else{if(f<e){return -1}else{return 0}}}}}},getSortedKeys:function(c){var b=[];for(var a in c){b.push(a)}b.sort();return b},asinsForSelection:function(){var c=this;c.selectedAsins=[];for(var e=0;e<c.deal.asins.length;e++){var f=c.deal.asins[e];var d=true;for(var a in c.selection){if(f.variationData&&f.variationData[a]!=c.selection[a]){d=false;break}}if(d){c.selectedAsins.push(f)}}c.selectedAsins=c.uniqueAsinArray(c.selectedAsins);if(c.selectedAsins.length==1){c.selectedAsin=c.selectedAsins[0];c.selection={};for(var b in c.selectedAsin.variationData){c.selection[b]=c.selectedAsin.variationData[b]}c.updateSelection();if(c.selectedAsin.status.percentClaimed<100&&!c.selectedAsin.offerServiceSoldOut&&!c.deal.status.ended&&c.deal.status.percentClaimed<100){c.available=true}else{c.available=false}}else{c.selectedAsin=null;c.available=false;c.updateSelection()}},uniqueAsinArray:function(f){var j=this;var d={};var k=[];if(!f){return k}for(var e=0;e<f.length;e++){var c=f[e];var a=c.asin;d[a]=c}var b=j.getSortedKeys(d);for(var e=0;e<b.length;e++){var h=b[e];var g=d[h];k.push(g)}return k},updateSelection:function(){var b=this;for(var a in b.selection_span){if(b.selection[a]!=undefined){jQuery(b.selection_span[a]).html(b.selection[a])}else{jQuery(b.selection_span[a]).html("")}}for(var a in b.selectors){jQuery(b.selectors[a]).val(b.selection[a]||"")}},updateDropDownStyles:function(f,e){var d=this;d.getValidOptions();for(var c in d.dropDownOptions){for(var b=0;b<d.dropDownOptions[c].length;b++){var a=d.dropDownOptions[c][b];if(a==null){continue}var g=a.value||a.text;if((d.currentSelections.length<=1&&c==f&&g==e)||(d.validOptions[c]&&d.validOptions[c][g]==1)){a.setAttribute("style","color: #000000;");if(!a.value){a.style.setAttribute("color","#000000")}}else{a.setAttribute("style","color: #afafaf;");if(!a.value){a.style.setAttribute("color","#afafaf")}}}}},getValidOptions:function(){var b=this;b.validOptions={};b.selectableAsins=b.getSelectableAsins();for(var a=0;a<b.selectableAsins.length;a++){var c=b.selectableAsins[a];if(c==null){continue}for(var e in c.variationData){var d=c.variationData[e];if(b.validOptions[e]==undefined){b.validOptions[e]={}}b.validOptions[e][d]=1}}},getSelectableAsins:function(){var r=this;var n=[];var e=r.getSortedKeys(r.currentSelections);if(e.length==0){return r.selectedAsins}var s=[];for(var l=0;l<e.length;l++){var q=e[l];var o=r.currentSelections[q];var p=q+":"+o;s.push(p)}var k=e.length;var f=r.getSortedKeys(r.dropDownOptions);var d=f.length;if(k>=d){k=d-1}var c=r.getSelectionCombinations(s,k);var a={};for(var l=0;l<c.length;l++){var q=c[l];var m=r.allValidCombinations[q];if(m&&m.length>0){for(var h=0;h<m.length;h++){var g=m[h];if(g){var b=g.asin;a[b]=g}}}}var e=r.getSortedKeys(a);for(var l=0;l<e.length;l++){var q=e[l];var o=a[q];n.push(o)}return n},price:function(){var a=this;a.priceBlock=Deal.DOM.div({style:"margin-top: 10px"});a.updatePrice();return a.priceBlock},updatePrice:function(){var a=this;if(a.selectedAsin){a.updatePriceSingleAsin()}else{if(a.selectedAsins.length>1){a.updatePriceRange()}else{a.updatePriceNoAsins()}}},updatePriceSingleAsin:function(){var i=this;var d=this.selectedAsin;if(d.offerServiceSoldOut||!d.dealPrice||!d.dealPrice.price){i.updatePriceNoAsins();return}var a=d.basisPrice;var b=d.dealPrice;var g=Deal.Price.minus(a,b);var c=Deal.formatPricePercentage(d.percentOff);if(!c){c=Deal.formatPricePercentage(Deal.Price.percent_off(a,b))}var h=Deal.Price.format(a);var f=Deal.Price.format(b);var j=Deal.Price.format(g);var e=[];e.push(Deal.DOM.span({id:"list-price-popover",style:"font-size: 11px;color: #666666;text-decoration: line-through;"},[h]));e.push(" ");e.push(Deal.DOM.span({id:"deal-price-popover",style:"font-size: 13px;color: #990000;"},[f]));e.push(" ");e.push(Deal.DOM.span({id:"percent-off-popover",style:"font-size: 11px;color: #990000;"},[window.gbResources.getString("csld-percent_off",{discountPercentage:(c)})]));Deal.DOM.replaceChildren(i.priceBlock,e)},updatePriceRange:function(){var b=this;var e=null;var a=null;for(var d=0;d<b.selectedAsins.length;d++){var f=b.selectedAsins[d];if(f.status.percentClaimed>=100||f.offerServiceSoldOut||!f.dealPrice||!f.dealPrice.price){continue}var c=parseFloat(f.dealPrice.price);if(!a||c>parseFloat(a.price)){a=f.dealPrice}if(!e||c<parseFloat(e.price)){e=f.dealPrice}}if(!e||!a){b.updatePriceNoAsins()}else{if(e==a){Deal.DOM.replaceChildren(b.priceBlock,[Deal.DOM.span({style:"color:#900;font-size:13px"},[Deal.Price.format(e)])])}else{Deal.DOM.replaceChildren(b.priceBlock,[Deal.DOM.span({style:"color:#900;font-size:13px"},[Deal.Price.format(e),"-",Deal.Price.format(a)])])}}},updatePriceNoAsins:function(){var b=this;var c=[];for(var a in b.selection){c.push(Deal.DOM.span({style:"font-weight: bold"},[a,": ",Deal.DOM.span({style:"color:#B00"},[b.selection[a]])]));c.push(Deal.DOM.br())}},updateSelectionBoxes:function(){var b=this;var c=false;if(Deal.controller.buying[b.deal.dealID]){c=true}for(var d in b.selectors){var a=b.selectors[d];a.disabled=c}},buyButton:function(){var a=this;a.buy_button=Deal.DOM.img({style:"cursor:pointer;display: inline;",src:gbResources.getImage("add_to_cart")});a.buyButtonContainer=Deal.DOM.div({},a.buy_button);a.updateBuyButton();return a.buyButtonContainer},updateBuyButton:function(){var a=this;if(Deal.controller.buying[a.deal.dealID]){a.showBuying()}else{a.showBuyButton()}},showBuyButton:function(){var a=this;var d=Deal.getPurchaseState(null,a.selectedAsin);var c=null;var b=null;if(a.selectedAsin&&d==Deal.waitInLineStr){a.buy_button.src=gbResources.getImage("add_to_cart");a.buy_button.alt=window.gbResources.getString("csld-add_to_cart");a.buy_button.onclick=null;a.buy_button.style.opacity=0.5;a.buy_button.style.cursor="default";a.buy_button.style.filter="alpha(opacity=50)";b=Deal.DOM.div({style:"font-weight: bold;font-size: 11px;"},[window.gbResources.getString("gbd_this_option_waitlisted")])}else{if(a.selectedAsin&&d==Deal.inCartStr){if(a.selectedAsin.status.purchaseStatus.msToExpiry>0){a.buy_button.src=gbResources.getImage("add_to_cart");a.buy_button.alt=window.gbResources.getString("csld-add_to_cart");a.buy_button.onclick=null;a.buy_button.style.opacity=0.5;a.buy_button.style.cursor="default";a.buy_button.style.filter="alpha(opacity=50)";c=Deal.DOM.span({style:"font-weight: bold;font-size: 13px;"},[" "+window.gbResources.getString("gbd_in_your_cart")]);b=a.getStatusContent(false)}else{Deal.DOM.replaceChildren(a.buyButtonContainer,[Deal.DOM.img({id:"buying-"+a.deal.dealID,alt:window.gbResources.getString("csld-checking_deal_status"),style:"display: inline;",src:gbResources.getImage("spinner")}),Deal.DOM.span({style:"color: #E68221;font-weight: bold;font-size: 10px;"},[window.gbResources.getString("csld-checking_deal_status_alt")])]);a.buy_button.onclick=null;return}}else{if(a.selectedAsin&&a.available&&!Deal.isClaimed(null,a.selectedAsin)||(d==Deal.pendingAtcStr)){if(a.selectedAsin.status.purchaseStatus.msToExpiry>0||a.selectedAsin.status.purchaseStatus.state==Deal.expiredStr||a.selectedAsin.status.purchaseStatus.state==Deal.availableStr){a.buy_button.src=gbResources.getImage("add_to_cart");a.buy_button.alt=window.gbResources.getString("csld-add_to_cart");a.buy_button.style.opacity=1;a.buy_button.style.filter="alpha(opacity=100)";a.buy_button.style.cursor="pointer";if(d==Deal.pendingAtcStr){b=a.getStatusContent(true)}a.buy_button.onclick=function(e){if(e){e.stopPropagation();e.preventDefault()}Deal.controller.buy(a.widgetID,a.backboneDeal,a.selectedAsin.asin,false,"dealView",Deal.purchaseTypes.ADD_TO_CART);a.showBuying();a.updateSelectionBoxes();return false};if(a.selectedAsin.status.itemState!==undefined){if(a.selectedAsin.status.itemState!==Deal.itemStates.Available){a.buy_button.onclick=null;a.buy_button.style.opacity=0.5;a.buy_button.style.cursor="default";a.buy_button.style.filter="alpha(opacity=50)"}}}else{Deal.DOM.replaceChildren(a.buyButtonContainer,[Deal.DOM.img({id:"buying-"+a.deal.dealID,alt:window.gbResources.getString("csld-checking_deal_status"),style:"display: inline;",src:gbResources.getImage("spinner")}),Deal.DOM.span({style:"color: #E68221;font-weight: bold;font-size: 10px;"},[window.gbResources.getString("csld-checking_deal_status_alt")])]);a.buy_button.onclick=null;return}}else{if(a.selectedAsin&&a.selectedAsin.status.percentSoldOut!==100&&a.selectedAsin.status.percentClaimed>=100){a.buy_button.src=gbResources.getImage("join_waitlist");a.buy_button.alt=window.gbResources.getString("gbd_join_waitlist");if(a.selectedAsin.status.currentlyUnavailable){Deal.DOM.replaceChildren(a.buyButtonContainer,[Deal.DOM.span({style:"position:relative; font-size: 11px; color:#900;"},[window.gbResources.getString("gbd_waitlist_full")])]);a.buy_button.onclick=null;return}else{a.buy_button.style.opacity=1;a.buy_button.style.filter="alpha(opacity=100)";a.buy_button.style.cursor="pointer";a.buy_button.onclick=function(e){if(e){e.stopPropagation();e.preventDefault()}Deal.controller.buy(a.widgetID,a.backboneDeal,a.selectedAsin.asin,false,"dealView",Deal.purchaseTypes.JOIN_WAITLIST);a.showBuying();a.updateSelectionBoxes();return false}}}else{a.buy_button.src=gbResources.getImage("add_to_cart");a.buy_button.alt=window.gbResources.getString("csld-add_to_cart");a.buy_button.onclick=null;a.buy_button.style.opacity=0.5;a.buy_button.style.cursor="default";a.buy_button.style.filter="alpha(opacity=50)"}}}}Deal.DOM.replaceChildren(a.buyButtonContainer,[a.buy_button,c,b])},getStatusContent:function(d){var a=this;var c=null;if(a.deal.pStatus==undefined||a.deal.pStatus[a.selectedAsin.asin]==undefined){a.deal.pStatus=[];a.deal.pStatus[a.selectedAsin.asin]=new Deal.LegacyPStatus(a.deal)}var b=a.deal.pStatus[a.selectedAsin.asin];c=b.getTimerMessage(a.selectedAsin.asin,null,d);return c},showBuying:function(){var a=this;jQuery(a.statusBoxObject).css("padding-left",50);Deal.DOM.replaceChildren(a.buyButtonContainer,[Deal.DOM.img({id:"buying-"+a.deal.dealID,alt:window.gbResources.getString("csld-checking_deal_status"),style:"display: inline;",src:gbResources.getImage("spinner")}),Deal.DOM.span({style:"color: #E68221;font-weight: bold;font-size: 10px;"},[window.gbResources.getString("csld-checking_deal_status_alt")])]);a.buy_button.onclick=null},statusBox:function(){var a=this;a.statusBoxObject=Deal.DOM.span({style:"padding-left: 10px; font-weight: bold; font-size: 13px; position: relative; top: -18px; left: 100px;"},Deal.DOM.text(""));a.updateStatusBox();return a.statusBoxObject},updateStatusBox:function(){var a=this;var b="";if(a.selectedAsin!=undefined){if(Deal.inState(null,a.selectedAsin,Deal.claimedStr)){b=window.gbResources.getString("csld-claimed")}else{if(!Deal.inState(null,a.selectedAsin,Deal.pendingAtcStr)&&!Deal.inState(null,a.selectedAsin,Deal.inCartStr)&&!Deal.inState(null,a.selectedAsin,Deal.waitInLineStr)&&!Deal.inState(null,a.selectedAsin,Deal.availableStr)&&!Deal.inState(null,a.selectedAsin,Deal.expiredStr)&&!a.available){b=window.gbResources.getString("csld-sold_out")}}}a.statusBoxObject.innerHTML=b},combine:function(b){var e=function(i,h,a,g){if(i==0){if(a.length>0){g[g.length]=a}return}for(var f=0;f<h.length;f++){e(i-1,h.slice(f+1),a.concat([h[f]]),g)}return};var d=[];for(var c=0;c<b.length;c++){e(c,b,[],d)}d.push(b);return d}});
Deal.LegacyPStatus=Deal.Class({__init__:function(e){var b=this;b.deal=e;b.widget=e.widget;b.popover=e.popover;b.stateAsins={};for(var c=0;c<b.deal.asins.length;c++){var d=b.deal.asins[c];var a=Deal.getPurchaseState(e,d);if(b.stateAsins[a]==undefined){b.stateAsins[a]=[]}b.stateAsins[a].push(d)}if(b.stateAsins[Deal.inCartStr]){b.stateAsins[Deal.inCartStr].sort(b.sortByAsinTimes)}if(b.stateAsins[Deal.pendingAtcStr]){b.stateAsins[Deal.pendingAtcStr].sort(b.sortByAsinTimes)}},sortByAsinTimes:function(e,d){var c=e.status.purchaseStatus.expiresDate;var f=d.status.purchaseStatus.expiresDate;return c-f},getCount:function(c,a){var b=this;var d=new Date();var g=0;if(b.stateAsins[c]&&b.stateAsins[c].length){for(var f=0;f<b.stateAsins[c].length;f++){var e=b.stateAsins[c][f].status.purchaseStatus.expiresDate;if(e==undefined){e=d}if(a&&e.getTime()>d.getTime()){g++}else{if(!a){g++}}}}return g},getTime:function(f,e){var a=this;var b=new Date();if(a.stateAsins[e]){for(var d=0;d<a.stateAsins[e].length;d++){var c=a.stateAsins[e][d].status.purchaseStatus.expiresDate;if(f!=undefined){if(a.stateAsins[e][d].asin==f){return c}}else{if(c.getTime()>b.getTime()){a.asin=a.stateAsins[e][d];return c}}}}return null},getTimerMessage:function(d,g,c){var i=this;var f=null;if(d!=undefined&&d!=null){i.asinString=d}var a=Deal.inCartStr;if(c){a=Deal.pendingAtcStr}var h=i.getTime(i.asinString,a);var b=Deal.Timer(h,null,true);if(c){f=Deal.DOM.div({"class":"status_msg_content"},[gbResources.getString("gbd_deal_atc_time_part1")+" ",Deal.DOM.span({"class":"status_timer"},[b.span])," "+gbResources.getString("gbd_deal_atc_time_part2")?gbResources.getString("gbd_deal_atc_time_part2"):""])}else{var e=gbResources.getString("gbd_check_out_within_time_part2_single")!="null"?gbResources.getString("gbd_check_out_within_time_part2_single"):"";if(g!=null&&g>1){e=gbResources.getString("gbd_check_out_within_time_part2_plural")!="null"?gbResources.getString("gbd_check_out_within_time_part2_plural"):""}f=Deal.DOM.div({"class":"status_msg_content"},[gbResources.getString("gbd_check_out_within_time_part1")+" ",Deal.DOM.span({"class":"status_timer"},[b.span])," "+e])}return f},getItemMsg:function(d,f){var b=this;var a=window.gbResources.getString("gbd_deal_in_cart");var c=window.gbResources.getString("gbd_all_options_in_cart");if(f=="wait"){a=window.gbResources.getString("gbd_you_are_waitlisted");c=window.gbResources.getString("gbd_all_are_waitlisted")}var e=Deal.DOM.span({"class":"item_msg"},[a]);if(b.deal.asins.length>1){var g=null;if(d>1&&d==b.deal.asins.length){g=c}else{if(d==1){g=window.gbResources.getString("gbd_1_option_in_cart");if(f=="wait"){g=window.gbResources.getString("gbd_1_option_waitlisted")}}else{if(d>1){g=window.gbResources.getString("gbd_num_options_in_cart",{num:d});if(f=="wait"){g=window.gbResources.getString("gbd_num_options_in_waitlist",{num:d})}}}}jQuery(e).html(g)}return e},getMixedItemMsg:function(h,e){var i=this;var f=Deal.DOM.span({"class":"item_msg_normal"},[]);var g=Deal.DOM.span({},[Deal.DOM.span({style:"font-weight:bold;"},[h])," "+window.gbResources.getString("gbd_in_cart")+" "]);var c=Deal.DOM.span({},[Deal.DOM.span({style:"font-weight:bold;"},[e])," "+window.gbResources.getString("gbd_on_waitlist")]);var b=i.getTime(null,Deal.inCartStr);var a=Deal.Timer(b,null,true);var d=Deal.DOM.span({"class":"timer"},[Deal.DOM.span({style:"font-color:#666666 !important;"},[window.gbResources.getString("gbd_check_out_in")+" "]),Deal.DOM.span({"class":"status_timer"},[a.span])]);Deal.DOM.appendChildren(f,[g,d,Deal.DOM.br(),c]);return f},showBuying:function(){var a=this;Deal.DOM.replaceChildren(a.buyButtonContainer,[Deal.DOM.img({id:"buying-"+a.deal.dealID,alt:window.gbResources.getString("csld-checking_deal_status"),style:"display: inline;",src:gbResources.getImage("spinner")}),Deal.DOM.span({style:"color: #E68221;font-weight: bold;font-size: 10px;"},[window.gbResources.getString("csld-checking_deal_status_alt")])]);a.buy_button.onclick=null},getContent:function(){var h=this;var d=h.getCount(Deal.inCartStr,false);var f=h.getCount(Deal.inCartStr,true);var i=h.getCount(Deal.waitInLineStr,false);var a=h.getCount(Deal.pendingAtcStr,true);var g=h.getCount(Deal.pendingAtcStr,false);if(a>0){h.buy_button=Deal.DOM.img({style:"cursor:pointer;display: inline;",src:gbResources.getImage("add_to_cart")});h.buyButtonContainer=Deal.DOM.div({style:'opacity:1.0;filter:"alpha(opacity=100)"cursor:pointer'},[h.buy_button]);h.buy_button.onclick=function(j){if(j){j.stopPropagation();j.preventDefault()}h.widget.cx.buy(h.deal,h.asin.asin,true);h.showBuying();return false};var c=h.getTimerMessage(null,a,true);if(Deal.isPrimeEligible(h.deal)){if(gbResources.getCustomerData("realm")=="US"||(gbResources.getCustomerData("realm")!="US"&&gbResources.getCustomerData("isPrimeMember"))){h.deal.prime=Deal.DOM.span({style:"display:block; position:absolute; left: 115px;"},[Deal.DOM.img({alt:window.gbResources.getString("csld-prime_eligible_alt"),id:"prime-badge-"+h.deal.dealID,style:"display: inline;",src:gbResources.getImage("prime")})])}}return Deal.DOM.div({style:"position:relative;"},[h.deal.prime,Deal.DOM.div({style:"position:relative;"},[h.buyButtonContainer,c])])}else{if(d==0&&i==0&&g==0){return null}else{if(f==0&&i==0){return Deal.DOM.div({"class":"status_content"},[Deal.DOM.img({id:"buying-"+h.deal.dealID,alt:window.gbResources.getString("csld-checking_deal_status"),style:"display: inline;",src:gbResources.getImage("spinner")}),Deal.DOM.span({style:"color: #E68221;font-weight: bold;font-size: 10px;"},[window.gbResources.getString("csld-checking_deal_status_alt")])])}}}var e=null;var c=null;if(f>0&&i==0){e=h.getItemMsg(f,"cart");c=h.getTimerMessage(null,f,false)}else{if(i>0&&f==0){e=h.getItemMsg(i,"wait")}else{e=h.getMixedItemMsg(f,i)}}if(h.deal.asins.length>1&&!h.deal.status.ended){var b=null;b=Deal.DOM.span({"class":"options_link"},[window.gbResources.getString("gbd_select_more_options")]);if(!h.popOver){h.popOver=new Deal.VariationPopover(b,h.deal,h.widget.cx)}}return Deal.DOM.div({"class":"status_content"},[e,Deal.DOM.br(),c,b])}});
if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
(function(){var x=this;var t=x._;var b={};var j=Array.prototype,D=Object.prototype,G=Function.prototype;var v=j.slice,z=j.unshift,y=D.toString,p=D.hasOwnProperty;var n=j.forEach,i=j.map,B=j.reduce,e=j.reduceRight,m=j.filter,a=j.every,A=j.some,w=j.indexOf,f=j.lastIndexOf,c=Array.isArray,C=Object.keys,k=G.bind;var F=function(I){return new g(I)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=F}exports._=F}else{x._=F}F.VERSION="1.3.1";var d=F.each=F.forEach=function(N,M,L){if(N==null){return}if(n&&N.forEach===n){N.forEach(M,L)}else{if(N.length===+N.length){for(var K=0,I=N.length;K<I;K++){if(K in N&&M.call(L,N[K],K,N)===b){return}}}else{for(var J in N){if(F.has(N,J)){if(M.call(L,N[J],J,N)===b){return}}}}}};F.map=F.collect=function(L,K,J){var I=[];if(L==null){return I}if(i&&L.map===i){return L.map(K,J)}d(L,function(O,M,N){I[I.length]=K.call(J,O,M,N)});if(L.length===+L.length){I.length=L.length}return I};F.reduce=F.foldl=F.inject=function(M,L,I,K){var J=arguments.length>2;if(M==null){M=[]}if(B&&M.reduce===B){if(K){L=F.bind(L,K)}return J?M.reduce(L,I):M.reduce(L)}d(M,function(P,N,O){if(!J){I=P;J=true}else{I=L.call(K,I,P,N,O)}});if(!J){throw new TypeError("Reduce of empty array with no initial value")}return I};F.reduceRight=F.foldr=function(M,L,I,K){var J=arguments.length>2;if(M==null){M=[]}if(e&&M.reduceRight===e){if(K){L=F.bind(L,K)}return J?M.reduceRight(L,I):M.reduceRight(L)}var N=F.toArray(M).reverse();if(K&&!J){L=F.bind(L,K)}return J?F.reduce(N,L,I,K):F.reduce(N,L)};F.find=F.detect=function(L,K,J){var I;r(L,function(O,M,N){if(K.call(J,O,M,N)){I=O;return true}});return I};F.filter=F.select=function(L,K,J){var I=[];if(L==null){return I}if(m&&L.filter===m){return L.filter(K,J)}d(L,function(O,M,N){if(K.call(J,O,M,N)){I[I.length]=O}});return I};F.reject=function(L,K,J){var I=[];if(L==null){return I}d(L,function(O,M,N){if(!K.call(J,O,M,N)){I[I.length]=O}});return I};F.every=F.all=function(L,K,J){var I=true;if(L==null){return I}if(a&&L.every===a){return L.every(K,J)}d(L,function(O,M,N){if(!(I=I&&K.call(J,O,M,N))){return b}});return I};var r=F.some=F.any=function(L,K,J){K||(K=F.identity);var I=false;if(L==null){return I}if(A&&L.some===A){return L.some(K,J)}d(L,function(O,M,N){if(I||(I=K.call(J,O,M,N))){return b}});return !!I};F.include=F.contains=function(K,J){var I=false;if(K==null){return I}if(w&&K.indexOf===w){return K.indexOf(J)!=-1}I=r(K,function(L){return L===J});return I};F.invoke=function(J,K){var I=v.call(arguments,2);return F.map(J,function(L){return(F.isFunction(K)?K||L:L[K]).apply(L,I)})};F.pluck=function(J,I){return F.map(J,function(K){return K[I]})};F.max=function(L,K,J){if(!K&&F.isArray(L)){return Math.max.apply(Math,L)}if(!K&&F.isEmpty(L)){return -Infinity}var I={computed:-Infinity};d(L,function(P,M,O){var N=K?K.call(J,P,M,O):P;N>=I.computed&&(I={value:P,computed:N})});return I.value};F.min=function(L,K,J){if(!K&&F.isArray(L)){return Math.min.apply(Math,L)}if(!K&&F.isEmpty(L)){return Infinity}var I={computed:Infinity};d(L,function(P,M,O){var N=K?K.call(J,P,M,O):P;N<I.computed&&(I={value:P,computed:N})});return I.value};F.shuffle=function(K){var I=[],J;d(K,function(N,L,M){if(L==0){I[0]=N}else{J=Math.floor(Math.random()*(L+1));I[L]=I[J];I[J]=N}});return I};F.sortBy=function(K,J,I){return F.pluck(F.map(K,function(N,L,M){return{value:N,criteria:J.call(I,N,L,M)}}).sort(function(O,N){var M=O.criteria,L=N.criteria;return M<L?-1:M>L?1:0}),"value")};F.groupBy=function(K,L){var I={};var J=F.isFunction(L)?L:function(M){return M[L]};d(K,function(O,M){var N=J(O,M);(I[N]||(I[N]=[])).push(O)});return I};F.sortedIndex=function(N,M,K){K||(K=F.identity);var I=0,L=N.length;while(I<L){var J=(I+L)>>1;K(N[J])<K(M)?I=J+1:L=J}return I};F.toArray=function(I){if(!I){return[]}if(I.toArray){return I.toArray()}if(F.isArray(I)){return v.call(I)}if(F.isArguments(I)){return v.call(I)}return F.values(I)};F.size=function(I){return F.toArray(I).length};F.first=F.head=function(K,J,I){return(J!=null)&&!I?v.call(K,0,J):K[0]};F.initial=function(K,J,I){return v.call(K,0,K.length-((J==null)||I?1:J))};F.last=function(K,J,I){if((J!=null)&&!I){return v.call(K,Math.max(K.length-J,0))}else{return K[K.length-1]}};F.rest=F.tail=function(K,I,J){return v.call(K,(I==null)||J?1:I)};F.compact=function(I){return F.filter(I,function(J){return !!J})};F.flatten=function(J,I){return F.reduce(J,function(K,L){if(F.isArray(L)){return K.concat(I?L:F.flatten(L))}K[K.length]=L;return K},[])};F.without=function(I){return F.difference(I,v.call(arguments,1))};F.uniq=F.unique=function(M,L,K){var J=K?F.map(M,K):M;var I=[];F.reduce(J,function(N,P,O){if(0==O||(L===true?F.last(N)!=P:!F.include(N,P))){N[N.length]=P;I[I.length]=M[O]}return N},[]);return I};F.union=function(){return F.uniq(F.flatten(arguments,true))};F.intersection=F.intersect=function(J){var I=v.call(arguments,1);return F.filter(F.uniq(J),function(K){return F.every(I,function(L){return F.indexOf(L,K)>=0})})};F.difference=function(J){var I=F.flatten(v.call(arguments,1));return F.filter(J,function(K){return !F.include(I,K)})};F.zip=function(){var I=v.call(arguments);var L=F.max(F.pluck(I,"length"));var K=new Array(L);for(var J=0;J<L;J++){K[J]=F.pluck(I,""+J)}return K};F.indexOf=function(M,K,L){if(M==null){return -1}var J,I;if(L){J=F.sortedIndex(M,K);return M[J]===K?J:-1}if(w&&M.indexOf===w){return M.indexOf(K)}for(J=0,I=M.length;J<I;J++){if(J in M&&M[J]===K){return J}}return -1};F.lastIndexOf=function(K,J){if(K==null){return -1}if(f&&K.lastIndexOf===f){return K.lastIndexOf(J)}var I=K.length;while(I--){if(I in K&&K[I]===J){return I}}return -1};F.range=function(N,L,M){if(arguments.length<=1){L=N||0;N=0}M=arguments[2]||1;var J=Math.max(Math.ceil((L-N)/M),0);var I=0;var K=new Array(J);while(I<J){K[I++]=N;N+=M}return K};var h=function(){};F.bind=function H(L,J){var K,I;if(L.bind===k&&k){return k.apply(L,v.call(arguments,1))}if(!F.isFunction(L)){throw new TypeError}I=v.call(arguments,2);return K=function(){if(!(this instanceof K)){return L.apply(J,I.concat(v.call(arguments)))}h.prototype=L.prototype;var N=new h;var M=L.apply(N,I.concat(v.call(arguments)));if(Object(M)===M){return M}return N}};F.bindAll=function(J){var I=v.call(arguments,1);if(I.length==0){I=F.functions(J)}d(I,function(K){J[K]=F.bind(J[K],J)});return J};F.memoize=function(K,J){var I={};J||(J=F.identity);return function(){var L=J.apply(this,arguments);return F.has(I,L)?I[L]:(I[L]=K.apply(this,arguments))}};F.delay=function(J,K){var I=v.call(arguments,2);return setTimeout(function(){return J.apply(J,I)},K)};F.defer=function(I){return F.delay.apply(F,[I,1].concat(v.call(arguments,1)))};F.throttle=function(N,P){var L,I,O,M,K;var J=F.debounce(function(){K=M=false},P);return function(){L=this;I=arguments;var Q=function(){O=null;if(K){N.apply(L,I)}J()};if(!O){O=setTimeout(Q,P)}if(M){K=true}else{N.apply(L,I)}J();M=true}};F.debounce=function(I,K){var J;return function(){var N=this,M=arguments;var L=function(){J=null;I.apply(N,M)};clearTimeout(J);J=setTimeout(L,K)}};F.once=function(K){var I=false,J;return function(){if(I){return J}I=true;return J=K.apply(this,arguments)}};F.wrap=function(I,J){return function(){var K=[I].concat(v.call(arguments,0));return J.apply(this,K)}};F.compose=function(){var I=arguments;return function(){var J=arguments;for(var K=I.length-1;K>=0;K--){J=[I[K].apply(this,J)]}return J[0]}};F.after=function(J,I){if(J<=0){return I()}return function(){if(--J<1){return I.apply(this,arguments)}}};F.keys=C||function(K){if(K!==Object(K)){throw new TypeError("Invalid object")}var J=[];for(var I in K){if(F.has(K,I)){J[J.length]=I}}return J};F.values=function(I){return F.map(I,F.identity)};F.functions=F.methods=function(K){var J=[];for(var I in K){if(F.isFunction(K[I])){J.push(I)}}return J.sort()};F.extend=function(I){d(v.call(arguments,1),function(J){for(var K in J){I[K]=J[K]}});return I};F.defaults=function(I){d(v.call(arguments,1),function(J){for(var K in J){if(I[K]==null){I[K]=J[K]}}});return I};F.clone=function(I){if(!F.isObject(I)){return I}return F.isArray(I)?I.slice():F.extend({},I)};F.tap=function(J,I){I(J);return J};function E(L,K,J){if(L===K){return L!==0||1/L==1/K}if(L==null||K==null){return L===K}if(L._chain){L=L._wrapped}if(K._chain){K=K._wrapped}if(L.isEqual&&F.isFunction(L.isEqual)){return L.isEqual(K)}if(K.isEqual&&F.isFunction(K.isEqual)){return K.isEqual(L)}var O=y.call(L);if(O!=y.call(K)){return false}switch(O){case"[object String]":return L==String(K);case"[object Number]":return L!=+L?K!=+K:(L==0?1/L==1/K:L==+K);case"[object Date]":case"[object Boolean]":return +L==+K;case"[object RegExp]":return L.source==K.source&&L.global==K.global&&L.multiline==K.multiline&&L.ignoreCase==K.ignoreCase}if(typeof L!="object"||typeof K!="object"){return false}var P=J.length;while(P--){if(J[P]==L){return true}}J.push(L);var N=0,I=true;if(O=="[object Array]"){N=L.length;I=N==K.length;if(I){while(N--){if(!(I=N in L==N in K&&E(L[N],K[N],J))){break}}}}else{if("constructor" in L!="constructor" in K||L.constructor!=K.constructor){return false}for(var M in L){if(F.has(L,M)){N++;if(!(I=F.has(K,M)&&E(L[M],K[M],J))){break}}}if(I){for(M in K){if(F.has(K,M)&&!(N--)){break}}I=!N}}J.pop();return I}F.isEqual=function(J,I){return E(J,I,[])};F.isEmpty=function(J){if(F.isArray(J)||F.isString(J)){return J.length===0}for(var I in J){if(F.has(J,I)){return false}}return true};F.isElement=function(I){return !!(I&&I.nodeType==1)};F.isArray=c||function(I){return y.call(I)=="[object Array]"};F.isObject=function(I){return I===Object(I)};F.isArguments=function(I){return y.call(I)=="[object Arguments]"};if(!F.isArguments(arguments)){F.isArguments=function(I){return !!(I&&F.has(I,"callee"))}}F.isFunction=function(I){return y.call(I)=="[object Function]"};F.isString=function(I){return y.call(I)=="[object String]"};F.isNumber=function(I){return y.call(I)=="[object Number]"};F.isNaN=function(I){return I!==I};F.isBoolean=function(I){return I===true||I===false||y.call(I)=="[object Boolean]"};F.isDate=function(I){return y.call(I)=="[object Date]"};F.isRegExp=function(I){return y.call(I)=="[object RegExp]"};F.isNull=function(I){return I===null};F.isUndefined=function(I){return I===void 0};F.has=function(J,I){return p.call(J,I)};F.noConflict=function(){x._=t;return this};F.identity=function(I){return I};F.times=function(L,K,J){for(var I=0;I<L;I++){K.call(J,I)}};F.escape=function(I){return(""+I).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};F.mixin=function(I){d(F.functions(I),function(J){s(J,F[J]=I[J])})};var l=0;F.uniqueId=function(I){var J=l++;return I?I+J:J};F.templateSettings={evaluate:/<~([\s\S]+?)~>/g,interpolate:/\$\(([\s\S]+?)\)/g,escape:/~\$\(([\s\S]+?)\)/g};var u=/.^/;var q=function(I){return I.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};F.template=function(L,K){var M=F.templateSettings;var I="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+L.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(M.escape||u,function(N,O){return"',_.escape("+q(O)+"),'"}).replace(M.interpolate||u,function(N,O){return"',"+q(O)+",'"}).replace(M.evaluate||u,function(N,O){return"');"+q(O).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";var J=new Function("obj","_",I);if(K){return J(K,F)}return function(N){return J.call(this,N,F)}};F.chain=function(I){return F(I).chain()};var g=function(I){this._wrapped=I};F.prototype=g.prototype;var o=function(J,I){return I?F(J).chain():J};var s=function(I,J){g.prototype[I]=function(){var K=v.call(arguments);z.call(K,this._wrapped);return o(J.apply(F,K),this._chain)}};F.mixin(F);d(["pop","push","reverse","shift","sort","splice","unshift"],function(I){var J=j[I];g.prototype[I]=function(){var K=this._wrapped;J.apply(K,arguments);var L=K.length;if((I=="shift"||I=="splice")&&L===0){delete K[0]}return o(K,this._chain)}});d(["concat","join","slice"],function(I){var J=j[I];g.prototype[I]=function(){return o(J.apply(this._wrapped,arguments),this._chain)}});g.prototype.chain=function(){this._chain=true;return this};g.prototype.value=function(){return this._wrapped}}).call(this);
(function(){var n=this;var l=n.Backbone;var m=Array.prototype.slice;var u=Array.prototype.splice;var b;if(typeof exports!=="undefined"){b=exports}else{b=n.Backbone={}}b.VERSION="0.9.1";var v=n._;if(!v&&(typeof require!=="undefined")){v=require("underscore")}var e=n.jQuery||n.Zepto||n.ender;b.setDomLibrary=function(w){e=w};b.noConflict=function(){n.Backbone=l;return this};b.emulateHTTP=false;b.emulateJSON=false;b.Events={on:function(z,C,y){var A;z=z.split(/\s+/);var x=this._callbacks||(this._callbacks={});while(A=z.shift()){var B=x[A]||(x[A]={});var w=B.tail||(B.tail=B.next={});w.callback=C;w.context=y;B.tail=w.next={}}return this},off:function(y,B,x){var A,w,z;if(!y){delete this._callbacks}else{if(w=this._callbacks){y=y.split(/\s+/);while(A=y.shift()){z=w[A];delete w[A];if(!B||!z){continue}while((z=z.next)&&z.next){if(z.callback===B&&(!x||z.context===x)){continue}this.on(A,z.callback,z.context)}}}}return this},trigger:function(z){var D,C,y,x,w,B,A;if(!(y=this._callbacks)){return this}B=y.all;(z=z.split(/\s+/)).push(null);while(D=z.shift()){if(B){z.push({next:B.next,tail:B.tail,event:D})}if(!(C=y[D])){continue}z.push({next:C.next,tail:C.tail})}A=m.call(arguments,1);while(C=z.pop()){x=C.tail;w=C.event?[C.event].concat(A):A;while((C=C.next)!==x){C.callback.apply(C.context||this,w)}}return this}};b.Events.bind=b.Events.on;b.Events.unbind=b.Events.off;b.Model=function(w,x){var y;w||(w={});if(x&&x.parse){w=this.parse(w)}if(y=c(this,"defaults")){w=v.extend({},y,w)}if(x&&x.collection){this.collection=x.collection}this.attributes={};this._escapedAttributes={};this.cid=v.uniqueId("c");if(!this.set(w,{silent:true})){throw new Error("Can't create an invalid model")}delete this._changed;this._previousAttributes=v.clone(this.attributes);this.initialize.apply(this,arguments)};v.extend(b.Model.prototype,b.Events,{idAttribute:"id",initialize:function(){},toJSON:function(){return v.clone(this.attributes)},get:function(w){return this.attributes[w]},escape:function(w){var x;if(x=this._escapedAttributes[w]){return x}var y=this.attributes[w];return this._escapedAttributes[w]=v.escape(y==null?"":""+y)},has:function(w){return this.attributes[w]!=null},set:function(D,C,F){var E,B,y;if(v.isObject(D)||D==null){E=D;F=C}else{E={};E[D]=C}F||(F={});if(!E){return this}if(E instanceof b.Model){E=E.attributes}if(F.unset){for(B in E){E[B]=void 0}}if(!this._validate(E,F)){return false}if(this.idAttribute in E){this.id=E[this.idAttribute]}var x=this.attributes;var w=this._escapedAttributes;var z=this._previousAttributes||{};var A=this._setting;this._changed||(this._changed={});this._setting=true;for(B in E){y=E[B];if(!v.isEqual(x[B],y)){delete w[B]}F.unset?delete x[B]:x[B]=y;if(this._changing&&!v.isEqual(this._changed[B],y)){this.trigger("change:"+B,this,y,F);this._moreChanges=true}delete this._changed[B];if(!v.isEqual(z[B],y)||(v.has(x,B)!=v.has(z,B))){this._changed[B]=y}}if(!A){if(!F.silent&&this.hasChanged()){this.change(F)}this._setting=false}return this},unset:function(w,x){(x||(x={})).unset=true;return this.set(w,null,x)},clear:function(w){(w||(w={})).unset=true;return this.set(v.clone(this.attributes),w)},fetch:function(x){x=x?v.clone(x):{};var w=this;var y=x.success;x.success=function(B,z,A){if(!w.set(w.parse(B,A),x)){return false}if(y){y(w,B)}};x.error=b.wrapError(x.error,w,x);return(this.sync||b.sync).call(this,"read",this,x)},save:function(B,A,F){var C,z;if(v.isObject(B)||B==null){C=B;F=A}else{C={};C[B]=A}F=F?v.clone(F):{};if(F.wait){z=v.clone(this.attributes)}var x=v.extend({},F,{silent:true});if(C&&!this.set(C,F.wait?x:F)){return false}var y=this;var D=F.success;F.success=function(J,G,I){var H=y.parse(J,I);if(F.wait){H=v.extend(C||{},H)}if(!y.set(H,F)){return false}if(D){D(y,J)}else{y.trigger("sync",y,J,F)}};F.error=b.wrapError(F.error,y,F);var w=this.isNew()?"create":"update";var E=(this.sync||b.sync).call(this,w,this,F);if(F.wait){this.set(z,x)}return E},destroy:function(x){x=x?v.clone(x):{};var w=this;var A=x.success;var z=function(){w.trigger("destroy",w,w.collection,x)};if(this.isNew()){return z()}x.success=function(B){if(x.wait){z()}if(A){A(w,B)}else{w.trigger("sync",w,B,x)}};x.error=b.wrapError(x.error,w,x);var y=(this.sync||b.sync).call(this,"delete",this,x);if(!x.wait){z()}return y},url:function(){var w=c(this.collection,"url")||c(this,"urlRoot")||p();if(this.isNew()){return w}return w+(w.charAt(w.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(x,w){return x},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(x){if(this._changing||!this.hasChanged()){return this}this._changing=true;this._moreChanges=true;for(var w in this._changed){this.trigger("change:"+w,this,this._changed[w],x)}while(this._moreChanges){this._moreChanges=false;this.trigger("change",this,x)}this._previousAttributes=v.clone(this.attributes);delete this._changed;this._changing=false;return this},hasChanged:function(w){if(!arguments.length){return !v.isEmpty(this._changed)}return this._changed&&v.has(this._changed,w)},changedAttributes:function(y){if(!y){return this.hasChanged()?v.clone(this._changed):false}var A,z=false,x=this._previousAttributes;for(var w in y){if(v.isEqual(x[w],(A=y[w]))){continue}(z||(z={}))[w]=A}return z},previous:function(w){if(!arguments.length||!this._previousAttributes){return null}return this._previousAttributes[w]},previousAttributes:function(){return v.clone(this._previousAttributes)},isValid:function(){return !this.validate(this.attributes)},_validate:function(y,x){if(x.silent||!this.validate){return true}y=v.extend({},this.attributes,y);var w=this.validate(y,x);if(!w){return true}if(x&&x.error){x.error(this,w,x)}else{this.trigger("error",this,w,x)}return false}});b.Collection=function(x,w){w||(w={});if(w.comparator){this.comparator=w.comparator}this._reset();this.initialize.apply(this,arguments);if(x){this.reset(x,{silent:true,parse:w.parse})}};v.extend(b.Collection.prototype,b.Events,{model:b.Model,initialize:function(){},toJSON:function(){return this.map(function(w){return w.toJSON()})},add:function(x,F){var B,D,z,C,E,y,A={},w={};F||(F={});x=v.isArray(x)?x.slice():[x];for(B=0,z=x.length;B<z;B++){if(!(C=x[B]=this._prepareModel(x[B],F))){throw new Error("Can't add an invalid model to a collection")}if(A[E=C.cid]||this._byCid[E]||(((y=C.id)!=null)&&(w[y]||this._byId[y]))){throw new Error("Can't add the same model to a collection twice")}A[E]=w[y]=C}for(B=0;B<z;B++){(C=x[B]).on("all",this._onModelEvent,this);this._byCid[C.cid]=C;if(C.id!=null){this._byId[C.id]=C}}this.length+=z;D=F.at!=null?F.at:this.models.length;u.apply(this.models,[D,0].concat(x));if(this.comparator){this.sort({silent:true})}if(F.silent){return this}for(B=0,z=this.models.length;B<z;B++){if(!A[(C=this.models[B]).cid]){continue}F.index=B;C.trigger("add",C,this,F)}return this},remove:function(B,z){var A,w,y,x;z||(z={});B=v.isArray(B)?B.slice():[B];for(A=0,w=B.length;A<w;A++){x=this.getByCid(B[A])||this.get(B[A]);if(!x){continue}delete this._byId[x.id];delete this._byCid[x.cid];y=this.indexOf(x);this.models.splice(y,1);this.length--;if(!z.silent){z.index=y;x.trigger("remove",x,this,z)}this._removeReference(x)}return this},get:function(w){if(w==null){return null}return this._byId[w.id!=null?w.id:w]},getByCid:function(w){return w&&this._byCid[w.cid||w]},at:function(w){return this.models[w]},sort:function(x){x||(x={});if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}var w=v.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(w)}else{this.models.sort(w)}if(!x.silent){this.trigger("reset",this,x)}return this},pluck:function(w){return v.map(this.models,function(x){return x.get(w)})},reset:function(z,x){z||(z=[]);x||(x={});for(var y=0,w=this.models.length;y<w;y++){this._removeReference(this.models[y])}this._reset();this.add(z,{silent:true,parse:x.parse});if(!x.silent){this.trigger("reset",this,x)}return this},fetch:function(w){w=w?v.clone(w):{};if(w.parse===undefined){w.parse=true}var y=this;var x=w.success;w.success=function(B,z,A){y[w.add?"add":"reset"](y.parse(B,A),w);if(x){x(y,B)}};w.error=b.wrapError(w.error,y,w);return(this.sync||b.sync).call(this,"read",this,w)},create:function(x,w){var y=this;w=w?v.clone(w):{};x=this._prepareModel(x,w);if(!x){return false}if(!w.wait){y.add(x,w)}var z=w.success;w.success=function(A,C,B){if(w.wait){y.add(A,w)}if(z){z(A,C)}else{A.trigger("sync",x,C,w)}};x.save(null,w);return x},parse:function(x,w){return x},chain:function(){return v(this.models).chain()},_reset:function(w){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(y,x){if(!(y instanceof b.Model)){var w=y;x.collection=this;y=new this.model(w,x);if(!y._validate(y.attributes,x)){y=false}}else{if(!y.collection){y.collection=this}}return y},_removeReference:function(w){if(this==w.collection){delete w.collection}w.off("all",this._onModelEvent,this)},_onModelEvent:function(y,x,z,w){if((y=="add"||y=="remove")&&z!=this){return}if(y=="destroy"){this.remove(x,w)}if(x&&y==="change:"+x.idAttribute){delete this._byId[x.previous(x.idAttribute)];this._byId[x.id]=x}this.trigger.apply(this,arguments)}});var s=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];v.each(s,function(w){b.Collection.prototype[w]=function(){return v[w].apply(v,[this.models].concat(v.toArray(arguments)))}});b.Router=function(w){w||(w={});if(w.routes){this.routes=w.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var g=/:\w+/g;var t=/\*\w+/g;var d=/[-[\]{}()+?.,\\^$|#\s]/g;v.extend(b.Router.prototype,b.Events,{initialize:function(){},route:function(w,x,y){b.history||(b.history=new b.History);if(!v.isRegExp(w)){w=this._routeToRegExp(w)}if(!y){y=this[x]}b.history.route(w,v.bind(function(A){var z=this._extractParameters(w,A);y&&y.apply(this,z);this.trigger.apply(this,["route:"+x].concat(z));b.history.trigger("route",this,x,z)},this));return this},navigate:function(x,w){b.history.navigate(x,w)},_bindRoutes:function(){if(!this.routes){return}var x=[];for(var y in this.routes){x.unshift([y,this.routes[y]])}for(var z=0,w=x.length;z<w;z++){this.route(x[z][0],x[z][1],this[x[z][1]])}},_routeToRegExp:function(w){w=w.replace(d,"\\$&").replace(g,"([^/]+)").replace(t,"(.*?)");return new RegExp("^"+w+"$")},_extractParameters:function(w,x){return w.exec(x).slice(1)}});b.History=function(){this.handlers=[];v.bindAll(this,"checkUrl")};var k=/^[#\/]/;var h=/msie [\w.]+/;var j=false;v.extend(b.History.prototype,b.Events,{interval:50,getFragment:function(x,w){if(x==null){if(this._hasPushState||w){x=window.location.pathname;var y=window.location.search;if(y){x+=y}}else{x=window.location.hash}}x=decodeURIComponent(x);if(!x.indexOf(this.options.root)){x=x.substr(this.options.root.length)}return x.replace(k,"")},start:function(y){if(j){throw new Error("Backbone.history has already been started")}this.options=v.extend({},{root:"/"},this.options,y);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var x=this.getFragment();var w=document.documentMode;var A=(h.exec(navigator.userAgent.toLowerCase())&&(!w||w<=7));if(A){this.iframe=e('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(x)}if(this._hasPushState){e(window).bind("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!A){e(window).bind("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=x;j=true;var B=window.location;var z=B.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!z){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&z&&B.hash){this.fragment=B.hash.replace(k,"");window.history.replaceState({},document.title,B.protocol+"//"+B.host+this.options.root+this.fragment)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){e(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);j=false},route:function(w,x){this.handlers.unshift({route:w,callback:x})},checkUrl:function(x){var w=this.getFragment();if(w==this.fragment&&this.iframe){w=this.getFragment(this.iframe.location.hash)}if(w==this.fragment||w==decodeURIComponent(this.fragment)){return false}if(this.iframe){this.navigate(w)}this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(y){var x=this.fragment=this.getFragment(y);var w=v.any(this.handlers,function(z){if(z.route.test(x)){z.callback(x);return true}});return w},navigate:function(x,w){if(!j){return false}if(!w||w===true){w={trigger:w}}var y=(x||"").replace(k,"");if(this.fragment==y||this.fragment==decodeURIComponent(y)){return}if(this._hasPushState){if(y.indexOf(this.options.root)!=0){y=this.options.root+y}this.fragment=y;window.history[w.replace?"replaceState":"pushState"]({},document.title,y)}else{if(this._wantsHashChange){this.fragment=y;this._updateHash(window.location,y,w.replace);if(this.iframe&&(y!=this.getFragment(this.iframe.location.hash))){if(!w.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,y,w.replace)}}else{window.location.assign(this.options.root+x)}}if(w.trigger){this.loadUrl(x)}},_updateHash:function(w,x,y){if(y){w.replace(w.toString().replace(/(javascript:|#).*$/,"")+"#"+x)}else{w.hash=x}}});b.View=function(w){this.cid=v.uniqueId("view");this._configure(w||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var a=/^(\S+)\s*(.*)$/;var q=["model","collection","el","id","attributes","className","tagName"];v.extend(b.View.prototype,b.Events,{tagName:"div",$:function(w){return this.$el.find(w)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(x,w,z){var y=document.createElement(x);if(w){e(y).attr(w)}if(z){e(y).html(z)}return y},setElement:function(w,x){if(e===undefined){b.setDomLibrary(window.jQuery)}this.$el=e(w);this.el=this.$el[0];if(x!==false){this.delegateEvents()}return this},delegateEvents:function(A){if(!(A||(A=c(this,"events")))){return}this.undelegateEvents();for(var z in A){var B=A[z];if(!v.isFunction(B)){B=this[A[z]]}if(!B){throw new Error('Event "'+A[z]+'" does not exist')}var y=z.match(a);var x=y[1],w=y[2];B=v.bind(B,this);x+=".delegateEvents"+this.cid;if(w===""){this.$el.bind(x,B)}else{this.$el.delegate(w,x,B)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(y){if(this.options){y=v.extend({},this.options,y)}for(var z=0,x=q.length;z<x;z++){var w=q[z];if(y[w]){this[w]=y[w]}}this.options=y},_ensureElement:function(){if(!this.el){var w=c(this,"attributes")||{};if(this.id){w.id=this.id}if(this.className){w["class"]=this.className}this.setElement(this.make(this.tagName,w),false)}else{this.setElement(this.el,false)}}});var r=function(w,x){var y=i(this,w,x);y.extend=this.extend;return y};b.Model.extend=b.Collection.extend=b.Router.extend=b.View.extend=r;var o={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(A,x,w){var y=o[A];var z={type:y,dataType:"json"};if(!w.url){z.url=c(x,"url")||p()}if(!w.data&&x&&(A=="create"||A=="update")){z.contentType="application/json";z.data=JSON.stringify(x.toJSON())}if(b.emulateJSON){z.contentType="application/x-www-form-urlencoded";z.data=z.data?{model:z.data}:{}}if(b.emulateHTTP){if(y==="PUT"||y==="DELETE"){if(b.emulateJSON){z.data._method=y}z.type="POST";z.beforeSend=function(B){B.setRequestHeader("X-HTTP-Method-Override",y)}}}if(z.type!=="GET"&&!b.emulateJSON){z.processData=false}return e.ajax(v.extend(z,w))};b.wrapError=function(x,y,w){return function(z,A){A=z===y?A:z;if(x){x(y,A,w)}else{y.trigger("error",y,A,w)}}};var f=function(){};var i=function(x,w,y){var z;if(w&&w.hasOwnProperty("constructor")){z=w.constructor}else{z=function(){x.apply(this,arguments)}}v.extend(z,x);f.prototype=x.prototype;z.prototype=new f();if(w){v.extend(z.prototype,w)}if(y){v.extend(z,y)}z.prototype.constructor=z;z.__super__=x.prototype;return z};var c=function(w,x){if(!(w&&w[x])){return null}return v.isFunction(w[x])?w[x]():w[x]};var p=function(){throw new Error('A "url" property or function must be specified')}}).call(this);
(function(){var a=function(b){(function(l,f){if(l.fn.dotdotdot){return}l.fn.dotdotdot=function(z){if(this.length==0){l.fn.dotdotdot.debug('No element found for "'+this.selector+'".');return this}if(this.length>1){return this.each(function(){l(this).dotdotdot(z)})}var v=this;if(v.data("dotdotdot")){v.trigger("destroy.dot")}v.data("dotdotdot-style",v.attr("style")||"");v.css("word-wrap","break-word");if(v.css("white-space")==="nowrap"){v.css("white-space","normal")}v.bind_events=function(){v.bind("update.dot",function(C,E){C.preventDefault();C.stopPropagation();x.maxHeight=(typeof x.height=="number")?x.height:s(v);x.maxHeight+=x.tolerance;if(typeof E!="undefined"){if(typeof E=="string"||E instanceof HTMLElement){E=l("<div />").append(E).contents()}if(E instanceof l){A=E}}w=v.wrapInner('<div class="dotdotdot" />').children();w.contents().detach().end().append(A.clone(true)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var D=false,B=false;if(u.afterElement){D=u.afterElement.clone(true);D.show();u.afterElement.detach()}if(o(w,x)){if(x.wrap=="children"){B=e(w,x,D)}else{B=q(w,v,w,x,D)}}w.replaceWith(w.contents());w=null;if(l.isFunction(x.callback)){x.callback.call(v[0],B,A)}u.isTruncated=B;return B}).bind("isTruncated.dot",function(C,B){C.preventDefault();C.stopPropagation();if(typeof B=="function"){B.call(v[0],u.isTruncated)}return u.isTruncated}).bind("originalContent.dot",function(C,B){C.preventDefault();C.stopPropagation();if(typeof B=="function"){B.call(v[0],A)}return A}).bind("destroy.dot",function(B){B.preventDefault();B.stopPropagation();v.unwatch().unbind_events().contents().detach().end().append(A).attr("style",v.data("dotdotdot-style")||"").data("dotdotdot",false)});return v};v.unbind_events=function(){v.unbind(".dot");return v};v.watch=function(){v.unwatch();if(x.watch=="window"){var D=l(window),C=D.width(),B=D.height();D.bind("resize.dot"+u.dotId,function(){if(C!=D.width()||B!=D.height()||!x.windowResizeFix){C=D.width();B=D.height();if(t){clearInterval(t)}t=setTimeout(function(){v.trigger("update.dot")},10)}})}else{y=n(v);t=setInterval(function(){var E=n(v);if(y.width!=E.width||y.height!=E.height){v.trigger("update.dot");y=n(v)}},100)}return v};v.unwatch=function(){l(window).unbind("resize.dot"+u.dotId);if(t){clearInterval(t)}return v};var A=v.contents(),x=l.extend(true,{},l.fn.dotdotdot.defaults,z),u={},y={},t=null,w=null;if(!(x.lastCharacter.remove instanceof Array)){x.lastCharacter.remove=l.fn.dotdotdot.defaultArrays.lastCharacter.remove}if(!(x.lastCharacter.noEllipsis instanceof Array)){x.lastCharacter.noEllipsis=l.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis}u.afterElement=d(x.after,v);u.isTruncated=false;u.dotId=p++;v.data("dotdotdot",true).bind_events().trigger("update.dot");if(x.watch){v.watch()}return v};l.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:true,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:false,windowResizeFix:true};l.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","\u3000",",",";",".","!","?"],noEllipsis:[]}};l.fn.dotdotdot.debug=function(t){};var p=1;function e(w,A,z){var y=w.children(),t=false;w.empty();for(var v=0,u=y.length;v<u;v++){var x=y.eq(v);w.append(x);if(z){w.append(z)}if(o(w,A)){x.remove();t=true;break}else{if(z){z.detach()}}}return t}function q(t,u,z,y,x){if(!t.contents().length){return false}var w="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style";var v="script";t.contents().detach().each(function(C){var D=this,B=l(D),A=D.nodeType===3?g:q;if(typeof D=="undefined"||(D.nodeType==3&&l.trim(D.data).length==0)){return}t.append(B);if(B.is(v)){return}if(x){t[t.is(w)?"after":"append"](x)}if(!o(z,y)){return}if(A.call(this,B,u,z,y,x)){return false}B.detach();return false});return true}function g(v,x,I,y,u){var F=v[0];if(!F){return false}var B=k(F),t=(B.indexOf(" ")!==-1)?" ":"\u3000",D=(y.wrap=="letter")?"":t,G=B.split(D),C=-1,J=-1,E=0,w=G.length-1;if(y.fallbackToLetter&&E==0&&w==0){D="";G=B.split(D);w=G.length-1}while(E<=w&&!(E==0&&w==0)){var z=Math.floor((E+w)/2);if(z==J){break}J=z;c(F,G.slice(0,J+1).join(D)+y.ellipsis);if(!o(I,y)){C=J;E=J}else{w=J;if(y.fallbackToLetter&&E==0&&w==0){D="";G=G[0].split(D);C=-1;J=-1;E=0;w=G.length-1}}}if(C!=-1&&!(G.length==1&&G[0].length==0)){B=i(G.slice(0,C+1).join(D),y);c(F,B)}else{var A=v.parent();v.detach();var H=(u&&u.closest(A).length)?u.length:0;if(A.contents().length>H){F=h(A.contents().eq(-1-H),x)}else{F=h(A,x,true);if(!H){A.detach()}}if(F){B=i(k(F),y);c(F,B);if(H&&u){l(F).parent().append(u)}}}return true}function o(u,t){return u.innerHeight()>t.maxHeight}function i(t,u){while(l.inArray(t.slice(-1),u.lastCharacter.remove)>-1){t=t.slice(0,-1)}if(l.inArray(t.slice(-1),u.lastCharacter.noEllipsis)<0){t+=u.ellipsis}return t}function n(t){return{width:t.innerWidth(),height:t.innerHeight()}}function c(u,t){if(u.innerText){u.innerText=t}else{if(u.nodeValue){u.nodeValue=t}else{if(u.textContent){u.textContent=t}}}}function k(t){if(t.innerText){return t.innerText}else{if(t.nodeValue){return t.nodeValue}else{if(t.textContent){return t.textContent}else{return""}}}}function m(t){do{t=t.previousSibling}while(t&&t.nodeType!==1&&t.nodeType!==3);return t}function h(u,x,t){var w=u&&u[0],v;if(w){if(!t){if(w.nodeType===3){return w}if(l.trim(u.text())){return h(u.contents().last(),x)}}v=m(w);while(!v){u=u.parent();if(u.is(x)||!u.length){return false}v=m(u[0])}if(v){return h(l(v),x)}}return false}function d(t,u){if(!t){return false}if(typeof t==="string"){t=l(t,u);return(t.length)?t:false}return !t.jquery?false:t}function s(w){var x=w.innerHeight(),v=["paddingTop","paddingBottom"];for(var y=0,u=v.length;y<u;y++){var t=parseInt(w.css(v[y]),10);if(isNaN(t)){t=0}x-=t}return x}var r=l.fn.html;l.fn.html=function(t){if(t!=f&&!l.isFunction(t)&&this.data("dotdotdot")){return this.trigger("update",[t])}return r.apply(this,arguments)};var j=l.fn.text;l.fn.text=function(t){if(t!=f&&!l.isFunction(t)&&this.data("dotdotdot")){t=l("<div />").text(t).html();return this.trigger("update",[t])}return j.apply(this,arguments)}})(b||window.jQuery)};if(window.P&&window.P.AUI_BUILD_DATE){P.when("A").execute(function(b){a(b.$)})}else{window.amznJQ&&amznJQ.available("jQuery",function(){a($)})}})();
var WidgetGroup=Backbone.Model.extend({widgetIds:[],initialize:function(d,b,c){if(b===undefined||!b){throw new Error("Cannot create a WidgetGroup without a name")}var a=this;a.widgetGroupId=d;a.widgetGroupName=b;a.widgetCount=parseInt(c,10);if(a.widgetCount<=0){a.widgetCount=1}},registerWidget:function(b){if(b===undefined||b===null){Deal.log("WidgetGroup:registerWidget() Invalid widgetId.");return}var a=this;a.widgetIds.push(b)},isWidgetGroupReady:function(){var b=this;var a=false;if(b.widgetIds.length>=b.widgetCount){a=true}return a},getWidgetIds:function(){var a=this;return a.widgetIds},getWidgetGroupParams:function(){var b=this;var d={};for(var a=0;a<b.widgetIds.length;a++){var c=b.widgetIds[a];var e=Deal.controller.getWidgetParams(c);if(e){d=Deal.MergeMaps(d,e)}}return d},getWidgetGroupTotalPageSize:function(){var c=this;var a=0;for(var b=0;b<c.widgetIds.length;b++){var d=c.widgetIds[b];if(b==c.widgetIds.length-1&&!Deal.controller.disablePagination[d]){a+=Deal.controller.cells[d]*2}else{a+=Deal.controller.cells[d]}}return a},processMetadata:function(a){var e=this;var b=e.widgetIds.sort();for(var d=0;d<b.length;d++){var c=b[d];var f=Deal.controller.cells[c];if(d==b.length-1&&!Deal.controller.disablePagination[c]){f*=2}var g={};jQuery.extend(g,a);if(d<b.length-1||Deal.controller.disablePagination[c]){var h=Deal.controller.dealTypeFilter[c];if(h!==null&&h!==undefined){g.sortedDealIDs=Deal.trimSortedDealIDs(a.sortedDealIDs,h,[],a.dealsByType);g.sortedDealIDs=g.sortedDealIDs.splice(0,f);a.sortedDealIDs=_.difference(a.sortedDealIDs,g.sortedDealIDs)}else{g.sortedDealIDs=a.sortedDealIDs.splice(0,f)}}Deal.controller.trigger("selectdeals_change"+c,g)}}});
var WidgetGroupManager=Backbone.Model.extend({nextWidgetGroupId:200,widgetGroupNameToIdMap:{},signalsToCallback:{process_group_metadata:"processMetadata"},initialize:function(){this.widgetGroups={}},initializeWidgetGroupSignals:function(d){var a=this;var f=a.getWidgetGroup(d);for(var e in a.signalsToCallback){var c=a.signalsToCallback[e];var b=f[c];if(b){f.on(e,b)}}},registerWidgetGroup:function(b,c){var a=this;var d=-1;if(a.widgetGroupNameToIdMap[b]===null||a.widgetGroupNameToIdMap[b]===undefined){var d=a.nextWidgetGroupId;a.widgetGroups[d]=new WidgetGroup(d,b,c);a.widgetGroupNameToIdMap[b]=d;a.initializeWidgetGroupSignals(d);a.nextWidgetGroupId=a.nextWidgetGroupId+1}else{d=a.widgetGroupNameToIdMap[b]}return d},registerWidget:function(c,b){if(c===null||c===undefined){Deal.log("WidgetGroupManager:registerWidget() Invalid widgetID.");return}if(b===null||b===undefined){Deal.log("WidgetGroupManager:registerWidget() Invalid widgetGroupName.");return}var a=this;var d=a.widgetGroupNameToIdMap[b];if(d==-1){Deal.log("WidgetGroupManager : WidgetGroup is not yet registered. "+b);return -1}else{var e=a.widgetGroups[d];e.registerWidget(c)}return d},getWidgetGroup:function(b){var a=this;var c=a.widgetGroups[b];return c}});
(function(){var a={generateTemplate:function(b,c){if(typeof b!=="function"){Deal.log("generateTemplate called with non-function compiledTemplate");return""}return b({data:c})},convertNameToKey:function(e){var f=e.split("/");var b=f.pop();var c=f.pop();var d=f.pop();d=d.replace(/\-/g,"_");return[d,c,b].join("_")}};if(typeof window!=="undefined"){window.Deal=window.Deal||{};window.Deal.Templates=_.defaults(window.Deal.Templates||{},a)}if(typeof module!=="undefined"&&module.exports){module.exports=a}}());
this.DealTemplates=this.DealTemplates||{},this.DealTemplates.single_deal_large_widget_skin=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var gbContentClass="",gbwshovelerPaginatedClass="";if(data.disablePagination||(gbContentClass="gbwcontPaginated",gbwshovelerPaginatedClass="gbwshovelerPaginated"),__p+='\n<div id="sdl-main" class="gbwcont '+(null==(__t=gbContentClass)?"":__t)+' gbwcontminwidth">\n<div class="gbwshoveler '+(null==(__t=gbwshovelerPaginatedClass)?"":__t)+'" >\n<div class="sdl-maincontent">\n<div class="gbh2 gbWidgetTitle"></div>\n',data.showNoDealsMessage){print(data.no_deals_message)}else{var dealViewID=data.widgetID+"_dealView0";__p+="\n<div id='"+(null==(__t=dealViewID)?"":__t)+'\' class="gbhero"></div>\n',data.showLoadingTemplate&&print(data.widget_loading)}__p+="\n</div>\n",data.disablePagination||(__p+='\n<div class=\'back-button\' id="leftShovel">\n<a title="',print(gbResources.getString("shvl-button-back_46731")),__p+='" style="" href="#" onclick="return false;" class="">\n<span id="leftShovelBg" class="bg-image" title="',print(gbResources.getString("shvl-button-back_46731")),__p+='"></span>\n</a>\n</div>\n<div class=\'next-button\' id="rightShovel">\n<a title="',print(gbResources.getString("shvl-button-next_46730")),__p+='" style="" href="#" onclick="return false;" class="">\n<span id="rightShovelBg" class="bg-image" title="',print(gbResources.getString("shvl-button-next_46730")),__p+='"></span>\n</a>\n</div>\n'),__p+="\n</div>\n</div>\n",(!data.disablePagination||!data.disableRestrictionsApply||data.customSeeMoreString&&data.seeMoreURL)&&(__p+="\n<div id=\"dealPaginationContent\" class='gbwpagcont'></div>\n")}return __p},this.DealTemplates.default_widget_page_number=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var gbrestrictionsClass="gbrestrictions";data.disableRestrictionsApply&&(gbrestrictionsClass="hidegbrestrictions");var gbseemoreClass="hidegbwleftpagination";data.customSeeMoreString&&data.seeMoreURL&&(gbseemoreClass="gbwleftpagination");var paginationClass="gbwpagination";data.disablePagination&&(paginationClass="hidegbwpagination"),__p+='\n<div id="dealSeeMore" class=\''+(null==(__t=gbseemoreClass)?"":__t)+'\'>\n<span id="leftcaratSeeMore" class="caratseemore">&rsaquo;</span>\n<a href=\''+(null==(__t=data.seeMoreURL)?"":__t)+"'>\n",print(data.customSeeMoreString),__p+='\n</a>\n</div>\n<div id="dealRestrictionsApply" class=\''+(null==(__t=gbrestrictionsClass)?"":__t)+"' >\n<a href='"+(null==(__t=data.restrictionsApplyURL)?"":__t)+"'>\n",print(gbResources.getString("csld-restrictions_apply")),__p+='\n</a>\n</div>\n<div id="dealPage" class=\''+(null==(__t=paginationClass)?"":__t)+"'>\n",print(gbResources.getString("csld-cat-current_page1")),__p+='\n<span id="dealCurrentPage">'+(null==(__t=data.currentPage)?"":__t)+"</span>\n",print(gbResources.getString("csld-cat-current_page2")),__p+='\n<span id="dealTotalPages">'+(null==(__t=data.totalPages)?"":__t)+"</span>\n",print(gbResources.getString("csld-cat-current_page3")),__p+='\n</div>\n<div style="clear:both;"></div>'}return __p},this.DealTemplates.single_deal_large_widget_no_deals_message=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj){__p+='<div class="center_align_nodeals">\n'+(null==(__t=data.noDealsMessage)?"":__t)+"\n</div>"}return __p},this.DealTemplates.single_deal_large_widget_widget_loading=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div class="center_align">\n<img src=\'',print(gbResources.getImage("loading")),__p+="' alt=\"",print(gbResources.getString("csld-loading_alt")),__p+='" />\n</div>'}return __p},this.DealTemplates.single_deal_large_deal_available=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var hideActionDiv=Deal.isSingleAsinWithNoAction(data),checkingDealStatus=!1;void 0!==data.checkingDealStatus&&null!==data.checkingDealStatus&&(checkingDealStatus=data.checkingDealStatus);var gbfeaturedealPaginatedClass="",gbfeaturedealPaddingClass="";data.disablePagination||(gbfeaturedealPaginatedClass="gbfeaturedealPaginated",jQuery.browser.msie||(gbfeaturedealPaddingClass="gbfeaturedealPadding")),__p+="\n"+(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div class="gbfeaturedeal '+(null==(__t=gbfeaturedealPaginatedClass)?"":__t)+" "+(null==(__t=gbfeaturedealPaddingClass)?"":__t)+'">\n'+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div id="dealJumpbar" class="gbjumpbar">\n'+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.share_bar)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+'\n</div>\n<div class="gbcopy">\n'+(null==(__t=data.generatedTemplates.description)?"":__t)+"\n</div>\n"+(null==(__t=data.generatedTemplates.price_block)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.fast_track)?"":__t)+"\n",data.isPrimeOnlyDotd&&!gbResources.customerData.hasEarlyAccessBenefit&&(__p+='\n<div  id="prime_exclusive_message" class="miniText">\n',print(gbResources.getString("gb_prime_only_access_dotd_message")),__p+="\n</div>\n"),__p+="\n",data.dealType==Deal.dealTypes.LOCAL&&(__p+="\n"+(null==(__t=data.generatedTemplates.geo_display_location)?"":__t)+"\n"),0==hideActionDiv||checkingDealStatus?(__p+='\n<div id="dealActionContent" class="actioncont floatl">\n',__p+=checkingDealStatus?"\n"+(null==(__t=data.generatedTemplates.checking_deal_status)?"":__t)+"\n":"\n"+(null==(__t=data.generatedTemplates.button)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime_only_access)?"":__t)+"\n",__p+="\n</div>\n"):__p+="\n<br/>\n",__p+='\n<div class="gbdealtypecont floatl">\n',checkingDealStatus||(__p+='\n<div id="dealStateContent" class="dealtypecont">\n',void 0!==data.stateDisplayData&&null!==data.stateDisplayData&&1==data.stateDisplayData.hasActionableStatus?__p+="\n"+(null==(__t=data.generatedTemplates.state)?"":__t)+"\n":(__p+="\n",__p+=data.dealType!=Deal.dealTypes.LD||data.isPrimeOnlyDotd?'\n<div class="ldtimercont"></div>\n':"\n"+(null==(__t=data.generatedTemplates.progress_bar)?"":__t)+"\n",__p+='\n<div id="dealTimerContent" class="ldtimertxt">\n',data.dealType!=Deal.dealTypes.LD||data.isPrimeOnlyDotd||(__p+="\n"+(null==(__t=data.generatedTemplates.percent_claimed)?"":__t)+"\n"),__p+="\n"+(null==(__t=data.generatedTemplates.time_remaining)?"":__t)+"\n</div>\n"),__p+="\n</div>\n"),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_description=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){if(void 0!==data.dealDescription&&null!==data.dealDescription){var fixedPaginatedCLass="",escapedDescription=Deal.escapeHtml(data.dealDescription);data.disablePagination||(fixedPaginatedCLass="upcomingdescPaginated"),__p+='\n<div id="dealDescription" class="upcomingdesc '+(null==(__t=fixedPaginatedCLass)?"":__t)+'">\n<span id="dealDescriptionText">'+(null==(__t=escapedDescription)?"":__t)+"</span>\n";var readMoreLabel=gbResources.getString("mp_detail-top-auction-read-more-link_11436");if("US"!==gbResources.getCustomerData("realm")){__p+='\n<a id="dealDescriptionReadMore"  title="'+(null==(__t=escapedDescription)?"":__t)+'">\n'+(null==(__t=readMoreLabel)?"":__t)+"\n</a>\n"}else{var refTaggedURL=data.discussionBoardURL;data.dealID;var refTags=null;data.refTags&&data.refTags.discussion_board&&(refTags=data.refTags.discussion_board),(data.dealType==Deal.dealTypes.LOCAL||data.dealType==Deal.dealTypes.COUPON)&&(refTaggedURL=data.detailPageLink,data.refTags&&data.refTags.image&&(refTags=data.refTags.image)),void 0!==refTaggedURL&&null!==refTaggedURL&&data.dealState!=Deal.stateToTemplateMap[Deal.dealStates.UPCOMING]&&(refTags&&(refTaggedURL=Deal.ref_tag_appender(refTaggedURL,data.dealID,refTags,data.amabotParams)),__p+='\n<a id="dealDescriptionReadMore" href=\''+(null==(__t=refTaggedURL)?"":__t)+'\' class="gbreadmore commentsLink">\n'+(null==(__t=readMoreLabel)?"":__t)+"\n</a>\n")}__p+="\n</div>\n"}}return __p},this.DealTemplates.single_deal_large_deal_upcoming=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var gbfeaturedealPaginatedClass="",gbfeaturedealPaddingClass="";data.disablePagination||(gbfeaturedealPaginatedClass="gbfeaturedealPaginated",jQuery.browser.msie||(gbfeaturedealPaddingClass="gbfeaturedealPadding")),__p+="\n"+(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div class="gbfeaturedeal '+(null==(__t=gbfeaturedealPaginatedClass)?"":__t)+" "+(null==(__t=gbfeaturedealPaddingClass)?"":__t)+'">\n<div id="dealUpcomingMessage" class="upcomingtitle">\n',print(gbResources.getString("csld-upcoming")),__p+="\n</div>\n"+(null==(__t=data.generatedTemplates.teaser)?"":__t)+'\n<div class="gbcopy faded">\n'+(null==(__t=data.generatedTemplates.description)?"":__t)+"\n</div>\n"+(null==(__t=data.generatedTemplates.starts_in)?"":__t)+"\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_image=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var fadedClass="",imageDivClass="",imageClass="";data.dealState==Deal.stateToTemplateMap.ComingSoon||data.dealState==Deal.stateToTemplateMap.SoldOut?fadedClass="faded":data.disablePagination||(imageClass="prodimgPaginated"),data.disablePagination||(imageDivClass="imgcontPaginated"),__p+='\n<div id="dealImageContent" class="gbfeaturedealimg imgcont '+(null==(__t=imageDivClass)?"":__t)+" floatl "+(null==(__t=fadedClass)?"":__t)+'">\n<div class="prodimg '+(null==(__t=imageClass)?"":__t)+'">\n';var refTaggedURL=null,landingPageURL=data.detailPageLink,imageURL=data.imageURL,upcoming=!1,addAnchorLink=!0,imageResolution=200;data.inDiscussionBoard&&(imageResolution=250),"upcoming"==data.dealState&&(upcoming=!0,void 0!==data.teaserLine&&null!==data.teaserLine&&""!=data.teaserLine&&(imageURL=gbResources.getImage("hero_upcoming"),addAnchorLink=!1,data.teaserImage&&(imageURL=data.teaserImage,data.teaserURL&&(addAnchorLink=!0,landingPageURL=data.teaserURL))),imageURL==gbResources.getImage("no_image")&&(imageURL=gbResources.getImage("hero_upcoming"))),data.refTags&&data.refTags.image&&landingPageURL&&(refTaggedURL=Deal.ref_tag_appender(landingPageURL,data.dealID,data.refTags.image,data.amabotParams)),void 0!==imageURL&&null!==imageURL&&(imageURL=Deal.resizeImage(imageURL,imageResolution)),refTaggedURL||(addAnchorLink=!1),addAnchorLink&&(__p+="\n<a href= "+(null==(__t=refTaggedURL)?"":__t)+' class="imageLink">\n'),__p+='\n<img id="dealImage" src = '+(null==(__t=imageURL)?"":__t)+" />\n",addAnchorLink&&(__p+="\n</a>\n"),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_starts_in=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj){__p+='<div id="timerContent" class="marginTop '+(null==(__t=data.alertTxt)?"":__t)+'">\n<span> '+(null==(__t=data.timerPrecedingString)?"":__t)+' </span>\n<span id="'+(null==(__t=data.timerSpanID)?"":__t)+'">'+(null==(__t=data.timeOrDateString)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_teaser=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var teaserTitle=data.teaserLine||data.dealTitle,teaserTitleTruncated=Deal.truncate_description(teaserTitle,500),escapedTeaserTitle=Deal.escapeHtml(teaserTitle),escapedTeaserTitleTruncated=Deal.escapeHtml(teaserTitleTruncated);__p+='\n<div id="dealTeaser" title="'+(null==(__t=escapedTeaserTitle)?"":__t)+'" class="upcomingdesc">\n<span id="dealTeaserSpan">'+(null==(__t=escapedTeaserTitleTruncated)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_claimed=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div id="dealClaimedMessage" class="claimed">\n',print(gbResources.getString("csld-claimed")),__p+="\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_geo_display_location=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){if(null!==data.geoDisplayName&&void 0!==data.geoDisplayName){var escapedGeoDisplayName=Deal.escapeHtml(data.geoDisplayName);__p+='\n<div id="dealGeoDisplayName" class="gbgeodisplayname" title="'+(null==(__t=escapedGeoDisplayName)?"":__t)+'">\n'+(null==(__t=escapedGeoDisplayName)?"":__t)+"\n</div>\n"}}return __p},this.DealTemplates.single_deal_large_deal_expired=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var hideActionDiv=Deal.isSingleAsinWithNoAction(data),checkingDealStatus=!1;void 0!==data.checkingDealStatus&&null!==data.checkingDealStatus&&(checkingDealStatus=data.checkingDealStatus);var gbfeaturedealPaginatedClass="",gbfeaturedealPaddingClass="";if(data.disablePagination||(gbfeaturedealPaginatedClass="gbfeaturedealPaginated",jQuery.browser.msie||(gbfeaturedealPaddingClass="gbfeaturedealPadding")),__p+="\n"+(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div class="gbfeaturedeal '+(null==(__t=gbfeaturedealPaginatedClass)?"":__t)+" "+(null==(__t=gbfeaturedealPaddingClass)?"":__t)+'">\n'+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div id="dealJumpbar" class="gbjumpbar">\n'+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+'\n</div>\n<div class="gbcopy">\n'+(null==(__t=data.generatedTemplates.description)?"":__t)+"\n</div>\n"+(null==(__t=data.generatedTemplates.price_block)?"":__t)+"\n",data.dealType==Deal.dealTypes.LOCAL&&(__p+="\n"+(null==(__t=data.generatedTemplates.geo_display_location)?"":__t)+"\n"),0==hideActionDiv||checkingDealStatus?(__p+='\n<div id="dealActionContent" class="actioncont floatl">\n',__p+=checkingDealStatus?"\n"+(null==(__t=data.generatedTemplates.checking_deal_status)?"":__t)+"\n":"\n"+(null==(__t=data.generatedTemplates.button)?"":__t)+"\n",__p+="\n</div>\n"):__p+="\n<br/>\n",__p+='\n<div class="gbdealtypecont floatl">\n',!checkingDealStatus){if(__p+='\n<div id="dealStateContent" class="dealtypecont">\n',void 0!==data.stateDisplayData&&null!==data.stateDisplayData&&1==data.stateDisplayData.hasActionableStatus){__p+="\n"+(null==(__t=data.generatedTemplates.state)?"":__t)+"\n"}else{__p+="\n",__p+=data.dealType==Deal.dealTypes.LD?"\n"+(null==(__t=data.generatedTemplates.progress_bar)?"":__t)+"\n":'\n<div class="ldtimercont"></div>\n',__p+='\n<div id="dealTimerContent" class="ldtimertxt">\n';var timerpadClass="";data.dealType==Deal.dealTypes.LD&&(timerpadClass="ldtimerpad",__p+="\n"+(null==(__t=data.generatedTemplates.percent_claimed)?"":__t)+"\n"),__p+='\n<div id="dealClosedMessage" class="ldtimeleft expired '+(null==(__t=timerpadClass)?"":__t)+'">',print(gbResources.getString("csld-deal_over")),__p+="</div>\n</div>\n"}__p+="\n</div>\n"}__p+="\n</div>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_share_bar=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var spanId="share_bar-sdl_"+data.dealID;__p+="\n<span id="+(null==(__t=spanId)?"":__t)+">\n",null!==data.swfContents&&void 0!==data.swfContents&&data.dealType==Deal.dealTypes.DOTD&&(__p+='\n<span class="bylinepipe">|</span>\n<span id="gbShareFeature" class="gbsharefeature">\n</span>\n'),__p+="\n</span>"}return __p},this.DealTemplates.single_deal_large_deal_prime=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var spanId="prime-sdl_"+data.dealID;__p+="\n";var imageId="prime-img"+data.dealID;__p+="\n<span id="+(null==(__t=spanId)?"":__t)+' class="prime">\n',data.isPrimeEligible&&(__p+='\n<span class="bylinepipe">|</span>\n<img src = ',print(gbResources.getImage("prime")),__p+=" id = "+(null==(__t=imageId)?"":__t)+" />\n"),__p+="\n</span>"}return __p},this.DealTemplates.single_deal_large_deal_deal_loading=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div class="dealLoading">\n<img src=\'',print(gbResources.getImage("loading")),__p+="' alt=\"",print(gbResources.getString("csld-loading_alt")),__p+='" />\n</div>'}return __p},this.DealTemplates.single_deal_large_deal_title=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var refTaggedURL=data.detailPageLink;data.refTags&&data.refTags.title&&data.detailPageLink&&(refTaggedURL=Deal.ref_tag_appender(data.detailPageLink,data.dealID,data.refTags.title,data.amabotParams));var escapedTitle=Deal.escapeHtml(data.dealTitle);__p+='\n<div id="dealTitle" class="title gbh3">\n<a id="dealTitleLink" href='+(null==(__t=refTaggedURL)?"":__t)+' title="'+(null==(__t=escapedTitle)?"":__t)+'" class="titleLink">\n'+(null==(__t=escapedTitle)?"":__t)+"\n</a>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_checking_deal_status=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div id="gbCheckingDealStatus">\n<img src=\'',print(gbResources.getImage("spinner")),__p+="' />\n<span>",print(gbResources.getString("csld-checking_deal_status_alt")),__p+="</span>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_progress_bar=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var pcntClaimedFormatted=data.percentClaimed+"%",statebarClass="ld-one",progbarClass="progbar",progbartickClass="progbartick";data.dealState==data.stateToTemplateMap.Expired||data.dealState==data.stateToTemplateMap.SoldOut?(statebarClass="ld-four",progbarClass="progbarmissed",progbartickClass="progbartickmissed"):statebarClass=data.percentClaimed<51?"ld-one":data.percentClaimed<76?"ld-two":"ld-three",__p+='\n<div class="ldtimercont">\n<div class="statebar '+(null==(__t=statebarClass)?"":__t)+'"></div>\n<div class="'+(null==(__t=progbarClass)?"":__t)+'" style="width:'+(null==(__t=pcntClaimedFormatted)?"":__t)+'"></div>\n<div class="'+(null==(__t=progbartickClass)?"":__t)+'" style="width:'+(null==(__t=pcntClaimedFormatted)?"":__t)+'"></div>\n</div>'}return __p},this.DealTemplates.single_deal_large_deal_state=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var timerSpanID=data.dealID+"_state_timer",pendingAtc=!1,inCart=!1,inCartCount=0,inWaitlist=!1,inWaitlistCount=0,checkoutUrl="/gp/cart/view.html";void 0!==data.stateDisplayData[Deal.inCartStr]&&null!==data.stateDisplayData[Deal.inCartStr]&&data.stateDisplayData[Deal.inCartStr].length>0&&(inCart=!0,inCartCount=data.stateDisplayData[Deal.inCartStr].length),void 0!==data.stateDisplayData[Deal.pendingAtcStr]&&null!==data.stateDisplayData[Deal.pendingAtcStr]&&data.stateDisplayData[Deal.pendingAtcStr].length>0&&(pendingAtc=!0),void 0!==data.stateDisplayData[Deal.waitInLineStr]&&null!==data.stateDisplayData[Deal.waitInLineStr]&&data.stateDisplayData[Deal.waitInLineStr].length>0&&(inWaitlist=!0,inWaitlistCount=data.stateDisplayData[Deal.waitInLineStr].length);var importantState="Available",message="";if(pendingAtc){importantState=Deal.PendingAddToCart,data.stateDisplayData[Deal.pendingAtcStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.pendingAtcStr].timerObject.spanID=timerSpanID,message=gbResources.getString("gbd_deal_atc_time_part1")+'  <span class="gbcheckouttime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.pendingAtcStr].timerObject.timeString+"</span> ",message+=gbResources.getString("gbd_deal_atc_time_part2")?gbResources.getString("gbd_deal_atc_time_part2"):""}else{if(inCart&&!inWaitlist){importantState=Deal.inCartStr,message="<b>",data.itemType==Deal.itemTypes.MultiItem?inCartCount>1&&inCartCount==data.stateDisplayData.totalAsins?message+=gbResources.getString("gbd_all_options_in_cart"):1==inCartCount?message+=gbResources.getString("gbd_1_option_in_cart"):inCartCount>1&&(message+=gbResources.getString("gbd_num_options_in_cart",{num:inCartCount})):message+=gbResources.getString("gbd_deal_in_cart"),message+="</b><br/>"+gbResources.getString("gb_you_have")+' <span class="gbcheckouttime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.inCartStr].timerObject.timeString+"</span> "+gbResources.getString("gb_left_to")+' <a href="'+checkoutUrl+'">'+gbResources.getString("gbd-checkout")+"</a>",data.stateDisplayData[Deal.inCartStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.inCartStr].timerObject.spanID=timerSpanID}else{if(inWaitlist&&!inCart){importantState=Deal.waitInLineStr,message="<b>",1==inWaitlistCount?message+=data.itemType==Deal.itemTypes.MultiItem?gbResources.getString("gbd_1_option_waitlisted"):gbResources.getString("gbd_you_are_waitlisted"):inWaitlistCount>1&&inWaitlistCount==data.stateDisplayData.totalAsins?message+=gbResources.getString("gbd_all_are_waitlisted"):inWaitlistCount>1&&(message+=gbResources.getString("gbd_num_options_in_waitlist",{num:inWaitlistCount})),message+="</b>"}else{if(inWaitlist&&inCart){data.stateDisplayData[Deal.inCartStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.inCartStr].timerObject.spanID=timerSpanID,importantState=Deal.waitInLineStr+" & "+Deal.inCartStr;var inCartStr="<b>"+inCartCount+" "+gbResources.getString("gbd_in_cart")+"</b> ";inCartStr+=gbResources.getString("gb_you_have")+' <span class="gbcheckouttime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.inCartStr].timerObject.timeString+"</span> "+gbResources.getString("gb_left_to")+' <a href="'+checkoutUrl+'">'+gbResources.getString("gbd-checkout")+"</a>";var inWaitlistStr="<b>";inWaitlistStr+=inWaitlistCount+" "+gbResources.getString("gbd_on_waitlist"),inWaitlistStr+="</b>",message=inCartStr+"<br/>"+inWaitlistStr}}}}__p+='\n<div class="dealtypecont">\n'+(null==(__t=message)?"":__t)+"\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_soldout=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var hideActionDiv=Deal.isSingleAsinWithNoAction(data),checkingDealStatus=!1;void 0!==data.checkingDealStatus&&null!==data.checkingDealStatus&&(checkingDealStatus=data.checkingDealStatus);var gbfeaturedealPaginatedClass="",gbfeaturedealPaddingClass="";data.disablePagination||(gbfeaturedealPaginatedClass="gbfeaturedealPaginated",jQuery.browser.msie||(gbfeaturedealPaddingClass="gbfeaturedealPadding")),__p+="\n"+(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div class="gbfeaturedeal '+(null==(__t=gbfeaturedealPaginatedClass)?"":__t)+" "+(null==(__t=gbfeaturedealPaddingClass)?"":__t)+'">\n'+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div id="dealJumpbar" class="gbjumpbar">\n'+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+'\n</div>\n<div class="gbcopy faded">\n'+(null==(__t=data.generatedTemplates.description)?"":__t)+'\n</div>\n<div class="gbpriceblock boldtext">\n',print(gbResources.getString("csld-sold_out")),__p+="\n</div>\n",data.dealType==Deal.dealTypes.LOCAL&&(__p+="\n"+(null==(__t=data.generatedTemplates.geo_display_location)?"":__t)+"\n"),0==hideActionDiv||checkingDealStatus?(__p+='\n<div id="dealActionContent" class="actioncont floatl">\n',__p+=checkingDealStatus?"\n"+(null==(__t=data.generatedTemplates.checking_deal_status)?"":__t)+"\n":"\n"+(null==(__t=data.generatedTemplates.button)?"":__t)+"\n",__p+="\n</div>\n"):__p+="\n<br/>\n",__p+='\n<div class="gbdealtypecont floatl">\n',checkingDealStatus||(__p+='\n<div id="dealStateContent" class="dealtypecont">\n',void 0!==data.stateDisplayData&&null!==data.stateDisplayData&&1==data.stateDisplayData.hasActionableStatus?__p+="\n"+(null==(__t=data.generatedTemplates.state)?"":__t)+"\n":(__p+="\n",__p+=data.dealType==Deal.dealTypes.LD?"\n"+(null==(__t=data.generatedTemplates.progress_bar)?"":__t)+"\n":'\n<div class="ldtimercont"></div>\n',__p+='\n<div id="dealTimerContent" class="ldtimertxt">\n',data.dealType==Deal.dealTypes.LD&&(__p+="\n"+(null==(__t=data.generatedTemplates.percent_claimed)?"":__t)+"\n"),__p+="\n</div>\n"),__p+="\n</div>\n"),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_reviews=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(data.reviews&&data.reviews.stars){var reviewStars=data.reviews.stars,halfStarName=reviewStars.hasHalfStar?"5":"0",starsImg=gbResources.getImage("stars_"+reviewStars.fullStars+"_"+halfStarName),refTaggedURL=data.detailPageLink;data.refTags&&data.refTags.reviews&&data.reviews.reviewsURL&&(refTaggedURL=Deal.ref_tag_appender(data.reviews.reviewsURL,data.dealID,data.refTags.reviews,data.amabotParams)),__p+='\n<span id="dealRatingAndCount" class="ratingcontainer">',reviewStars.fullStars?__p+='\n<a id="dealRating" href= '+(null==(__t=refTaggedURL)?"":__t)+' class="reviewsLink">\n<img src = '+(null==(__t=starsImg)?"":__t)+' />\n</a>\n<a id="dealReviewsCount" class="gbox-small reviewsLink" href= '+(null==(__t=refTaggedURL)?"":__t)+">\n("+(null==(__t=data.reviews.count)?"":__t)+")\n</a>":(__p+="\n<a href="+(null==(__t=refTaggedURL)?"":__t)+' class="reviewsLink">\n',print(gbResources.getString("csld_add_a_review")),__p+="\n</a>"),__p+="\n</span>"}}return __p},this.DealTemplates.single_deal_large_deal_percent_claimed=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div id="dealPercentClaimed" class="ldclaimed">\n',print(gbResources.getString("csld-pct_claimed_hero",{percentClaimed:data.percentClaimed})),__p+="\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_coming_soon=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var gbfeaturedealPaginatedClass="",gbfeaturedealPaddingClass="";data.disablePagination||(gbfeaturedealPaginatedClass="gbfeaturedealPaginated",jQuery.browser.msie||(gbfeaturedealPaddingClass="gbfeaturedealPadding")),__p+="\n"+(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div class="gbfeaturedeal '+(null==(__t=gbfeaturedealPaginatedClass)?"":__t)+" "+(null==(__t=gbfeaturedealPaddingClass)?"":__t)+'">\n'+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div id="dealJumpbar" class="gbjumpbar">\n'+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.share_bar)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+'\n</div>\n<div class="gbcopy faded">\n'+(null==(__t=data.generatedTemplates.description)?"":__t)+'\n</div>\n<div class="gbpriceblock boldtext">\n',print(gbResources.getString("gbd_coming_soon")),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_time_remaining=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var timerpadClass=data.dealType!==Deal.dealTypes.LD||data.isPrimeOnlyDotd?"":"ldtimerpad";__p+='\n<div id="dealTimeRemaining" class="ldtimeleft '+(null==(__t=timerpadClass)?"":__t)+" "+(null==(__t=data.alertTxt)?"":__t)+'">\n<span> '+(null==(__t=data.timerPrecedingString)?"":__t)+" </span>\n",data.showEarlyAccessTimer&&(__p+="\n<br/>\n"),__p+='\n<span id="'+(null==(__t=data.timerSpanID)?"":__t)+'">'+(null==(__t=data.timeOrDateString)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.single_deal_large_deal_price_block=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(data.breaksMAP||data.marketingMessage||data.dealPrice){if(__p+='\n<div class="gbpriceblock">\n<div id="dealPriceBlock" class="gbpriceblock floatl">\n',1==data.breaksMAP){__p+='\n<span id="dealBreaksMapMsg" class="breaksMapMsg"><b>',print(gbResources.getString("gbd_add-to-cart-to-see-price")),__p+="</b></span>\n"}else{if(data.marketingMessage){__p+='\n<span id="dealMarketingMessage" class="marketingmessage"><b>'+(null==(__t=data.marketingMessage)?"":__t)+"</b></span>\n"}else{var originalPrice=null,dealPrice=data.dealPrice.min.formattedPrice;data.dealPrice.isRange===!0&&(dealPrice+=" - "+data.dealPrice.max.formattedPrice),data.originalPrice&&data.originalPrice.isRange===!1&&data.dealPrice.isRange===!1&&0!==data.originalPrice.min.price&&data.dealPrice.min.price<data.originalPrice.min.price&&(originalPrice=data.originalPrice.min.formattedPrice),dealPrice&&(originalPrice&&!data.hidePercentOff&&(__p+='\n<span id="dealCompPrice" class="listprice">'+(null==(__t=originalPrice)?"":__t)+"</span>\n"),__p+='\n<span id="dealDealPrice"><b>'+(null==(__t=dealPrice)?"":__t)+"</b></span>\n",data.discountPercentage&&!data.hidePercentOff&&(__p+='\n<span id="dealPercentOff">',print(gbResources.getString("csld-percent_off",{discountPercentage:data.discountPercentage})),__p+="</span>\n"))}}__p+="\n</div>\n</div>\n"}}return __p},this.DealTemplates.single_deal_large_deal_fast_track=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var spanId="fastTrack_"+data.dealID;__p+="\n<span id="+(null==(__t=spanId)?"":__t)+">\n",null!==data.fastTrackMessage&&void 0!==data.fastTrackMessage&&data.dealType==Deal.dealTypes.DOTD&&(__p+='\n<span id="fastTrackMessage" class="fastTrackMessage floatl" style="padding-top:5px;padding-bottom:10px">\n</span>\n'),__p+="\n</span>"}return __p},this.DealTemplates.single_deal_large_deal_button=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){var buttonImg=null,buttonAltText="",dealStatusMessage=null,cursorClass="";switch(data.purchaseState){case data.DealStateEnum.Available:buttonImg=gbResources.getImage("add_to_cart"),buttonAltText=gbResources.getString("csld-add_to_cart");break;case data.DealStateEnum.Variation:buttonImg=gbResources.getImage("select_options"),buttonAltText=gbResources.getString("csld-select_options_alt");break;case data.DealStateEnum.LearnMore:buttonImg=gbResources.getImage("learn_more_medium"),buttonAltText=gbResources.getString("csld-learn_more");break;case data.DealStateEnum.ViewDeal:buttonImg=gbResources.getImage("view_deal"),buttonAltText=gbResources.getString("csld-view_deal");break;case data.DealStateEnum.ClipCoupon:buttonImg=gbResources.getImage("clip_this_coupon"),buttonAltText=gbResources.getString("csld-clip_this_coupon");break;case data.DealStateEnum.InCart:break;case data.DealStateEnum.PendingAddToCart:buttonImg=gbResources.getImage("add_to_cart"),buttonAltText=gbResources.getString("csld-add_to_cart");break;case data.DealStateEnum.WaitListOnly:buttonImg=gbResources.getImage("join_waitlist"),buttonAltText=gbResources.getString("gbd_join_waitlist");break;case data.DealStateEnum.WaitListFull:__p+='\n<div class="price">',print(gbResources.getString("gbd_waitlist_full")),__p+="\n</div>";break;case data.DealStateEnum.WaitListed:break;case data.DealStateEnum.Claimed:dealStatusMessage=data.generatedTemplates.claimed}Deal.checkIfDealExpired(data.deal)&&data.stateDisplayData&&void 0!==data.stateDisplayData.hasActionableStatus&&null!==data.stateDisplayData.hasActionableStatus&&!data.stateDisplayData.hasActionableStatus&&(buttonImg=null),null!==buttonImg?(print('<div id="dealActionButton" class="btn">'),print('<img class="'+cursorClass+'" src ='+buttonImg+' title="'+buttonAltText+'"/>'),print("</div>")):null!==dealStatusMessage&&print("<b>"+dealStatusMessage+"</b>")}return __p},this.DealTemplates.single_deal_large_deal_prime_only_access=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){data.isPrimeOnlyDotd&&(__p+='\n<div id="primeOnlyAccessText" class="miniTextBold marginTop">\n',print(gbResources.getString("gb_prime_only_access_deal")),__p+="\n</div>\n")}return __p},this.DealTemplates.single_deal_large_deal_merchant_name=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){if(null!==data.merchantName&&void 0!==data.merchantName&&gbResources.isAmznMerchant(data.merchantID,data.merchantName)===!1){var escapedMerchantName=Deal.escapeHtml(data.merchantName);__p+='\n<div id="dealMerchantName" class="gbmerchantname" title="'+(null==(__t=escapedMerchantName)?"":__t)+'">\n'+(null==(__t=escapedMerchantName)?"":__t)+"\n</div>\n"}}return __p},this.DealTemplates.right_col_sdl_widget_skin=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(__p+='<div id="rcol_sdl-mainContent" class="gbMainContent">\n<div id="rcol_sdl-widgetTitle" class="gbWidgetTitle"></div>\n',data.showNoDealsMessage){print(data.no_deals_message)}else{if(data.showLoadingTemplate){print(data.widget_loading)}else{var dealViewID=data.widgetID+"_dealView0";__p+="\n<div id='"+(null==(__t=dealViewID)?"":__t)+'\' class="gbDealView"></div>\n'}}__p+="\n",(!data.disablePagination||!data.disableRestrictionsApply||data.customSeeMoreString&&data.seeMoreURL)&&(__p+="\n<div id=\"dealPaginationContent\" class='gbwpagcont'></div>\n"),__p+="\n</div>"}return __p},this.DealTemplates.right_col_sdl_widget_page_number=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var gbseemoreClass="hidden";data.customSeeMoreString&&data.seeMoreURL&&(gbseemoreClass="");var hideSeeMoreStyle="";data.forceHideSeeMoreURL&&(hideSeeMoreStyle="display:none"),__p+="\n<div class='SeeMoreLink "+(null==(__t=gbseemoreClass)?"":__t)+"' style='"+(null==(__t=hideSeeMoreStyle)?"":__t)+"'>\n<span class=\"SeeMoreLinkCaret\">&rsaquo;</span>\n<a href='"+(null==(__t=data.seeMoreURL)?"":__t)+"'>\n",print(data.customSeeMoreString),__p+="\n</a>\n</div>"}return __p},this.DealTemplates.right_col_sdl_widget_no_deals_message=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj){__p+='<div id="rcol_sdl-noDealsMessage" class="gbNoDealsMessage">\n'+(null==(__t=data.noDealsMessage)?"":__t)+"\n</div>"}return __p},this.DealTemplates.right_col_sdl_widget_widget_loading=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<img src="',print(gbResources.getImage("loading")),__p+='"\nalt="',print(gbResources.getString("csld-loading_alt")),__p+='"\nid="rcol_sdl-widgetLoading"\nclass="gbWidgetLoading" />'}return __p},this.DealTemplates.right_col_sdl_deal_available=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){__p+=(null==(__t=data.generatedTemplates.image)?"":__t)+"\n";var checkingDealStatus=!1;void 0!==data.checkingDealStatus&&null!==data.checkingDealStatus&&(checkingDealStatus=data.checkingDealStatus),__p+='\n<div id="rcol_sdl-dealDataContent" class="gbDealDataContent">\n'+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div class="gbJumpBar">\n'+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+"\n</div>\n"+(null==(__t=data.generatedTemplates.price_block)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.deal_action_content)?"":__t)+"\n",checkingDealStatus||(data.stateDisplayData&&1==data.stateDisplayData.hasActionableStatus?__p+="\n"+(null==(__t=data.generatedTemplates.state)?"":__t)+"\n":(__p+="\n"+(null==(__t=data.generatedTemplates.deal_status_content)?"":__t)+"\n",!gbResources.customerData.hasEarlyAccessBenefit&&data.isPrimeEarlyAccessDeal&&(__p+="\n"+(null==(__t=data.generatedTemplates.prime_early_access)?"":__t)+"\n"),__p+="\n"+(null==(__t=data.generatedTemplates.time_remaining)?"":__t)+"\n<div>\n",gbResources.customerData.hasEarlyAccessBenefit&&data.isPrimeEarlyAccessDeal?__p+="\n"+(null==(__t=data.generatedTemplates.prime_early_access)?"":__t)+"\n":data.isPrimeOnlyDeal&&(__p+="\n"+(null==(__t=data.generatedTemplates.prime_only_access)?"":__t)+"\n"),__p+="\n</div>\n")),__p+="\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_upcoming=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){__p+=(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div id="rcol_sdl-dealDataContent" class="gbDealDataContent">\n<div id="rcol_sdl-upcomingTitle" class="gbUpcomingTitle">\n',print(gbResources.getString("csld-upcoming")),__p+="\n</div>\n"+(null==(__t=data.generatedTemplates.teaser)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.starts_in)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.early_access_message)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime_only_message)?"":__t)+"\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_image=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var refTaggedURL=null,landingPageURL=data.detailPageLink,imageURL=data.imageURL,upcoming=!1,addAnchorLink=!0,fadedClass="";("soldout"==data.dealState||"coming_soon"==data.dealState)&&(fadedClass="faded"),"upcoming"==data.dealState&&(upcoming=!0,void 0!==data.teaserLine&&null!==data.teaserLine&&""!=data.teaserLine&&(imageURL=gbResources.getImage("hero_upcoming"),addAnchorLink=!1,data.teaserImage&&(imageURL=data.teaserImage,data.teaserURL&&(addAnchorLink=!0,landingPageURL=data.teaserURL))),imageURL==gbResources.getImage("no_image")&&(imageURL=gbResources.getImage("hero_upcoming"))),data.refTags&&data.refTags.image&&landingPageURL&&(refTaggedURL=Deal.ref_tag_appender(landingPageURL,data.dealID,data.refTags.image,data.amabotParams)),void 0!==imageURL&&null!==imageURL&&(imageURL=Deal.resizeImage(imageURL,135)),refTaggedURL||(addAnchorLink=!1),__p+='\n<div id="rcol_sdl-dealImage" class="gbDealImage '+(null==(__t=fadedClass)?"":__t)+'">\n<div id="rcol_sdl-imageContent" class="gbImageContent">\n',addAnchorLink&&(__p+='\n<a href="'+(null==(__t=refTaggedURL)?"":__t)+'" class="imageLink">\n'),__p+='\n<img src="'+(null==(__t=imageURL)?"":__t)+'" />\n',addAnchorLink&&(__p+="\n</a>\n"),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_deal_status_content=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){data.dealType!=Deal.dealTypes.LD||data.isPrimeOnlyDotd||(__p+='\n<div id="rcol_sdl-statusContent" class="gbStatusContent">\n'+(null==(__t=data.generatedTemplates.progress_bar)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.percent_claimed)?"":__t)+"\n</div>\n")}return __p},this.DealTemplates.right_col_sdl_deal_starts_in=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){__p+='<div id="timerContent" class="miniText marginTop '+(null==(__t=data.alertTxt)?"":__t)+'">\n<span> '+(null==(__t=data.timerPrecedingString)?"":__t)+" </span>",data.showEarlyAccessTimer&&!gbResources.customerData.hasEarlyAccessBenefit&&(__p+="\n<br/>"),__p+='\n<span id="'+(null==(__t=data.timerSpanID)?"":__t)+'">'+(null==(__t=data.timeOrDateString)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_teaser=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var teaserTitle=data.dealTitle;void 0!==data.teaserLine&&null!==data.teaserLine&&(teaserTitle=data.teaserLine);var escapedTeaserTitle=Deal.escapeHtml(teaserTitle);__p+='\n<div id="dealTeaser" title="'+(null==(__t=escapedTeaserTitle)?"":__t)+'" class="gbUpcomingTeaser">\n<span id="dealTeaserSpan">'+(null==(__t=escapedTeaserTitle)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_expired=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){__p+=(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div id="rcol_sdl-dealDataContent" class="gbDealDataContent">\n'+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div class="gbJumpBar">\n'+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+"\n</div>\n"+(null==(__t=data.generatedTemplates.price_block)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.deal_action_content)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.deal_status_content)?"":__t)+'\n<div id="rcol_sdl-expiredMessage" class="gbExpiredMessage">\n',print(gbResources.getString("csld-deal_over")),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_soldout=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){__p+=(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div id="rcol_sdl-dealDataContent" class="gbDealDataContent">\n<div id="rcol_sdl-soldoutContent" class="faded">\n'+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div class="gbJumpBar">\n'+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+"\n</div>\n"+(null==(__t=data.generatedTemplates.price_block)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.deal_action_content)?"":__t)+'\n</div>\n<div id="rcol_sdl-soldoutMessage" class="gbSoldoutMessage">\n',print(gbResources.getString("csld-sold_out")),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_prime=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){data.isPrimeEligible&&(__p+='\n<div id="rcol_sdl-prime" class="gbPrime">\n',void 0!==data.reviews&&void 0!==data.reviews.stars&&(__p+='\n<span class="gbByLinePipe">|</span>\n'),__p+='\n<img id="rcol_sdl-primeiImage" class="gbPrimeImage" src="',print(gbResources.getImage("prime")),__p+='" />\n</div>\n')}return __p},this.DealTemplates.right_col_sdl_deal_deal_loading=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<img id="rcol_sdl-dealLoading"\nclass="gbDealLoading"\nsrc="',print(gbResources.getImage("loading")),__p+='\nalt="',print(gbResources.getString("csld-loading_alt")),__p+='" />'}return __p},this.DealTemplates.right_col_sdl_deal_progress_bar=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var percentClaimedFormatted=data.percentClaimed+"%",progbarClaimedClass="gbProgbarClaimed";(data.dealState==data.stateToTemplateMap.Expired||data.dealState==data.stateToTemplateMap.SoldOut)&&(progbarClaimedClass="gbProgbarClaimedMissed"),__p+='\n<div id="rcol_sdl-progressBar" class="gbProgressBar">\n',(0!==data.percentClaimed||"available"!=data.dealState)&&(__p+='\n<div class="gbClaimedBarWrapper">\n<div class="'+(null==(__t=progbarClaimedClass)?"":__t)+'" style="width:'+(null==(__t=percentClaimedFormatted)?"":__t)+'"></div>\n</div>\n'),__p+='\n<div id="rcol_sdl-progbarSpan" class="gbProgbarSpan"></div>\n</div>'}return __p},this.DealTemplates.right_col_sdl_deal_checking_deal_status=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div id="rcol_sdl-checkingDealStatus" class="gbCheckingDealStatus">\n<img src="',print(gbResources.getImage("spinner")),__p+='"/>\n<span id="rcol_sdl-checkingDealStatusMessage" class="gbCheckingDealStatusMessage">\n',print(gbResources.getString("csld-checking_deal_status_alt")),__p+="\n</span>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_title=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var refTaggedURL=data.detailPageLink;data.refTags&&data.refTags.title&&data.detailPageLink&&(refTaggedURL=Deal.ref_tag_appender(data.detailPageLink,data.dealID,data.refTags.title,data.amabotParams));var titleClass="gbDealTitleLarge";null!==data.merchantName&&void 0!==data.merchantName&&gbResources.isAmznMerchant(data.merchantID,data.merchantName)===!1&&(titleClass="gbDealTitle");var escapedTitle=Deal.escapeHtml(data.dealTitle);__p+='\n<div id="dealTitle" class="'+(null==(__t=titleClass)?"":__t)+'">\n<a id="dealTitleLink" href="'+(null==(__t=refTaggedURL)?"":__t)+'" title="'+(null==(__t=escapedTitle)?"":__t)+'" class="titleLink">\n'+(null==(__t=escapedTitle)?"":__t)+"\n</a>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_state=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var timerSpanID=data.dealID+"_state_timer",pendingAtc=!1,inCart=!1,inCartCount=0,inWaitlist=!1,inWaitlistCount=0,checkoutUrl="/gp/cart/view.html";void 0!==data.stateDisplayData[Deal.inCartStr]&&null!==data.stateDisplayData[Deal.inCartStr]&&data.stateDisplayData[Deal.inCartStr].length>0&&(inCart=!0,inCartCount=data.stateDisplayData[Deal.inCartStr].length),void 0!==data.stateDisplayData[Deal.pendingAtcStr]&&null!==data.stateDisplayData[Deal.pendingAtcStr]&&data.stateDisplayData[Deal.pendingAtcStr].length>0&&(pendingAtc=!0),void 0!==data.stateDisplayData[Deal.waitInLineStr]&&null!==data.stateDisplayData[Deal.waitInLineStr]&&data.stateDisplayData[Deal.waitInLineStr].length>0&&(inWaitlist=!0,inWaitlistCount=data.stateDisplayData[Deal.waitInLineStr].length);var importantState="Available",message="";if(pendingAtc){importantState=Deal.PendingAddToCart,data.stateDisplayData[Deal.pendingAtcStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.pendingAtcStr].timerObject.spanID=timerSpanID,message=gbResources.getString("gbd_deal_atc_time_part1")+' <span class="gbCheckOutTime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.pendingAtcStr].timerObject.timeString+"</span> ",message+=gbResources.getString("gbd_deal_atc_time_part2")?gbResources.getString("gbd_deal_atc_time_part2"):""}else{if(inCart&&!inWaitlist){importantState=Deal.inCartStr,message="<b>",data.itemType==Deal.itemTypes.MultiItem?inCartCount>1&&inCartCount==data.stateDisplayData.totalAsins?message+=gbResources.getString("gbd_all_options_in_cart"):1==inCartCount?message+=gbResources.getString("gbd_1_option_in_cart"):inCartCount>1&&(message+=gbResources.getString("gbd_num_options_in_cart",{num:inCartCount})):message+=gbResources.getString("gbd_deal_in_cart"),message+="</b><br/>"+gbResources.getString("gb_you_have")+' <span class="gbCheckOutTime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.inCartStr].timerObject.timeString+"</span> "+gbResources.getString("gb_left_to")+' <a href="'+checkoutUrl+'">'+gbResources.getString("gbd-checkout")+"</a>",data.stateDisplayData[Deal.inCartStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.inCartStr].timerObject.spanID=timerSpanID}else{if(inWaitlist&&!inCart){importantState=Deal.waitInLineStr,message="<b>",1==inWaitlistCount?message+=data.itemType==Deal.itemTypes.MultiItem?gbResources.getString("gbd_1_option_waitlisted"):gbResources.getString("gbd_you_are_waitlisted"):inWaitlistCount>1&&inWaitlistCount==data.stateDisplayData.totalAsins?message+=gbResources.getString("gbd_all_are_waitlisted"):inWaitlistCount>1&&(message+=gbResources.getString("gbd_num_options_in_waitlist",{num:inWaitlistCount})),message+="</b>"}else{if(inWaitlist&&inCart){data.stateDisplayData[Deal.inCartStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.inCartStr].timerObject.spanID=timerSpanID,importantState=Deal.waitInLineStr+" & "+Deal.inCartStr;var inCartStr="<b>"+inCartCount+" "+gbResources.getString("gbd_in_cart")+"</b> ";inCartStr+=gbResources.getString("gb_you_have")+' <span class="gbCheckOutTime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.inCartStr].timerObject.timeString+"</span> "+gbResources.getString("gb_left_to")+' <a href="'+checkoutUrl+'">'+gbResources.getString("gbd-checkout")+"</a>";var inWaitlistStr="<b>";inWaitlistStr+=inWaitlistCount+" "+gbResources.getString("gbd_on_waitlist"),inWaitlistStr+="</b>",message=inCartStr+"<br/>"+inWaitlistStr}}}}__p+='\n<div id="rcol_sdl-dealStateContent" class="gbDealStateContent">\n'+(null==(__t=message)?"":__t)+"\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_reviews=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(data.reviews&&data.reviews.stars){var reviewStars=data.reviews.stars,halfStarName=reviewStars.hasHalfStar?"5":"0",starsImg=gbResources.getImage("stars_"+reviewStars.fullStars+"_"+halfStarName),refTaggedURL=data.detailPageLink;data.refTags&&data.refTags.reviews&&data.reviews.reviewsURL&&(refTaggedURL=Deal.ref_tag_appender(data.reviews.reviewsURL,data.dealID,data.refTags.reviews,data.amabotParams)),__p+='\n<div id="rcol_sdl-ratingContainer" class="gbRatingContainer">',reviewStars.fullStars?__p+='\n<a id="rcol_sdl-dealRating" class="gbDealRating reviewsLink" href="'+(null==(__t=refTaggedURL)?"":__t)+'">\n<img src = '+(null==(__t=starsImg)?"":__t)+' />\n</a>\n<a id="rcol_sdl-reviewCount" class="gbReviewCount reviewsLink" href="'+(null==(__t=refTaggedURL)?"":__t)+'">\n('+(null==(__t=data.reviews.count)?"":__t)+")\n</a>":(__p+='\n<a id="rcol_sdl-addReview" class="gbAddReview reviewsLink" href="'+(null==(__t=refTaggedURL)?"":__t)+'">\n',print(gbResources.getString("csld_add_a_review")),__p+="\n</a>"),__p+="\n</div>"}}return __p},this.DealTemplates.right_col_sdl_deal_percent_claimed=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var percentClaimedClass="";data.percentClaimed>=90&&data.percentClaimed<100?percentClaimedClass="green":100==data.percentClaimed&&(percentClaimedClass="price"),__p+='\n<div id="rcol_sdl-percentClaimed" class="miniTextBold '+(null==(__t=percentClaimedClass)?"":__t)+'">\n',print(gbResources.getString("csld-pct_claimed_hero",{percentClaimed:data.percentClaimed})),__p+="\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_coming_soon=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){__p+=(null==(__t=data.generatedTemplates.image)?"":__t)+'\n<div id="rcol_sdl-dealDataContent" class="gbDealDataContent">\n<div id="rcol_sdl-comingSoonContent" class="faded">\n'+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div class="gbJumpBar">\n'+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n</div>\n"+(null==(__t=data.generatedTemplates.deal_action_content)?"":__t)+'\n</div>\n<div id="rcol_sdl-comingSoonMessage" class="gbComingSoonMessage">\n',print(gbResources.getString("gbd_coming_soon")),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_deal_action_content=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var hideActionDiv=Deal.isSingleAsinWithNoAction(data),checkingDealStatus=!1;void 0!==data.checkingDealStatus&&null!==data.checkingDealStatus&&(checkingDealStatus=data.checkingDealStatus),(0==hideActionDiv||checkingDealStatus)&&(__p+='\n<div id="dealActionContent" class="gbDealActionContent">\n',__p+=checkingDealStatus?"\n"+(null==(__t=data.generatedTemplates.checking_deal_status)?"":__t)+"\n":"\n"+(null==(__t=data.generatedTemplates.button)?"":__t)+"\n",__p+="\n</div>\n")}return __p},this.DealTemplates.right_col_sdl_deal_time_remaining=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){__p+='<div id="dealTimeRemaining" class="miniText marginTop '+(null==(__t=data.alertTxt)?"":__t)+'">\n<span> '+(null==(__t=data.timerPrecedingString)?"":__t)+" </span>\n",data.showEarlyAccessTimer&&(__p+="\n<br/>\n"),__p+='\n<span id="'+(null==(__t=data.timerSpanID)?"":__t)+'">'+(null==(__t=data.timeOrDateString)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.right_col_sdl_deal_price_block=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(data.breaksMAP||data.dealPrice){if(__p+='\n<div id="rcol_sdl-priceBlock" class="gbPriceBlock">\n',1==data.breaksMAP){__p+='\n<span id="rcol_sdl-breaksMapMsg" class="gbBreaksMapMsg">\n',print(gbResources.getString("gbd_add-to-cart-to-see-price")),__p+="\n</span>\n"}else{var dealPrice=data.dealPrice.min.formattedPrice;data.dealPrice.isRange===!0&&(dealPrice+=" - "+data.dealPrice.max.formattedPrice),dealPrice&&(__p+='\n<span id="rcol_sdl-dealPrice" class="gbDealPrice">'+(null==(__t=dealPrice)?"":__t)+"</span>\n",data.discountPercentage&&(__p+='\n<span id="rcol_sdl-percentOff" class="gbPercentOff">\n',print(gbResources.getString("csld-percent_off",{discountPercentage:data.discountPercentage})),__p+="\n</span>\n"))}__p+="\n</div>\n"}}return __p},this.DealTemplates.right_col_sdl_deal_prime_early_access=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){Deal.isDealInEarlyAccessWindow(data.deal)&&(__p+='\n<div id="primeEarlyAccessTextRSDL" class="miniTextBold marginTop fullDealViewWidth">\n',print(gbResources.getString("gb_prime_early_access_deal")),__p+="\n",gbResources.customerData.hasEarlyAccessBenefit||(__p+='\n<div class = "divider">\n</div>\n'),__p+="\n</div>\n")}return __p},this.DealTemplates.onethirtyfive_hero_deal_prime_only_access=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){data.isPrimeOnlyDeal&&(__p+='\n<div id="primeOnlyAccessText" class="miniTextBold marginTop fullDealViewWidth">\n',print(gbResources.getString("gb_prime_only_access_deal")),__p+="\n</div>\n")}return __p},this.DealTemplates.right_col_sdl_deal_button=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var buttonImg=null,buttonAltText="",dealStatusMessage=null,buttonClass="gbDealActionButton";switch(data.purchaseState){case data.DealStateEnum.Available:buttonImg=gbResources.getImage("add_to_cart"),buttonAltText=gbResources.getString("csld-add_to_cart");break;case data.DealStateEnum.Variation:buttonImg=gbResources.getImage("select_options"),buttonAltText=gbResources.getString("csld-select_options_alt");break;case data.DealStateEnum.LearnMore:buttonImg=gbResources.getImage("learn_more_medium"),buttonAltText=gbResources.getString("csld-learn_more");break;case data.DealStateEnum.ViewDeal:buttonImg=gbResources.getImage("view_deal"),buttonAltText=gbResources.getString("csld-view_deal");break;case data.DealStateEnum.InCart:break;case data.DealStateEnum.PendingAddToCart:buttonImg=gbResources.getImage("add_to_cart"),buttonAltText=gbResources.getString("csld-add_to_cart");break;case data.DealStateEnum.WaitListOnly:buttonImg=gbResources.getImage("join_waitlist"),buttonAltText=gbResources.getString("gbd_join_waitlist");break;case data.DealStateEnum.WaitListFull:__p+='\n<div class="miniText price">',print(gbResources.getString("gbd_waitlist_full")),__p+="\n</div>";break;case data.DealStateEnum.WaitListed:break;case data.DealStateEnum.Claimed:dealStatusMessage=gbResources.getString("csld-claimed")}Deal.checkIfDealExpired(data.deal)&&data.stateDisplayData&&void 0!==data.stateDisplayData.hasActionableStatus&&null!==data.stateDisplayData.hasActionableStatus&&!data.stateDisplayData.hasActionableStatus&&(buttonImg=null),null!==buttonImg?__p+='\n<img id="dealActionButton" class="'+(null==(__t=buttonClass)?"":__t)+' btn" src="'+(null==(__t=buttonImg)?"":__t)+'" title="'+(null==(__t=buttonAltText)?"":__t)+'" />\n':null!==dealStatusMessage&&(__p+='\n<div id="dealStatusMessage" class="gbDealStatusMessage">\n'+(null==(__t=dealStatusMessage)?"":__t)+"\n</div>\n")}return __p},this.DealTemplates.right_col_sdl_deal_merchant_name=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){if(data.noMerchantDisplay=!0,null!==data.merchantName&&void 0!==data.merchantName&&gbResources.isAmznMerchant(data.merchantID,data.merchantName)===!1){data.noMerchantDisplay=!1;var escapedMerchantName=Deal.escapeHtml(data.merchantName);__p+='\n<div id="dealMerchantName" class="gbMerchantName" title="'+(null==(__t=escapedMerchantName)?"":__t)+'">\n'+(null==(__t=escapedMerchantName)?"":__t)+"\n</div>\n"}}return __p},this.DealTemplates.right_col_sdl_deal_early_access_message=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(__p+='<div id="earlyAccessContent">',data.isPrimeEarlyAccessDeal){if(gbResources.customerData.hasEarlyAccessBenefit){__p+='\n<div class="miniTextBold marginTop">',print(gbResources.getString("gb_prime_early_access_deal")),__p+="\n</div>"}else{var primeSignUpUrl=gbResources.getString("primeSignUpRedirectUri");__p+='\n<div class = "divider">\n</div>\n<div class="miniTextBold marginTop">',print(gbResources.getString("gb_prime_early_access_deal")),__p+='\n</div>\n<div class="miniText floatLeft">',print(gbResources.getString("gb_early_access_text",{duration:data.primeAccessDurationInMs/60000})),__p+='\n</div>\n<a class="miniText" style="color:#0066C0;" href="'+(null==(__t=primeSignUpUrl)?"":__t)+'">',print(gbResources.getString("gb_prime_link")),__p+="</a>",print(".")}}__p+="\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_prime_only_message=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(__p+='<div id="primeOnlyContent" style="float:left;">',data.isPrimeOnlyDeal){if(gbResources.customerData.hasEarlyAccessBenefit){__p+='\n<div class="miniTextBold marginTop">',print(gbResources.getString("gb_prime_only_access_deal")),__p+="\n</div>"}else{var primeSignUpUrl=gbResources.getString("primeExclusiveSignUpRedirectUri");__p+='\n<div class = "divider">\n</div>\n<div class="miniTextBold marginTop">',print(gbResources.getString("gb_prime_only_access_deal")),__p+='\n</div><br>\n<div class="miniText" style="clear:both;">',print(gbResources.getString("gb_prime_only_access_text")),__p+='\n</div>\n<a class="miniText" style="color:#0066C0;" href="'+(null==(__t=primeSignUpUrl)?"":__t)+'">',print(gbResources.getString("gb_prime_link")),__p+="</a>",print(".")}}__p+="\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_widget_onethirtyfive_hero_skin=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var headerClassString="",hideTopborder="";data.disableStatusFilter&&!data.disableCategoryFilter&&(headerClassString='class="disabledStausFilter"'),data.disableStatusFilter&&(hideTopborder="hidegbwtopborder"),__p+='\n<div class="gbh2cont"><h2 '+(null==(__t=headerClassString)?"":__t)+">"+(null==(__t=data.title)?"":__t)+"</h2></div>\n";var hideBorder="";!data.disableRestrictionsApply||!data.disablePagination||data.customSeeMoreString&&data.seeMoreURL||(hideBorder="gbwcontmargin"),__p+='\n<div class="gbwcont gbwcontminwidth '+(null==(__t=hideBorder)?"":__t)+'">\n';var filterbarClass="gbwfilterbar",gbwnotchcontClass="gbwnotchcont",gbwshovelerstyleClass="";data.disableCategoryFilter&&data.disableStatusFilter&&(filterbarClass="hidegbwfilterbar",gbwnotchcontClass="hidegbwnotchcont",gbwshovelerstyleClass="gbwshovelerExtstyle"),__p+="\n<div class='"+(null==(__t=filterbarClass)?"":__t)+"'>\n";var filterslClass="filtersl",gbwnotchClass="gbwnotch";data.disableStatusFilter&&(filterslClass="hidefiltersl",gbwnotchClass="hidegbwnotch"),__p+="\n<div class='"+(null==(__t=filterslClass)?"":__t)+'\'>\n<table cellpadding="0" cellspacing="0" border="0" class="filtersone" >\n<tbody>\n<tr>\n<td id="available_filter" class=""><span>',print(gbResources.getString("csld-all_available_filter")),__p+='</span></td>\n<td id="upcoming_filter"><span>',print(gbResources.getString("csld-upcoming_filter")),__p+='</span></td>\n<td id="missed_filter"><span>',print(gbResources.getString("csld-missed_deals_filter")),__p+="</span></td>\n</tr>\n</tbody>\n</table>\n</div>\n";var filtersrClass="filtersr";data.disableCategoryFilter&&(filtersrClass="hidefiltersr"),__p+="\n<div class='"+(null==(__t=filtersrClass)?"":__t)+'\'>\n<table cellpadding="0" cellspacing="0" border="0" class="filterstwo">\n<tbody>\n<tr>\n<td id="gbwcategories"><a href="#" id="dealsCategories" onclick="return false;">',print(gbResources.getString("hero-category_dropdown")),__p+=' <b id="selectedCategory">'+(null==(__t=data.filterName)?"":__t)+"</b><span class=\"gbw-nav-down-arrow gbw-nav-sprite\"></span></a></td>\n</tr>\n</tbody>\n</table>\n</div>\n<div class='filtersc'>&nbsp;</div>\n</div>\n<div class='"+(null==(__t=gbwnotchcontClass)?"":__t)+"'>\n",data.notchStyle||(data.notchStyle="left: -105px"),__p+="\n<div class='"+(null==(__t=gbwnotchClass)?"":__t)+"' style='"+(null==(__t=data.notchStyle)?"":__t)+"'></div>\n<div class=\"gbwrule "+(null==(__t=hideTopborder)?"":__t)+'"></div>\n</div>\n<div class="gbwshovelerwrapper '+(null==(__t=gbwshovelerstyleClass)?"":__t)+'">\n';var iecss=data.displayCouponsCount?"height: 364px;":"height: 344px;",gbwshovelerClass="ldshoveler";data.dealTypeFilter&&(1===data.dealTypeFilter.length&&data.dealTypeFilter[0]!==Deal.dealTypes.LD?data.dealTypeFilter[0]===Deal.dealTypes.LOCAL?(gbwshovelerClass="localshoveler",iecss="height: 307px;"):data.dealTypeFilter[0]===Deal.dealTypes.COUPON&&(gbwshovelerClass="couponshoveler",iecss="height: 294px;"):Deal.isPEAEnabledMarketplace(gbResources.getCustomerData("realm"))&&gbResources.getFeature("prime-early-access")&&(_.contains(data.dealTypeFilter,Deal.dealTypes.LD)||_.isEmpty(data.dealTypeFilter))&&(gbwshovelerClass="pealdshoveler",iecss=data.displayCouponsCount?"height: 381px;":"height: 371px;")),jQuery.browser.msie||(iecss=""),__p+="\n<div class='"+(null==(__t=gbwshovelerClass)?"":__t)+" gbwshoveler' style='"+(null==(__t=iecss)?"":__t)+"'>\n";var backButtonClass="back-button",nextButtonClass="next-button",ulClass="ulResized";if(data.disablePagination&&(backButtonClass="hide-back-button",nextButtonClass="hide-next-button",data.disableAdaptiveResize&&(ulClass="ulNonResized")),__p+='\n<div class="gbwshoveler-button-wrapper" id="shove_01">\n<div class=\''+(null==(__t=backButtonClass)?"":__t)+'\' id="leftShovel">\n<a title="',print(gbResources.getString("shvl-button-back_46731")),__p+='" style="" href="#" onclick="return false;" class="">\n<span id="leftShovelTxt" class="bg-text">',print(gbResources.getString("shvl-button-back_46731")),__p+='</span>\n<span id="leftShovelBg" class="bg-image" title="',print(gbResources.getString("shvl-button-back_46731")),__p+='"></span>\n</a>\n</div>\n',(data.showLoadingTemplate||jQuery.browser.msie)&&(gbwshovelerClass=""),__p+='\n<div class="gbwshoveler-content">\n',data.showNoDealsMessage){print(data.no_deals_message)}else{__p+="\n<ul class='"+(null==(__t=ulClass)?"":__t)+" "+(null==(__t=gbwshovelerClass)?"":__t)+"'>\n";var classString="";data.displayCouponsCount&&(classString='class="noTopMargin"');for(var i=0;i<data.numberOfCells;i++){__p+="\n";var dealViewID=data.widgetID+"_dealView"+i;__p+="\n<li id='"+(null==(__t=dealViewID)?"":__t)+"' "+(null==(__t=classString)?"":__t)+"></li>\n"}__p+="\n</ul>\n",data.showLoadingTemplate&&print(data.widget_loading),__p+="\n"}__p+="\n</div>\n<div class='"+(null==(__t=nextButtonClass)?"":__t)+'\' id="rightShovel">\n<a title="',print(gbResources.getString("shvl-button-next_46730")),__p+='" style="" href="#" onclick="return false;" class="">\n<span id="rightShovelTxt" class="bg-text">',print(gbResources.getString("shvl-button-next_46730")),__p+='</span>\n<span id="rightShovelBg" class="bg-image" title="',print(gbResources.getString("shvl-button-next_46730")),__p+='"></span>\n</a>\n</div>\n</div>\n</div>\n</div>\n</div>\n';var gbwpagcontClass="gbwpagcont";!data.disablePagination||!data.disableRestrictionsApply||data.customSeeMoreString&&data.seeMoreURL||(gbwpagcontClass="hidegbwpagcont"),__p+='\n<div id="dealPaginationContent" class=\''+(null==(__t=gbwpagcontClass)?"":__t)+"'>\n</div>"}return __p},this.DealTemplates.default_widget_widget_loading=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div class="center_align">\n<img src=\'',print(gbResources.getImage("loading")),__p+="' alt=\"",print(gbResources.getString("csld-loading_alt")),__p+='" />\n</div>'}return __p},this.DealTemplates.default_widget_no_deals_message=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj){__p+='<div class="center_align_nodeals">\n'+(null==(__t=data.noDealsMessage)?"":__t)+"\n</div>"}return __p},this.DealTemplates.default_widget_categories=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){__p+='<div class="gbwpop">\n<table cellspacing="0" cellpadding="0" surround="0,30,30,30">\n<tbody>\n<tr class=\'gbw_pop_t\'>\n<td class="gbw_pop_tl gbw_pop_h">\n<div class="gbw_pop_lr_min"></div>\n</td>\n<td class="gbw_pop_tc gbw_pop_h"></td>\n<td class="gbw_pop_tr gbw_pop_h">\n<div class="gbw_pop_lr_min"></div>\n</td>\n</tr>\n<tr>\n<td class="gbw_pop_cl gbw_pop_v"></td>\n';var popoverWidth=160*data.columnCount;if(__p+='\n<td class="gbw_pop_cc ap_content" style="min-width:'+(null==(__t=popoverWidth)?"":__t)+'px !important">\n',data.categories&&data.columnCount){for(var maxRowCount=Math.ceil(data.categories.length/data.columnCount),k=0;k<data.columnCount;k++){__p+='\n<div id="nav_your_account_flyout" class="gbw_cat_pop_row">\n<ul class="gbw_pop_ul">\n';for(var i=k*maxRowCount;i<data.categories.length&&(k+1)*maxRowCount>i;i++){var cat=data.categories[i];if(cat){var nodeId=cat.nodeId,categoryString=cat.category;nodeId===Deal.primeAccessTypeEnum.PRIME_EARLY_ACCESS&&i!==k*maxRowCount&&(__p+='\n<li class="gbw_pop_li has_divider">\n<div class = "divider"></div>\n</li>'),__p+='\n<li class="gbw_pop_li">\n<a id='+(null==(__t=nodeId)?"":__t)+" class='nav_a ap_custom_close' value='"+(null==(__t=nodeId)?"":__t)+'\' href="#" onclick="Deal.controller.setFilter ('+(null==(__t=data.widgetID)?"":__t)+", '"+(null==(__t=nodeId)?"":__t)+"'); Deal.controller.setPage ("+(null==(__t=data.widgetID)?"":__t)+", 1); Deal.controller.trigger ('metadata_change'+"+(null==(__t=data.widgetID)?"":__t)+");  Deal.setURLFilters ("+(null==(__t=data.widgetID)?"":__t)+'); return false;">\n'+(null==(__t=categoryString)?"":__t)+"\n</a>\n</li>"}}__p+="\n</ul>\n</div>\n"}}__p+='\n</td>\n<td class="gbw_pop_cr gbw_pop_v"></td>\n</tr>\n<tr class=\'gbw_pop_b\'>\n<td class="gbw_pop_bl gbw_pop_v"></td>\n<td class="gbw_pop_bc gbw_pop_h"></td>\n<td class="gbw_pop_br gbw_pop_v"></td>\n</tr>\n</tbody>\n</table>\n</div>'}return __p},this.DealTemplates.onethirtyfive_hero_deal_available=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var hideActionDiv=Deal.isSingleAsinWithNoAction(data)||!data.elementDetails.showButton,checkingDealStatus=!1;void 0!==data.checkingDealStatus&&null!==data.checkingDealStatus&&(checkingDealStatus=data.checkingDealStatus),__p+='\n<div id="dealHoverContent">\n<div id="dealImageContent" class="imgcont">\n'+(null==(__t=data.generatedTemplates.image)?"":__t)+"\n",data.elementDetails.showReviews&&(__p+="\n"+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"),__p+="\n</div>\n"+(null==(__t=data.generatedTemplates.price_block)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n",data.elementDetails.showMerchantName&&(__p+="\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+"\n"),__p+="\n</div>\n",hideActionDiv===!1||checkingDealStatus?(__p+='\n<div id="dealActionContent" class="actioncont">\n',__p+=checkingDealStatus?"\n"+(null==(__t=data.generatedTemplates.checking_deal_status)?"":__t)+"\n":"\n"+(null==(__t=data.generatedTemplates.button)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+"\n",__p+="\n</div>\n"):__p+="\n<br/>\n",__p+="\n",checkingDealStatus||(__p+='\n<div id="dealStateContent" class="dealtypecont">\n',void 0!==data.stateDisplayData&&null!==data.stateDisplayData&&1==data.stateDisplayData.hasActionableStatus?__p+="\n"+(null==(__t=data.generatedTemplates.state)?"":__t)+"\n":(__p+="\n",data.dealType!=Deal.dealTypes.LD||data.isPrimeOnlyDotd||(__p+="\n"+(null==(__t=data.generatedTemplates.total_coupons_count)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.progress_bar)?"":__t)+"\n"),data.dealType==Deal.dealTypes.LOCAL&&(__p+="\n"+(null==(__t=data.generatedTemplates.geo_display_location)?"":__t)+"\n"),__p+='\n<div id="dealTimerContent" class="ldtimertxt">\n',data.dealType!=Deal.dealTypes.LD||data.isPrimeOnlyDotd?(data.dealType===Deal.dealTypes.DOTD||data.isPrimeOnlyDotd)&&(__p+="\n"+(null==(__t=data.generatedTemplates.badge)?"":__t)+"\n"):(__p+="\n"+(null==(__t=data.generatedTemplates.percent_claimed)?"":__t)+"\n",!gbResources.customerData.hasEarlyAccessBenefit&&data.isPrimeEarlyAccessDeal&&(__p+="\n"+(null==(__t=data.generatedTemplates.prime_early_access)?"":__t)+"\n"),__p+="\n"),__p+="\n",data.elementDetails.showEndTime&&(__p+="\n"+(null==(__t=data.generatedTemplates.time_remaining)?"":__t)+"\n"),__p+="\n</div>\n",gbResources.customerData.hasEarlyAccessBenefit&&data.dealType===Deal.dealTypes.LD&&data.isPrimeEarlyAccessDeal?__p+="\n"+(null==(__t=data.generatedTemplates.prime_early_access)?"":__t)+"\n":data.dealType===Deal.dealTypes.LD&&data.isPrimeOnlyDeal&&(__p+="\n"+(null==(__t=data.generatedTemplates.prime_only_access)?"":__t)+"\n")),__p+="\n</div>\n")}return __p},this.DealTemplates.onethirtyfive_hero_deal_description=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj){__p+='<div id="dealDescription" class="upcomingdesc">\n'+(null==(__t=data.dealDescription)?"":__t)+"\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_upcoming=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div id="dealImageContent" class="imgcont">\n'+(null==(__t=data.generatedTemplates.image)?"":__t)+'\n</div>\n<div id="dealUpcomingMessage" class="upcomingtitle">',print(gbResources.getString("csld-upcoming")),__p+="\n</div>\n"+(null==(__t=data.generatedTemplates.teaser)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.starts_in)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.early_access_message)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime_only_message)?"":__t)}return __p},this.DealTemplates.onethirtyfive_hero_deal_image=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var fadedClass="";data.dealState===Deal.stateToTemplateMap.ComingSoon&&(fadedClass="faded"),__p+='\n<div class="prodimg '+(null==(__t=fadedClass)?"":__t)+'">\n';var refTaggedURL=null,landingPageURL=data.detailPageLink,imageURL=data.imageURL,upcoming=!1,addAnchorLink=!0;"upcoming"==data.dealState&&(upcoming=!0,void 0!==data.teaserLine&&null!==data.teaserLine&&""!=data.teaserLine&&(imageURL=gbResources.getImage("hero_upcoming"),addAnchorLink=!1,data.teaserImage&&(imageURL=data.teaserImage,data.teaserURL&&(addAnchorLink=!0,landingPageURL=data.teaserURL))),imageURL==gbResources.getImage("no_image")&&(imageURL=gbResources.getImage("hero_upcoming"))),data.refTags&&data.refTags.image&&landingPageURL&&(refTaggedURL=data.dealType==Deal.dealTypes.LOCAL?Deal.generateRefTaggedExternalRedirectURL(landingPageURL,data.dealID,data.refTags.image,data.amabotParams):Deal.ref_tag_appender(landingPageURL,data.dealID,data.refTags.image,data.amabotParams)),void 0!==imageURL&&null!==imageURL&&(imageURL=Deal.resizeImage(imageURL,135)),refTaggedURL||(addAnchorLink=!1),addAnchorLink&&(__p+="\n<a href= "+(null==(__t=refTaggedURL)?"":__t)+' class="imageLink">\n'),__p+='\n<img id="dealImage" src = '+(null==(__t=imageURL)?"":__t)+" />\n",addAnchorLink&&(__p+="\n</a>\n"),__p+="\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_total_coupons_count=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){data.displayCouponsCount&&(__p+='\n<div id="dealTotalCouponsCount" class="totalcoupons">\n',data.totalCouponsCount&&print(gbResources.getString("csld-number_coupons",{coupons:data.totalCouponsCount})),__p+="\n</div>\n")}return __p},this.DealTemplates.onethirtyfive_hero_deal_teaser=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var teaserTitle=data.dealTitle;void 0!==data.teaserLine&&null!==data.teaserLine&&(teaserTitle=data.teaserLine);var escapedTeaserTitle=Deal.escapeHtml(teaserTitle);__p+='\n<div id="dealTeaser" title="'+(null==(__t=escapedTeaserTitle)?"":__t)+'" class="upcomingdesc">\n<span id="dealTeaserSpan">'+(null==(__t=escapedTeaserTitle)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_claimed=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='<div id="dealClaimedMessage" class="claimed">\n',print(gbResources.getString("csld-claimed")),__p+="\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_geo_display_location=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){if(null!==data.geoDisplayName&&void 0!==data.geoDisplayName){var escapedGeoDisplayName=Deal.escapeHtml(data.geoDisplayName);__p+='\n<div id="dealGeoDisplayName" class="localgeodisplayname" title="'+(null==(__t=escapedGeoDisplayName)?"":__t)+'">\n'+(null==(__t=escapedGeoDisplayName)?"":__t)+"\n</div>\n"}}return __p},this.DealTemplates.onethirtyfive_hero_deal_expired=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var hideActionDiv=Deal.isSingleAsinWithNoAction(data)||!data.elementDetails.showButton,checkingDealStatus=!1;void 0!==data.checkingDealStatus&&null!==data.checkingDealStatus&&(checkingDealStatus=data.checkingDealStatus),__p+='\n<div id="dealImageContent" class="imgcont">\n'+(null==(__t=data.generatedTemplates.image)?"":__t)+"\n",data.elementDetails.showReviews&&(__p+="\n"+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"),__p+="\n</div>\n"+(null==(__t=data.generatedTemplates.price_block)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n",data.elementDetails.showMerchantName&&(__p+="\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+"\n"),__p+="\n",0==hideActionDiv||checkingDealStatus?(__p+='\n<div id="dealActionContent" class="actioncont">\n',__p+=checkingDealStatus?"\n"+(null==(__t=data.generatedTemplates.checking_deal_status)?"":__t)+"\n":"\n"+(null==(__t=data.generatedTemplates.button)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+"\n",__p+="\n</div>\n"):__p+="\n<br/>\n",__p+="\n",checkingDealStatus||(__p+='\n<div id="dealStateContent" class="dealtypecont">\n',data.stateDisplayData&&1==data.stateDisplayData.hasActionableStatus?__p+="\n"+(null==(__t=data.generatedTemplates.state)?"":__t)+"\n":(__p+="\n",__p+=data.dealType!==Deal.dealTypes.LD||data.isPrimeOnlyDotd?'\n<div class="ldtimercont"></div>\n':"\n"+(null==(__t=data.generatedTemplates.total_coupons_count)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.progress_bar)?"":__t)+"\n",__p+='\n<div id="dealTimerContent" class="ldtimertxt">\n',data.dealType!=Deal.dealTypes.LD||data.isPrimeOnlyDotd?(data.dealType==Deal.dealTypes.DOTD||data.isPrimeOnlyDotd)&&(__p+="\n"+(null==(__t=data.generatedTemplates.badge)?"":__t)+"\n"):__p+="\n"+(null==(__t=data.generatedTemplates.percent_claimed)?"":__t)+"\n",__p+='\n<div id="dealClosedMessage" class="ldtimeleft expired">\n',print(gbResources.getString("csld-deal_over")),__p+="\n</div>\n</div>\n"),__p+="\n</div>\n")}return __p},this.DealTemplates.onethirtyfive_hero_deal_soldout=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var hideActionDiv=Deal.isSingleAsinWithNoAction(data)||!data.elementDetails.showButton,checkingDealStatus=!1;void 0!==data.checkingDealStatus&&null!==data.checkingDealStatus&&(checkingDealStatus=data.checkingDealStatus),__p+='\n<div id="dealImageContent" class="imgcont">\n'+(null==(__t=data.generatedTemplates.image)?"":__t)+"\n",data.elementDetails.showReviews&&(__p+="\n"+(null==(__t=data.generatedTemplates.reviews)?"":__t)+"\n"),__p+="\n</div>\n"+(null==(__t=data.generatedTemplates.price_block)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n",data.elementDetails.showMerchantName&&(__p+="\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+"\n"),__p+="\n",__p+=0==hideActionDiv?'\n<div id="dealActionContent" class="actioncont">\n'+(null==(__t=data.generatedTemplates.button)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.prime)?"":__t)+"\n</div>\n":"\n<br/>\n",__p+="\n",checkingDealStatus||(__p+='\n<div id="dealStateContent" class="dealtypecont">\n',data.stateDisplayData&&1==data.stateDisplayData.hasActionableStatus?__p+="\n"+(null==(__t=data.generatedTemplates.state)?"":__t)+"\n":(__p+="\n",__p+=data.dealType!==Deal.dealTypes.LD||data.isPrimeOnlyDotd?'\n<div class="ldtimercont"></div>\n':"\n"+(null==(__t=data.generatedTemplates.total_coupons_count)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.progress_bar)?"":__t)+"\n",__p+='\n<div id="dealTimerContent" class="ldtimertxt">\n',data.dealType!==Deal.dealTypes.LD||data.isPrimeOnlyDotd||(__p+="\n"+(null==(__t=data.generatedTemplates.percent_claimed)?"":__t)+"\n"),__p+='\n<div id="dealClosedMessage" class="ldtimeleft soldout">',print(gbResources.getString("csld-deal_over")),__p+="</div>\n</div>\n"),__p+="\n</div>\n")}return __p},this.DealTemplates.onethirtyfive_hero_deal_deal_loading=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+="<div>\n<img src='",print(gbResources.getImage("loading")),__p+="' alt=\"",print(gbResources.getString("csld-loading_alt")),__p+='" />\n</div>'}return __p},this.DealTemplates.onethirtyfive_hero_deal_title=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var refTaggedURL=data.detailPageLink;data.refTags&&data.refTags.title&&data.detailPageLink&&(refTaggedURL=data.dealType==Deal.dealTypes.LOCAL?Deal.generateRefTaggedExternalRedirectURL(data.detailPageLink,data.dealID,data.refTags.title,data.amabotParams):Deal.ref_tag_appender(data.detailPageLink,data.dealID,data.refTags.title,data.amabotParams));var escapedTitle=Deal.escapeHtml(data.dealTitle),hasPriceBlock=!1;(data.breaksMAP||data.marketingMessage||data.dealPrice)&&(hasPriceBlock=!0);var hasMerchantDisplay=!1,isLDWeblabEligible=data.dealType===Deal.dealTypes.LD&&"2"===gbResources.getFeature("ld-dealview-experiement"),isBDWeblabEligible=data.dealType===Deal.dealTypes.BD&&gbResources.getFeature("bd-dealview-experiement")===!0;isLDWeblabEligible||isBDWeblabEligible||gbResources.isAmznMerchant(data.merchantID,data.merchantName)!==!1||!data.merchantName||(hasMerchantDisplay=!0);var titleHeightClass;titleHeightClass=hasPriceBlock&&hasMerchantDisplay?"":hasPriceBlock||hasMerchantDisplay?"titleHeight3Lines":"titleHeight4Lines";var noPriceBlockClass="";if(hasPriceBlock||(noPriceBlockClass="noPriceBlock"),__p+='\n<div id="dealTitle" class=\'title '+(null==(__t=titleHeightClass)?"":__t)+" "+(null==(__t=noPriceBlockClass)?"":__t)+"'>\n",data.dealType===Deal.dealTypes.BD&&void 0!==data.msFromPost&&null!==data.msFromPost&&data.msFromPost>0&&data.msFromPost<86400000){var newStickerImage=gbResources.getImage("gbox-new-sticker");__p+="\n<img id='dealNewSticker' alt=\"New\" src='"+(null==(__t=newStickerImage)?"":__t)+'\' class="gbNewSticker">\n'}__p+="\n<a href= "+(null==(__t=refTaggedURL)?"":__t)+' title="'+(null==(__t=escapedTitle)?"":__t)+'" class="titleLink">\n'+(null==(__t=escapedTitle)?"":__t)+"\n</a>\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_checking_deal_status=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+="<div>\n<img src='",print(gbResources.getImage("spinner")),__p+="' />\n",print(gbResources.getString("csld-checking_deal_status_alt")),__p+="\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_progress_bar=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var pcntClaimedFormatted=data.percentClaimed+"%",statebarClass="ld-one",progbarClass="progbar",progbartickClass="progbartick";(data.dealState===data.stateToTemplateMap.Expired||data.dealState===data.stateToTemplateMap.SoldOut)&&(statebarClass="ld-four",progbarClass="progbarmissed",progbartickClass="progbartickmissed"),__p+='\n<div class="ldtimercont">\n<div class="statebar '+(null==(__t=statebarClass)?"":__t)+'"></div>\n<div class="'+(null==(__t=progbarClass)?"":__t)+'" style="width:'+(null==(__t=pcntClaimedFormatted)?"":__t)+'"></div>\n<div class="'+(null==(__t=progbartickClass)?"":__t)+'" style="width:'+(null==(__t=pcntClaimedFormatted)?"":__t)+'"></div>\n</div>'}return __p},this.DealTemplates.onethirtyfive_hero_deal_state=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){var timerSpanID=data.dealID+"_state_timer",pendingAtc=!1,inCart=!1,inCartCount=0,inWaitlist=!1,inWaitlistCount=0,checkoutUrl="/gp/cart/view.html";void 0!==data.stateDisplayData[Deal.inCartStr]&&null!==data.stateDisplayData[Deal.inCartStr]&&data.stateDisplayData[Deal.inCartStr].length>0&&(inCart=!0,inCartCount=data.stateDisplayData[Deal.inCartStr].length),void 0!==data.stateDisplayData[Deal.pendingAtcStr]&&null!==data.stateDisplayData[Deal.pendingAtcStr]&&data.stateDisplayData[Deal.pendingAtcStr].length>0&&(pendingAtc=!0),void 0!==data.stateDisplayData[Deal.waitInLineStr]&&null!==data.stateDisplayData[Deal.waitInLineStr]&&data.stateDisplayData[Deal.waitInLineStr].length>0&&(inWaitlist=!0,inWaitlistCount=data.stateDisplayData[Deal.waitInLineStr].length);var importantState="Available",message="";if(pendingAtc){importantState=Deal.PendingAddToCart,data.stateDisplayData[Deal.pendingAtcStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.pendingAtcStr].timerObject.spanID=timerSpanID,message=gbResources.getString("gbd_deal_atc_time_part1")+'  <span class="gbcheckouttime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.pendingAtcStr].timerObject.timeString+"</span> ",message+=gbResources.getString("gbd_deal_atc_time_part2")?gbResources.getString("gbd_deal_atc_time_part2"):""}else{if(inCart&&!inWaitlist){importantState=Deal.inCartStr,message="<b>",data.itemType==Deal.itemTypes.MultiItem?inCartCount>1&&inCartCount==data.stateDisplayData.totalAsins?message+=gbResources.getString("gbd_all_options_in_cart"):1==inCartCount?message+=gbResources.getString("gbd_1_option_in_cart"):inCartCount>1&&(message+=gbResources.getString("gbd_num_options_in_cart",{num:inCartCount})):message+=gbResources.getString("gbd_deal_in_cart"),message+="</b><br/>"+gbResources.getString("gb_you_have")+' <span class="gbcheckouttime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.inCartStr].timerObject.timeString+"</span> "+gbResources.getString("gb_left_to")+' <a href="'+checkoutUrl+'">'+gbResources.getString("gbd-checkout")+"</a>",data.stateDisplayData[Deal.inCartStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.inCartStr].timerObject.spanID=timerSpanID}else{if(inWaitlist&&!inCart){importantState=Deal.waitInLineStr,message="<b>",1==inWaitlistCount?message+=data.itemType==Deal.itemTypes.MultiItem?gbResources.getString("gbd_1_option_waitlisted"):gbResources.getString("gbd_you_are_waitlisted"):inWaitlistCount>1&&inWaitlistCount==data.stateDisplayData.totalAsins?message+=gbResources.getString("gbd_all_are_waitlisted"):inWaitlistCount>1&&(message+=gbResources.getString("gbd_num_options_in_waitlist",{num:inWaitlistCount})),message+="</b>"}else{if(inWaitlist&&inCart){data.stateDisplayData[Deal.inCartStr].timerObject.viewElement=data.viewElement,data.stateDisplayData[Deal.inCartStr].timerObject.spanID=timerSpanID,importantState=Deal.waitInLineStr+" & "+Deal.inCartStr;var inCartStr="<b>"+inCartCount+" "+gbResources.getString("gbd_in_cart")+"</b> ";inCartStr+=gbResources.getString("gb_you_have")+' <span class="gbcheckouttime" id="'+timerSpanID+'">'+data.stateDisplayData[Deal.inCartStr].timerObject.timeString+"</span> "+gbResources.getString("gb_left_to")+' <a href="'+checkoutUrl+'">'+gbResources.getString("gbd-checkout")+"</a>";var inWaitlistStr="<b>";inWaitlistStr+=inWaitlistCount+" "+gbResources.getString("gbd_on_waitlist"),inWaitlistStr+="</b>",message=inCartStr+"<br/>"+inWaitlistStr}}}}__p+='\n<div class="dealtypecont">\n'+(null==(__t=message)?"":__t)+"\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_starts_in=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){__p+='<div id="timerContent" class="fullDealViewWidth miniText marginTop '+(null==(__t=data.alertTxt)?"":__t)+'">\n<span> '+(null==(__t=data.timerPrecedingString)?"":__t)+" </span>",data.showEarlyAccessTimer&&!gbResources.customerData.hasEarlyAccessBenefit&&(__p+="\n<br/>"),__p+='\n<span id="'+(null==(__t=data.timerSpanID)?"":__t)+'">'+(null==(__t=data.timeOrDateString)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_reviews=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(data.reviews&&data.reviews.stars){var reviewStars=data.reviews.stars,halfStarName=reviewStars.hasHalfStar?"5":"0",starsImg=gbResources.getImage("stars_"+reviewStars.fullStars+"_"+halfStarName),refTaggedURL=data.detailPageLink,hoverClass="hoversm";data.refTags&&data.refTags.reviews&&data.reviews.reviewsURL&&(refTaggedURL=Deal.ref_tag_appender(data.reviews.reviewsURL,data.dealID,data.refTags.reviews,data.amabotParams)),(data.dealType===Deal.dealTypes.COUPON||data.dealType===Deal.dealTypes.LOCAL)&&(hoverClass="nohoversm"),__p+='\n<div id="dealReviewsAndRatingsHover" class=\''+(null==(__t=hoverClass)?"":__t)+'\'>\n<div id="dealRatingAndCount" class="ratingcontainer">',reviewStars.fullStars?__p+='\n<a id="dealRating" href='+(null==(__t=refTaggedURL)?"":__t)+' class="reviewsLink">\n<img src = '+(null==(__t=starsImg)?"":__t)+' />\n</a>\n<a id="dealReviewsCount" class="gbox-small" href='+(null==(__t=refTaggedURL)?"":__t)+' class="reviewsLink">\n('+(null==(__t=data.reviews.count)?"":__t)+")\n</a>":(__p+="\n<a href="+(null==(__t=refTaggedURL)?"":__t)+' class="reviewsLink">\n',print(gbResources.getString("csld_add_a_review")),__p+="\n</a>"),__p+="\n</div>\n</div>"}}return __p},this.DealTemplates.onethirtyfive_hero_deal_percent_claimed=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){var ldclaimedclass="";data.percentClaimed>=90&&data.percentClaimed<100?ldclaimedclass="green":100==data.percentClaimed&&(ldclaimedclass="price"),__p+='\n<div id="dealPercentClaimed" class="miniTextBold '+(null==(__t=ldclaimedclass)?"":__t)+'">\n',print(gbResources.getString("csld-pct_claimed_hero",{percentClaimed:data.percentClaimed})),__p+="\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_coming_soon=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){__p+='\n<div id="dealImageContent" class="imgcont">\n'+(null==(__t=data.generatedTemplates.image)?"":__t)+"\n</div>\n"+(null==(__t=data.generatedTemplates.title)?"":__t)+"\n"+(null==(__t=data.generatedTemplates.merchant_name)?"":__t)+'\n<div id="dealActionContent" class="actioncont">\n<div id="dealPriceBlock" class="priceblock">\n<b>',print(gbResources.getString("gbd_coming_soon")),__p+="</b>\n</div>\n</div>\n",data.dealType==Deal.dealTypes.DOTD&&(__p+="\n"+(null==(__t=data.generatedTemplates.badge)?"":__t)+"\n")}return __p},this.DealTemplates.onethirtyfive_hero_deal_time_remaining=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){__p+='<div id="dealTimeRemaining" class="miniText marginTop '+(null==(__t=data.alertTxt)?"":__t)+'">\n<span> '+(null==(__t=data.timerPrecedingString)?"":__t)+" </span>\n",data.showEarlyAccessTimer&&(__p+="\n<br/>\n"),__p+='\n<span id="'+(null==(__t=data.timerSpanID)?"":__t)+'">'+(null==(__t=data.timeOrDateString)?"":__t)+"</span>\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_price_block=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(data.breaksMAP||data.marketingMessage||data.dealPrice){var percentOffString="csld-percent_off";if((data.deal.dealType===Deal.dealTypes.LD&&"4"===gbResources.getFeature("ld-dealview-experiement")||data.deal.dealType===Deal.dealTypes.BD&&"3"===gbResources.getFeature("bd-dealview-experiement"))&&(percentOffString="csld-save-percent"),__p+='\n<div id="dealPriceBlock" class="priceblock">\n',1==data.breaksMAP){__p+='\n<span id="dealBreaksMapMsg" class="breaksMapMsg">\n',print(gbResources.getString("gbd_add-to-cart-to-see-price")),__p+="\n</span>\n"}else{if(data.marketingMessage){__p+='\n<span id="dealMarketingMessage" class="marketingmessage"><b>'+(null==(__t=data.marketingMessage)?"":__t)+"</b></span>\n"}else{var dealPrice=data.dealPrice.min.formattedPrice;if(data.dealPrice.isRange===!0){var priceSeparator=" - ";("CN"==gbResources.getCustomerData("realm")||((data.dealPrice.min.formattedPrice+data.dealPrice.max.formattedPrice).match(/\d/g)||[]).length>=12)&&(priceSeparator="-"),dealPrice+=priceSeparator+data.dealPrice.max.formattedPrice}dealPrice&&(__p+='\n<span id="dealDealPrice"><b>'+(null==(__t=dealPrice)?"":__t)+"</b></span>\n",data.discountPercentage&&data.elementDetails.showDiscount&&(__p+='\n<span id="dealPercentOff">',print(gbResources.getString(percentOffString,{discountPercentage:data.discountPercentage})),__p+="</span>\n"))}}__p+="\n</div>\n"}else{data.noPriceBlock=!0}}return __p},this.DealTemplates.onethirtyfive_hero_deal_prime_early_access=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){Deal.isDealInEarlyAccessWindow(data.deal)&&(__p+='\n<div id="primeEarlyAccessText" class="miniTextBold marginTop fullDealViewWidth">\n',print(gbResources.getString("gb_prime_early_access_deal")),__p+="\n",gbResources.customerData.hasEarlyAccessBenefit||(__p+='\n<div class = "divider">\n</div>\n'),__p+="\n</div>\n")}return __p},this.DealTemplates.onethirtyfive_hero_deal_badge=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){__p+="<div class=\"dotd-badge\">\n<div class='dotd-badge-image'></div>\n<div class='dotd-badge-text'>\n",print(gbResources.getString("goldbox-deal-of-the-day")),__p+="\n</div>\n</div>"}return __p},this.DealTemplates.onethirtyfive_hero_deal_button=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __p="",__j=(_.escape,Array.prototype.join);with(obj){var buttonImg=null,buttonAltText="",dealStatusMessage=null,cursorClass="";switch(data.purchaseState){case data.DealStateEnum.Available:buttonImg=gbResources.getImage("add_to_cart"),buttonAltText=gbResources.getString("csld-add_to_cart");break;case data.DealStateEnum.Variation:buttonImg=gbResources.getImage("select_options"),buttonAltText=gbResources.getString("csld-select_options_alt");break;case data.DealStateEnum.LearnMore:buttonImg=gbResources.getImage("learn_more_medium"),buttonAltText=gbResources.getString("csld-learn_more");break;case data.DealStateEnum.ViewDeal:buttonImg=gbResources.getImage("view_deal"),buttonAltText=gbResources.getString("csld-view_deal");break;case data.DealStateEnum.ClipCoupon:buttonImg=gbResources.getImage("clip_this_coupon"),buttonAltText=gbResources.getString("csld-clip_this_coupon");break;case data.DealStateEnum.InCart:break;case data.DealStateEnum.PendingAddToCart:buttonImg=gbResources.getImage("add_to_cart"),buttonAltText=gbResources.getString("csld-add_to_cart");break;case data.DealStateEnum.WaitListOnly:buttonImg=gbResources.getImage("join_waitlist"),buttonAltText=gbResources.getString("gbd_join_waitlist");break;case data.DealStateEnum.WaitListFull:__p+='\n<div class="miniText price">',print(gbResources.getString("gbd_waitlist_full")),__p+="\n</div>";break;case data.DealStateEnum.WaitListed:break;case data.DealStateEnum.Claimed:dealStatusMessage=data.generatedTemplates.claimed}Deal.checkIfDealExpired(data.deal)&&data.stateDisplayData&&void 0!==data.stateDisplayData.hasActionableStatus&&null!==data.stateDisplayData.hasActionableStatus&&!data.stateDisplayData.hasActionableStatus&&(buttonImg=null),null!==buttonImg?(print('<div id="dealActionButton" class="btn">'),print('<img class="'+cursorClass+'" src ='+buttonImg+' title="'+buttonAltText+'"/>'),print("</div>")):null!==dealStatusMessage&&print(dealStatusMessage)}return __p},this.DealTemplates.onethirtyfive_hero_deal_merchant_name=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj){if(data.noMerchantDisplay=!0,gbResources.isAmznMerchant(data.merchantID,data.merchantName)===!1&&data.merchantName){var escapedMerchantName=Deal.escapeHtml(data.merchantName);data.noMerchantDisplay=!1,__p+='\n<div id="dealMerchantName" class=\'localmerchantname\' title="'+(null==(__t=escapedMerchantName)?"":__t)+'">\n'+(null==(__t=escapedMerchantName)?"":__t)+"\n</div>\n"}}return __p},this.DealTemplates.onethirtyfive_hero_deal_early_access_message=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=(_.escape,Array.prototype.join);with(obj){if(__p+='<div id="earlyAccessContent" style="float:left;">',data.isPrimeEarlyAccessDeal){if(gbResources.customerData.hasEarlyAccessBenefit){__p+='\n<div class="miniTextBold marginTop">',print(gbResources.getString("gb_prime_early_access_deal")),__p+="\n</div>"}else{var primeSignUpUrl=gbResources.getString("primeSignUpRedirectUri");__p+='\n<div class = "divider">\n</div>\n<div class="miniTextBold marginTop">',print(gbResources.getString("gb_prime_early_access_deal")),__p+='\n</div>\n<div class="miniText">',print(gbResources.getString("gb_early_access_text",{duration:data.primeAccessDurationInMs/60000})),__p+='\n</div>\n<a class="miniText" style="color:#0066C0;" href="'+(null==(__t=primeSignUpUrl)?"":__t)+'">',print(gbResources.getString("gb_prime_link")),__p+="</a>",print(".")}}__p+="\n</div>"}return __p};
var ConnectionManager=Backbone.Collection.extend({initialize:function(){this.connections={};this.dealObjectToCallBacks=[];this.nextSignalID=100;this.signals={cell_change:{},pstatus_expire:{},page_change:{},metadata_change:{}}},registerWidgetConnections:function(b){var a=this;_.each(a.signals,function(c){c[b]={}});if(a.connections[b]===undefined){a.connections[b]=[]}},connectDealExpire:function(a,c,d){if(!Deal.watcher.doesCallBackExist(d.dealID,"expire")){var b=function(f){var e=a.dealServiceInstance[c].get_deal(f.dealID,function(g){f.off("cancelGetDealRequest");a.dealServiceInstance[c].translationHelper.populateFromGetDeals(f,g)},function(g){Deal.log("Error getting deal: "+g+" stack: "+g.stack)});f.on("cancelGetDealRequest",function(){e.cancel();f.off("cancelGetDealRequest")})};d.on("expire",b);this.dealObjectToCallBacks.push({signalName:"expire",scope:d,callBackValue:b});Deal.watcher.addCallBack(d.dealID,"expire")}if(d.expired||d.loading){d.trigger("expire",d)}},connectDealChange:function(b,d,a,e){var c=function(f){b.trigger("cell_change"+d,{cell:a,deal:f})};e.on("change",c);this.connections[d].push({signalName:"change",scope:e,callBackValue:c})},connectPstatusExpire:function(b,d,a,e){var c=function(i,h){if(i.dealAsinsHash!==undefined&&i.dealAsinsHash!==null){if(_.keys(i.dealAsinsHash).length<=1){var g=Deal.findBackBoneDealAsin(i);if(g!==undefined&&g!==null&&g.status!==undefined&&g.status!==null&&g.status.state!==undefined&&g.status.state!==null){i.lastPstatusExpireState=g.status.state;if(Deal.checkIfDealExpired(i)){if(g.status.state===Deal.inCartStr||g.status.state===Deal.pendingAtcStr){g.status.state="Expired";i.trigger("change",i)}}}var f=function(){i.lastPstatusExpireState="";delete i.checkingDealStatusTimeout};i.checkingDealStatusTimeout=window.setTimeout(f,40000)}}i.trigger("status_expire",i);b.trigger("pstatus_expire"+d,{cell:a,deal:i,expiring_asin:h})};e.on("pstatus_expire",c);this.connections[d].push({signalName:"pstatus_expire",scope:e,callBackValue:c})},connectDealStatusExpire:function(a,c,d){if(!Deal.watcher.isDealBeingWatched(d.dealID,c)){var b=function(g){var f=a.dealServiceInstance[c].get_deal_status(g.dealID,function(h){g.off("cancelGetDealStatusRequest");a.dealServiceInstance[c].translationHelper.populateFromGetDealStatus(g,h)},function(h){Deal.log("Error getting status: "+h+" stack: "+h.stack)},a);g.on("cancelGetDealStatusRequest",function(){f.cancel();g.off("cancelGetDealStatusRequest")});var e=a.dealServiceInstance[c].get_deal_asin_status2(g.dealID,function(h){g.off("cancelGetDealAsinStatusRequest");a.dealServiceInstance[c].translationHelper.populateFromGetDealAsinStatus(g,h);g.trigger("change",g)},function(h){Deal.log("Error with GetDealAsinStatus("+g.dealID+"): "+h)});g.on("cancelGetDealAsinStatusRequest",function(){e.cancel();g.off("cancelGetDealAsinStatusRequest")})};d.on("status_expire",b);this.dealObjectToCallBacks.push({signalName:"status_expire",scope:d,callBackValue:b})}if(d.status.expired&&!(d.expired||d.loading)){d.trigger("status_expire",d)}},connectSignal:function(e,a,d,g,f){if(e===undefined||e===null||a===undefined||a===null||d===undefined||d===null||g===undefined||g===null||f===undefined||f===null){throw new Error("Please provide a valid scope, signalName, widgetID, functionName")}if(this.signals[a]===undefined){throw new Error("Please provide a valid scope, signalName, widgetID, functionName")}if(this.signals[a][d]===undefined){throw new Error("Please provide a valid scope, signalName, widgetID, functionName")}var h=this.nextSignalID;var b;var c;if(f===undefined){b=g;e.on(a+d,b)}else{c=f[g];f.on(a+d,c);b=function(i){f.trigger(a+d,i)};e.on(a+d,b)}this.signals[a][d][h]={callBackValue:b,scope:f,scopeCallBackValue:c};this.nextSignalID++;return{widgetID:d,id:h}},disconnectCurrentPageSignals:function(a,d){_.each(a.dealsInCurrentView[d],function(f){Deal.watcher.unwatchDeal(f.dealID,d)});_.each(a.dealsInNextView[d],function(f){Deal.watcher.unwatchDeal(f.dealID,d)});a.dealsInCurrentView[d]=[];a.dealsInNextView[d]=[];for(var b=0;b<this.dealObjectToCallBacks.length;b++){var c=this.dealObjectToCallBacks[b];if(c!==undefined&&c!==null){if(c.scope&&c.signalName){if(c.scope.dealID){var e=c.scope;if(Deal.watcher.isDealBeingWatched(e.dealID)){continue}if(c.signalName==="expire"&&Deal.watcher.doesCallBackExist(e.dealID,"expire")){e.trigger("cancelGetDealRequest");Deal.watcher.removeCallBack(e.dealID,"expire")}if(c.signalName==="status_expire"){e.trigger("cancelGetDealStatusRequest");e.trigger("cancelGetDealAsinStatusRequest")}e.off(c.signalName,c.callBackValue);this.dealObjectToCallBacks.splice(_.indexOf(this.dealObjectToCallBacks,c),1);--b}}}}var c;for(var b=0;b<this.connections[d].length;b++){c=this.connections[d][b];if(c!==undefined&&c!==null){if(c.scope&&c.signalName){if(c.scope.dealID){if(c.signalName==="change"||c.signalName==="pstatus_expire"){c.scope.off(c.signalName,c.callBackValue);this.connections[d].splice(_.indexOf(this.connections[d],c),1);--b}}}}}}});if(!window.Deal){window.Deal={}}Deal.connectionManager=new ConnectionManager();
var DealsTranslationHelper=Backbone.Collection.extend({initialize:function(){},validate:function(){},populateDealState:function(){},populateFromGetDealMetadata:function(){},populateFromGetDeals:function(){},populateFromItem:function(){},populateFromGetDealStatus:function(){},populateFromGetDealAsinStatuses:function(){},populateFromGetDealAsinStatus:function(){},populateFromRedeemDeal:function(){},initStatus:function(){},initAsinStatus:function(){},setPurchaseStatusWarningThreshold:function(){},getPurchaseStatusWarningThreshold:function(){},executePostTranslationRules:function(f){if(f===undefined||f===null){return}if(f.dealType==="LOCAL_DEAL"&&f.detail){var d=f.detail.URL;if(d){var c=d.match(/:\/\/(.[^/]+)/)[1];if(c&&c.match(/^local\./)){var a=d.split(c);c=c.replace(/^local\./,"www.");var h=a[0];var g=a[1];if(h&&g){f.detail.URL=h+c+"/local"+g}}}}if(window.Deal.isPaladin&&window.Deal.isPaladin==1){if(f.detail){f.detail.URL=Deal.ConvertToPaladinUrl(f.detail.URL);f.detail.buyBoxURL=Deal.ConvertToPaladinUrl(f.detail.buyBoxURL)}if(f.dealAsinsHash){for(var e in f.dealAsinsHash){var b=f.dealAsinsHash[e];if(b!==null&&b!==undefined){b.egressUrl=Deal.ConvertToPaladinUrl(b.egressUrl);b.ingressUrl=Deal.ConvertToPaladinUrl(b.ingressUrl)}}}}}});
var DealContentServiceTranslationHelper=DealsTranslationHelper.extend({initialize:function(a){},validate:function(a){},populateFromGetDealMetadata:function(){},populateFromGetDeals:function(d,c){if(!d||!c){Deal.log("ERROR: DealContentServiceTranslationHelper: deal/jsonDeal object passed into populateFromGetDeals was null/undefined.");return}var b=new Date();d.loading=false;if(!d.legacyDeal){d.legacyDeal=new Deal.Model.Deal(c.dealID)}if(d.legacyDealID===c.dealID){this.translateDealServiceRedemptionData(d,c);this.initStatus(d,b);this.initAsinStatus(d);d.legacyDeal.load_status_from_deal_dao(d);d.trigger("change",d);return}d.customerID=gbResources.getCustomerData("customerId");d.claimed=false;d.dealID=c.dealID;d.legacyDealID=c.legacyDealID;d.parentAsin=null;d.dealType=c.type;if(c.parentItems){if(!d.parentItems){d.parentItems={}}var a;for(a in c.parentItems){if(!d.parentAsin){d.parentAsin=a}d.parentItems[a]=c.parentItems[a]}}d.isLimitedQuantity=false;d.limitedQuantity=false;if(c.quantity){c.quantity=parseInt(c.quantity,10)}if(d.dealType==Deal.dealTypes.LD||(c.quantity&&c.quantity>0)){d.isLimitedQuantity=true;d.limitedQuantity=true}d.detail.marketplaceID=null;d.detail.score=parseInt(c.score,10);d.detail.title=c.title;d.detail.description=c.description;d.detail.leakDescription=c.leakDescription;d.detail.marketingMessage=c.marketingMessage;d.detail.geoDisplayName=c.geoDisplayName;d.detail.imageAsin=Deal.checkAndSetSSLImageUrl(c.primaryImage);d.detail.secondaryImages=c.secondaryImages;d.detail.URL=c.egressUrl;d.detail.buyBoxURL=c.ingressUrl;d.detail.displayPriority=parseInt(c.displayPriority,10);d.detail.isFeatured=Deal.parseBool(c.isFeatured);if(!d.detail.imageAsin){d.detail.imageAsin=gbResources.getImage("no_image")}if(c.impressionAsin){d.impressionAsin=c.impressionAsin}d.detail.isPrimeEarly=false;d.detail.isPrimeOnly=false;if(c.primeAccessType==Deal.primeAccessTypeEnum.PRIME_EARLY_ACCESS&&gbResources.getFeature("prime-early-access")){d.detail.primeAccessType=Deal.primeAccessTypeEnum[c.primeAccessType];d.detail.primeAccessDurationInMs=parseInt(c.primeAccessDuration,10)*60*1000;d.detail.isPrimeEarly=true}else{if(c.primeAccessType==Deal.primeAccessTypeEnum.PRIME_ONLY_LD&&gbResources.getFeature("prime-only-access")){d.detail.isPrimeOnly=true;d.detail.primeAccessType=Deal.primeAccessTypeEnum.PRIME_ONLY_LD}else{if(c.primeAccessType==Deal.primeAccessTypeEnum.PRIME_ONLY_DOTD&&gbResources.getFeature("prime-only-access")){d.detail.isPrimeOnly=true;d.detail.primeAccessType=Deal.primeAccessTypeEnum.PRIME_ONLY_DOTD}}}d.discussionBoardURL="/gp/goldbox/discussion/"+d.dealID;d.auxiliaryData.isPrimeEligible=Deal.parseBool(c.isPrimeEligible);d.auxiliaryData.breaksMAP=Deal.parseBool(c.isMAP);if(!c.merchantID&&!c.merchantName){d.auxiliaryData.merchantDetails=null}else{d.auxiliaryData.merchantDetails={merchantID:c.merchantID,merchantName:c.merchantName}}if(c.reviewAsin){d.buyAsin=c.reviewAsin;d.auxiliaryData.reviewData={averageRating:parseFloat(c.reviewRating),totalReviews:parseInt(c.totalReviews,10),reviewsURL:"/gp/product-reviews/"+c.reviewAsin}}else{d.auxiliaryData.reviewData=null}if(c.teaser){d.teaser.teaserLine=c.teaser;if(c.teaserImage){d.teaser.teaserImage=Deal.checkAndSetSSLImageUrl(c.teaserImage)}if(c.teaserAsin){d.teaser.teaserAsin=c.teaserAsin;d.teaser.teaserURL="/gp/product/"+c.teaserAsin}}if(c.items){this.populateFromItems(d,c)}this.executePostTranslationRules(d);d.legacyDeal.load_from_deal_dao(d)},translateDealServiceRedemptionData:function(e,d){var c=new Date();if(d.customer){e.customerID=d.customer.customerID;e.claimed=Deal.parseBool(d.customer.claimed);for(i=0;i<d.asins.length;i++){var a=d.asins[i];var b=null;if(e.dealAsinsHash){b=e.dealAsinsHash[a.asin]}if(a.status&&b){if(a.status.currentlyUnavailable!==null&&a.status.currentlyUnavailable!==undefined){b.status.currentlyUnavailable=Deal.parseBool(a.status.currentlyUnavailable)}if(a.status.offerServiceSoldOut!==null&&a.status.offerServiceSoldOut!==undefined){b.status.offerServiceSoldOut=Deal.parseBool(a.status.offerServiceSoldOut)}if(a.status.percentClaimed!==null&&a.status.percentClaimed!==undefined){b.status.percentClaimed=parseInt(a.status.percentClaimed,10)}if(a.status.percentSoldOut!==null&&a.status.percentSoldOut!==undefined){b.status.percentSoldOut=parseInt(a.status.percentSoldOut,10)}if(a.status.purchaseStatus){if(a.status.purchaseStatus.totalAvailable!==null&&a.status.purchaseStatus.totalAvailable!==undefined){b.totalAvailable=parseInt(a.status.purchaseStatus.totalAvailable,10)}b.status.state=a.status.purchaseStatus.state;if(a.status.purchaseStatus.msToExpiry!==null&&a.status.purchaseStatus.msToExpiry!==undefined){b.status.msToExpiry=parseInt(a.status.purchaseStatus.msToExpiry,10)}if(a.status.purchaseStatus.lastUpdated!==null&&a.status.purchaseStatus.lastUpdated!==undefined){b.status.lastUpdated=parseInt(a.status.purchaseStatus.lastUpdated,10)}b.status.expiresDate=new Date(c.getTime()+parseInt(a.status.purchaseStatus.msToExpiry,10));if(a.status.purchaseStatus.waitListStatus){if(a.status.purchaseStatus.waitListStatus.position!==null&&a.status.purchaseStatus.waitListStatus.position!==undefined){b.waitListStatus.position=parseInt(a.status.purchaseStatus.waitListStatus.position,10)}b.waitListStatus.chance=a.status.purchaseStatus.waitListStatus.inCartIndicator;b.waitListStatus.timeToWait=a.status.purchaseStatus.waitListStatus.timeToWait}}e.dealAsinsHash[a.asin]=b}}}},translateClaimDealResponse:function(e,f,b){if(b===undefined||b===null){return}var d=new Date();e.loading=false;var c=_.find(e.dealAsins,function(g){if(g.ASIN===f){return g}});var a=b.dealItemStatus;if(a!==undefined&&a!==null){c.status.itemState=b.dealItemStatus.itemState;c.status.state=Deal.customerStates[b.dealItemStatus.customerState];c.status.msToExpiry=b.dealItemStatus.msToCustomerStateExpiry}if(b.msCacheTtl!==undefined&&b.msCacheTtl!==null){e.status.msToCacheExpires=parseInt(b.msCacheTtl,10)}e.legacyDeal=new Deal.Model.Deal(e.dealID);e.legacyDeal.load_from_deal_dao(e);this.initStatus(e,d);this.initAsinStatus(e)},populateFromItems:function(e,c){if(e===undefined||e==null||c==undefined||c==null){var d="";if(!e){d+="deal = null"}else{if(!c){d+="jsonDeal = null. dealID = "+e.dealID}}Deal.log("ERROR: DealContentServiceTranslationHelper: Deal object or jsonDeal object passed into populateFromItems was null or undefined. "+d);return}var g=c.items;var b=0;for(b=0;b<g.length;b++){var a=g[b];var f=a.itemID;if(e.dealAsinsHash[f]===undefined||e.dealAsinsHash[f]===null){if(!a.itemID){var d="dealID = "+e.dealID;Deal.log("ERROR: DealContentServiceTranslationHelper: populateFromItems: Null or undefined Asin passed. "+d)}e.dealAsinsHash[f]=new DealAsinDAO(a.itemID);e.dealAsins.push(e.dealAsinsHash[f])}e.dealAsinsHash[f].parentDealDAO=e;this.populateFromItem(e.dealAsinsHash[f],a,e.dealType)}e.setItemType(c.itemType);if((e.itemType===null||e.itemType===undefined)&&e.itemType==Deal.itemTypes.SingleItem&&e.dealAsins&&e.dealAsins.length==1){e.buyAsin=e.dealAsins[0].ASIN}if(e.offerListingID===null||e.offerListingID===undefined){if(e.dealAsins&&e.dealAsins.length==1){e.offerListingID=e.dealAsins[0].offerID}else{if(e.itemType==Deal.itemTypes.SingleItem&&c.offerID){e.offerListingID=c.offerID}}}e.calculatePriceData(c);e.calculateAuxiliaryDataFromItem();Deal.log("DealContentServiceTranslationHelper: Populate form Items Complete Pushed "+b+" DealAsins")},populateFromItem:function(d,b,a){d.ASIN=b.itemID;d.dealID=b.dealID;if(b.variationDimensions){d.variationData=d.variationData||{};_.each(b.variationDimensions,function(f,e){var g=f.replace(/\s+/g," ");b.variationDimensions[e]=g;d.variationData[e]=g})}if(b.dealPrice!==undefined&&b.dealPrice!==null){d.dealPrice={currency:b.currencyCode,price:parseFloat(b.dealPrice)};d.dealPriceFormatted=Deal.Price.format(d.dealPrice)}if(b.bAmount!==undefined&&b.bAmount!==null){d.basisPrice={currency:b.currencyCode,price:parseFloat(b.bAmount)};d.basisPriceFormatted=Deal.Price.format(d.basisPrice);d.basisKind=b.bKind}if(d.basisPrice&&d.dealPrice){d.percentOffBasisPrice=Deal.Price.percent_off(d.basisPrice,d.dealPrice);if(d.percentOffBasisPrice){try{d.percentOffBasisPriceFormatted=Math.round(d.percentOffBasisPrice)}catch(c){Deal.log("UnknownFormat percentageOffBasisPrice Object."+c)}}}d.percentOff=Deal.Price.displayable_percent_off(parseInt(b.percentOff));d.egressUrl=b.egressUrl;d.ingressUrl=b.ingressUrl;d.isParentItem=b.isParentItem;d.imageURL=b.primaryImage;if(d.imageURL===undefined||d.imageURL===null){d.imageURL=gbResources.getImage("no_image")}if(b.isOneClickable!==null&&b.isOneClickable!==undefined){d.isOneClickable=Deal.parseBool(b.isOneClickable)}if(b.isTimeLimited!==null&&b.isTimeLimited!==undefined){d.isTimeLimited=Deal.parseBool(b.isTimeLimited)}if(b.isWaitlistable!==null&&b.isWaitlistable!==undefined){d.isWaitlistable=Deal.parseBool(b.isWaitlistable)}d.offerID=b.offerID;if(b.perCustomerAmount!==null&&b.perCustomerAmount!==undefined){d.perCustomerAmount=parseInt(b.perCustomerAmount,10)}d.auxiliaryData.isPrimeEligible=Deal.parseBool(b.isPrimeEligible);d.auxiliaryData.breaksMAP=Deal.parseBool(b.isMAP);d.auxiliaryData.merchantDetails={merchantID:b.merchantID,merchantName:b.merchantName};d.auxiliaryData.reviewData={averageRating:parseFloat(b.reviewRating),totalReviews:parseInt(b.totalReviews,10),reviewsURL:"/gp/product-reviews/"+b.itemID};return d},populateFromSelectDealsMetadata:function(a,b){if(a===undefined||a===null){Deal.log("Cannot populate select deals metadata for undefined/null widgetID.");return}if(b===undefined||b===null){Deal.log("Cannot populate select deals metadata for undefined/null data.");return}var c={};c.dealStateHash=b.dealsByState;c.dealCategoryHash=b.dealsByCategory;c.dealAccessTypeHash=b.dealsByAccessType;c.sortedDealList=b.sortedDealIDs;c.selectDealsPageSize=b.selectDealsPageSize;Deal.controller.metadata.registerResponseData(a,c)},populateFromGetDealStatuses:function(d,a){if(d===undefined||d===null){Deal.log("Cannot populateFromGetDealStatuses for undefined/null json obj.");return}var c;for(var b in d){if(a.deals[b]!==undefined&&a.deals[b]!==null){c=a.getDeal(b);this.populateFromGetDealStatus(c,d[b])}else{Deal.log("We cannot do a status update on a DealObject that doesn't exist.")}}},populateFromGetDealStatus:function(f,g){var b=new Date();if(f===undefined||f===null){Deal.log("Cannot populateFromDealStatus for undefined/null deal obj.");return}if(g===undefined||g===null){Deal.log("Cannot populateFromDealStatus for undefined/null json obj.");return}if(g.lastUpdated!==undefined&&g.lastUpdated!==null){g.lastUpdated=parseInt(g.lastUpdated,10);if(f.status.lastUpdated!==undefined&&f.status.lastUpdated!==null&&f.status.lastUpdated>g.lastUpdated){return}else{f.status.lastUpdated=g.lastUpdated}}if(g.totalCouponCount!==undefined&&g.totalCouponCount!==null){f.status.totalCouponsCount=parseInt(g.totalCouponCount,10)}if(g.dealState!==undefined&&g.dealState!==null){f.status.dealState=g.dealState;var c=Deal.dealStates[g.dealState];var d=Deal.stateToTemplateMap[c];if(d!==undefined&&d!==null){f.dealState=d}}if(g.msToEnd!==undefined&&g.msToEnd!==null){f.status.msToEnd=parseInt(g.msToEnd,10)}if(g.msToStart!==undefined&&g.msToStart!==null){f.status.msToStart=parseInt(g.msToStart,10);if(f.dealState===Deal.stateToTemplateMap.Upcoming&&f.status.msToStart<=0){f.dealState=Deal.stateToTemplateMap.ComingSoon}}if(g.msCacheTtl!==undefined&&g.msCacheTtl!==null){f.status.msToCacheExpires=parseInt(g.msCacheTtl,10)}if(g.percentClaimed!==undefined&&g.percentClaimed!==null){f.status.percentClaimed=parseInt(g.percentClaimed,10)}if(g.dealItemStatus!==undefined&&g.dealItemStatus!==null){this.populateFromDealItemStatuses(f,g.dealItemStatus)}for(var e in g.dealItemStatus){if(f.dealAsinsHash[e]===null||f.dealAsinsHash[e]===undefined){var a=new DealAsinDAO(e);a.parentDealDAO=f;f.dealAsins.push(a);f.dealAsinsHash[e]=a}}this.initStatus(f,b);this.initAsinStatus(f);f.trigger("change",f);if(!(f.legacyDeal===undefined||f.legacyDeal===null)){f.legacyDeal.load_status_from_deal_dao(f)}},populateFromDealItemStatuses:function(d,c){if(d===undefined||d===null){Deal.log("Cannot populateFromDealItemStatuses for undefined/null deal obj.");return}if(c===undefined||c===null){Deal.log("Cannot populateFomDealItemStatuses for undefined/null json obj.");return}var a;for(var b in c){if(d.dealAsinsHash[b]!==undefined&&d.dealAsinsHash[b]!==null){a=d.dealAsinsHash[b];this.populateFromDealItemStatus(a,c[b])}else{Deal.log("Cannot populate itemStatus on a non-existed item for imte: "+b)}}},populateFromDealItemStatus:function(b,a){if(b===undefined||b===null){Deal.log("Cannot populateFromDealItemStatus for undefined/null dealAsin.");return}if(a===undefined||a===null){Deal.log("Cannot populate DealItemStatus from undefined/null json obj.");return}if(a.lastUpdated!==undefined&&a.lastUpdated!==null){a.lastUpdated=parseInt(a.lastUpdated,10);if(b.status.lastUpdated!==undefined&&b.status.lastUpdated!==null&&b.status.lastUpdated>a.lastUpdated){return}else{b.status.lastUpdated=a.lastUpdated}}if(a.totalCouponCount!==undefined&&a.totalCouponCount!==null){b.status.totalCouponsCount=parseInt(a.totalCouponCount,10)}if(a.customerState!==undefined&&a.customerState!==null){b.status.state=Deal.customerStates[a.customerState]}if(a.itemState!==undefined&&a.itemState!==null){b.status.itemState=a.itemState;if(Deal.itemStateToPurchaseStateMap[b.status.itemState]==Deal.dealStateEnum.SoldOut){b.status.percentSoldOut=100}}if(a.msCacheTtl!==undefined&&a.msCacheTtl!==null){b.status.msToCacheExpires=parseInt(a.msCacheTtl,10)}if(a.msToCustomerStateExpiry!==undefined&&a.msToCustomerStateExpiry!==null){b.status.msToExpiry=parseInt(a.msToCustomerStateExpiry,10)}if(a.percentClaimed!==undefined&&a.percentClaimed!==null){b.status.percentClaimed=parseInt(a.percentClaimed,10)}if(a.waitlistChance!==undefined&&a.waitlistChance!==null){b.waitListStatus.chance=a.waitlistChance}if(a.waitlistPosition!==undefined&&a.waitlistPosition!==null){b.waitListStatus.position=parseInt(a.waitlistPosition,10)}if(Deal.customerStates[a.customerState]===Deal.claimedStr){b.isCustomerClaimed=true}else{b.isCustomerClaimed=false}},initStatus:function(f,b){f.status.cacheExpiresDate=new Date(b.getTime()+parseInt(f.status.msToCacheExpires,10));f.status.expired=false;f.status.startDate=new Date(b.getTime()+parseInt(f.status.msToStart,10));f.status.started=f.status.msToStart<=0;f.status.endDate=new Date(b.getTime()+parseInt(f.status.msToEnd,10));f.status.ended=f.status.msToEnd<=0;if(f.claimed){f.claimed=f.claimed=="1"}if(f.timeouts.startTimeout){window.clearTimeout(f.timeouts.startTimeout);Deal.log("DealServiceTranslationHelper._init_status: Clearing out deal.timeouts.startTimeout for deal: "+f.dealID)}if(!f.status.started){f.timeouts.startTimeout=window.setTimeout(function(){var g=f.dealID;Deal.controller.dealServiceClients.DealContentService.dealsWithDetails[g]=false;f.trigger("change",Deal.controller.getDeal("DummyDealID"));var h=Deal.controller.dealServiceClients.DealContentService;h.addToGetDealsCache(g);Deal.log("Triggering change signal on deal: "+f.dealID+" from deal.timeouts.startTimeout Trigger.")},f.status.startDate.getTime()-new Date().getTime());Deal.log("DealServiceTranslationHelper._init_status: Setting deal.timeouts.startTimeout for deal: "+f.dealID)}if(f.timeouts.endTimeout){window.clearTimeout(f.timeouts.endTimeout);Deal.log("DealServiceTranslationHelper._init_status: Clearing out deal.timeouts.endTimeout for deal: "+f.dealID)}if(!f.status.ended){var c=f.status.endDate.getTime()-new Date().getTime();var e=function(){f.timeouts.endTimeout=window.setTimeout(function(){f.status.ended=true;f.trigger("change",f);Deal.log("Triggering change signal on deal: "+f.dealID+" from deal.timeouts.endTimeout Trigger.")},f.status.endDate.getTime()-new Date().getTime())};if(f.timeouts.endTimeoutDelayed){window.clearTimeout(f.timeouts.endTimeoutDelayed)}f.timeouts.endTimeoutDelayed=Deal.setSafeTimeout(e,c);Deal.log("DealServiceTranslationHelper._init_status: Setting deal.timeouts.endTimeOut for deal: "+f.dealID)}if(f.timeouts.earlyAccessTimeOut){window.clearTimeout(f.timeouts.earlyAccessTimeOut)}if(Deal.isDealInEarlyAccessWindow(f)){f.timeouts.earlyAccessTimeOut=window.setTimeout(function(){f.status.msToStart=-(f.detail.primeAccessDurationInMs);f.trigger("change",f)},f.status.startDate.getTime()+f.detail.primeAccessDurationInMs-new Date().getTime())}if(f.timeouts.statusExpireTimeout){window.clearTimeout(f.timeouts.statusExpireTimeout);Deal.log("DealServiceTranslationHelper._init_status: Clearing out deal.timeouts.statusExpireTimeout for deal: "+f.dealID)}var d=f.status.cacheExpiresDate.getTime()-new Date().getTime();if(Deal.checkIfDealExpired(f)){var a=new Deal.PurchaseStatusGatherer(f);if(a.hasTimeSensitiveState()){d=12000}}f.timeouts.statusExpireTimeout=window.setTimeout(function(){f.status.expired=true;f.trigger("status_expire",f);Deal.log("Triggering status_expire signal on deal: "+f.dealID+" from deal.timeouts.statusExpireTimeout Trigger.")},d);Deal.log("DealServiceTranslationHelper._init_status: Setting deal.timeouts.statusExpireTimeout for deal: "+f.dealID+" for timeout: "+(f.status.cacheExpiresDate.getTime()-new Date().getTime()));Deal.log("DealServiceTranslationHelper.initStatus completed.")},initAsinStatus:function(d){if(d===undefined||d===null){Deal.log("Cannot operate on undefined/null deal object.");return}if(d.dealType===undefined||d.dealType===null){Deal.log("Cannot operate on undefined/null dealType.");return}if(d.dealType!==Deal.dealTypes.LD){Deal.log("Returning initAsinStatus as NO-OP for non-LD's.");return}if(!d.dealAsinsHash){Deal.log("No Asins, not initializing asinStatuses");return}if(!d.timeouts.pstatusExpiresSoon){d.timeouts.pstatusExpiresSoon={}}if(!d.timeouts.pstatusExpire){d.timeouts.pstatusExpire={}}_.each(d.dealAsins,function(k){if(Deal.dealStates[k.status.itemState]===Deal.waitlistFullStr){k.status.currentlyUnavailable=true}});var c=Deal.filterAsinsHashByState(d.dealAsinsHash,[Deal.inCartStr,Deal.expiredStr,Deal.waitInLineStr,Deal.pendingAtcStr]);Deal.log("DealServiceTranslationHelper.initAsinStatus: FilteredAsins: "+JSON.stringify(c));var a=new Date();for(var e=0;e<c.length;e++){var j=c[e];if(d.purchaseStatusWarningThreshold){j.status.expiresDate=new Date(a.getTime()+parseInt(j.status.msToExpiry,10))}}c.sort(Deal.sortByDealAsinDAOTimes);Deal.log("DealServiceTranslationHelper.initAsinStatus: SortedFilteredAsins: "+JSON.stringify(c));d.asinExpiresSoonStack=[];d.asinExpiredStack=[];for(var e=0;e<c.length;e++){var j=c[e];if(d.timeouts.pstatusExpiresSoon[j.ASIN]){window.clearTimeout(d.timeouts.pstatusExpiresSoon[j.ASIN]);Deal.log("DealServiceTranslationHelper.initAsinStatus: Clearing deal.timeouts.pstatusExpiresSoon for  ASIN: "+j.ASIN)}var g=j.status.expiresDate.getTime()-new Date().getTime();var h=g-d.purchaseStatusWarningThreshold;if(h<0){h=0}var b=""+j.ASIN;if(g>0&&j.status.state!=Deal.waitInLineStr&&j.status.state!=Deal.pendingAtcStr){d.asinExpiresSoonStack.push(b);d.timeouts.pstatusExpiresSoon[b]=window.setTimeout(function(){var k=d.asinExpiresSoonStack.shift();Deal.log("DealServiceTranslationHelper.initAsinStatus: TimeOut completed for pstatusExpiresSoon: originalStaticAsin: "+b+" tmpAsin: "+k)},h);Deal.log("DealServiceTranslationHelper.initAsinStatus: Timeout set for pstatusExpiresSoon for ASIN : "+b+" for endsSoonTimeout: "+h)}if(d.timeouts.pstatusExpire[j.ASIN]){window.clearTimeout(d.timeouts.pstatusExpire[j.ASIN]);Deal.log("DealServiceTranslationHelper.initAsinStatus: Clearing pstatusExpire for ASIN: "+j.ASIN)}d.asinExpiredStack.push(b);var f=function(l){var k=d.asinExpiredStack.shift();if(l!==undefined&&l!==null&&l>0){d.trigger("pstatus_expire",d,k)}else{d.trigger("change",d)}Deal.log("DealServiceTranslationHelper.initAsinStatus: TimeOut completed for: pstatusExpire for ASIN: "+j.ASIN+" tmpAsin: "+k)};if(g>0){d.timeouts.pstatusExpire[j.ASIN]=window.setTimeout(function(){f(g)},g)}Deal.log("DealServiceTranslationHelper.initAsinStatus: Timeout set for pstatusExpire for ASIN: "+j.ASIN+" pStatusTimeout: "+g)}Deal.log("DealServiceTranslationHelper.initAsinStatus completed.")}});
var DealsInterface=Backbone.Model.extend({defaults:{versionInfo:null},baseURL:null,base_retry_interval:60000,continue_requests:true,marketplace_id:"1",includeVariations:"True",customer_id:"",session_id:null,timeout:5*60*1000,translationHelper:null,filter:{},statuses:{},browseNodes:null,ordering:null,controllerReference:null,initialize:function(){},ajax_with_retries:function(c,g){var i=this;var b=new Date();var f=0;var d=c.retryInterval||this.base_retry_interval||60000;delete c.retryInterval;var e=c.error;delete c.error;var h=c.success;c.success=function(j){if(j&&Deal.parseBool(j.retry)){c.error()}else{if(g){g.isRetry=f>0;g.isSuccess=true;var k=new Date();g.latency=k.getTime()-b.getTime();Deal.recordAPIMetrics(g)}h(j)}};var a=function(){if(!i.continue_requests){e(new Error("continue_requests is false. No more requests should be made "+c.url));return}c.url=Deal.setURLParameter(c.url,"nocache",new Date().getTime());c.error=function(l){if(g){g.isRetry=f>0;g.isSuccess=false;var j=new Date();g.latency=j.getTime()-b.getTime();Deal.recordAPIMetrics(g)}c.url=Deal.setURLParameter(c.url,"retrying",1);var k=d*(1+Math.pow(2,f++)*Math.random());if(k+new Date().getTime()-b.getTime()>i.timeout){e(new Error("Request timed out "+c.url))}else{Deal.log("Retrying after "+k+"ms");window.setTimeout(a,k)}};if(window.P&&window.P.AUI_BUILD_DATE){P.when("jQuery").execute(function(j){j.ajax(c)})}else{jQuery.ajax(c)}};a()},call:function(){},getDeals:function(){},getDealMetadata:function(){},_deal_ids_from_callbacks:function(){},get_deals:function(){},get_deal_statuses:function(){},get_deal_asin_statuses:function(){},get_deal_asin_status:function(){},get_deal_asin_status2:function(){},redeem_deal:function(){},_pending:{},next_id:100,get_deal:function(){},get_deal_status:function(){},_add_request:function(){},_start_request_timer:function(){},_start_request:function(){},_request_success:function(){},_request_error:function(){}});
var DealContentService=DealsInterface.extend({base_retry_interval:60000,client_id:"goldbox",continue_requests:true,customer_id:null,dealsPerPage:null,marketplace_id:null,page:1,session_id:null,timeout:5*60*1000,translationHelper:null,getDealsMaxJitter:Deal.constants.GET_DEALS_MAX_JITTER,widgetMetadataCache:{},selectDealsRequestArgs:{},uniqueSelectDealsRequestArgs:[],onGoingSelectDealsRequest:{},widgetIdToArgs:{},firstGetDeals:{},dealsWithDetails:{},dealStateFilter:{available:["AVAILABLE"],missed:["EXPIRED","SOLDOUT"],expired:["EXPIRED"],upcoming:["UPCOMING"],soldout:["SOLDOUT"]},getDealsCache:[],initialize:function(){this.customer_id=gbResources.getCustomerData("customerId");this.marketplace_id=gbResources.getCustomerData("marketplaceId");this.session_id=gbResources.getCustomerData("sessionId");this.translationHelper=new DealContentServiceTranslationHelper},addToGetDealsCache:function(b){var a=this;if(b===null||b===undefined){Deal.log("addToGetDealsCache called with null/undefined dealID");return}if(_.contains(a.getDealsCache,b)){return}a.getDealsCache.push(b);if(a.getDealsCache.length===1){var c=Math.floor(Math.random()*a.getDealsMaxJitter*1000);c+=500;window.setTimeout(function(){var d=[];_.each(a.getDealsCache,function(e){if(!a.dealsWithDetails[e]){d.push(e)}});a.getDealsCache=[];if(d.length){a.get_Deals(d,Deal.controller,true)}},c)}},getMetadataCacheWidgets:function(){var a=_.map(_.keys(this.widgetMetadataCache),function(b){return parseInt(b,10)});return a.sort()},processWidgetMetadataCache:function(a){var c=this;var e=c.getMetadataCacheWidgets();for(var b=0;b<e.length;b++){var d=e[b];if(c.isReadyToLoadMetadata(d,a)){c.processWidgetMetadataCacheEntry(d,a)}}},processWidgetMetadataCacheEntry:function(c,a){var b=this;var d=b.widgetMetadataCache[c];a.trigger("process_selectdeals_metadata"+c,c,d);delete b.widgetMetadataCache[c]},isReadyToLoadMetadata:function(f,a){var c=this;if(a.disableDeduping[f]){return true}var e=a.getWidgetsToLoadMetadata(f);e.push(f);for(var b=0;b<e.length;b++){var d=e[b];if(!(d in c.widgetMetadataCache)){return false}}return true},call:function(c,e,h,b,g,d){var a=this;var f={success:function(i){if(i.responseMetadata){this.base_retry_interval=i.responseMetadata.baseRetryInterval;this.continue_requests=i.responseMetadata.continueRetries}h(i)},error:b,url:c,type:"POST",data:JSON.stringify(e),dataType:"json"};if(g!==undefined){f.retryInterval=g}a.ajax_with_retries(f,d)},getDeals:function(i,m,g,o,c,d,k,f){if(i===undefined||i===null){Deal.log("Need a proper controller reference to getDeals.");return}if(m===undefined||m===null){Deal.log("Cannot getDeals for an undefined/null widgetID.");return}if(this.firstGetDeals[m]===undefined){this.firstGetDeals[m]=true}i.listOfDeals[m]=[];var n=this;var b=function(t){var q=[];for(var r=0;r<t.length;r++){var s=t[r];if(!n.dealsWithDetails[s]){q.push(s);n.dealsWithDetails[s]=true}}if(q.length){n.get_Deals(q,i)}};i.on("startGetDealStatusesAdhoc",b);var h=function(s){delete n.onGoingSelectDealsRequest[m];Deal.log("Select Deals call returned.");i.off("selectdeals_change"+m,h);if(s===undefined||s===null){Deal.log("Cannot populateGetDeals data with undefined/null data.");return}var t=function(v,w){Deal.log("Processing SelectDealsMetadataResponse for widgetID "+v);if(v===undefined||v===null){Deal.log("Cannont processSelectDealsMetadataResponse for null/undefined widgetID");return}if(w===undefined||w===null){Deal.log("Cannont processSelectDealsMetadataResponse for null/undefined metadataCacheEntry");return}var x=w.responseData;var u=w.callingParams;n.translationHelper.populateFromSelectDealsMetadata(v,x);i.hasMetadata[v]=true;i.trigger("metadata_change"+v);i.setOrdering(v,u.ordering);i.setFilter(v,u.filter);i.setCells(v,u.cells);i.trigger("startGetDealsConnectionWiring"+v);i.setPage(v,u.page)};i.on("process_selectdeals_metadata"+m,t);var r=s;var q={ordering:c,filter:d,cells:o,page:k};n.widgetMetadataCache[m]={responseData:r,callingParams:q};n.processWidgetMetadataCache(i)};var p=function(){var t=[];var q=Deal.getPaginationCellPositions(k,o,i.dealIDs[m].length,i.disablePagination[m]);i.listOfDeals[m]=[];for(var r=0;r<q.length;r++){var v=q[r];var s=i.dealIDs[m][v];var u=i.getDeal(s);if(u!==null){t.push(s);Deal.connectionManager.connectDealExpire(i,m,u);if(v<o*k&&v>=o*(k-1)){i.listOfDeals[m].push(u)}}}i.trigger("startGetDealStatusesAdhoc",t);i.off("startGetDealsConnectionWiring"+m);i.trigger("startCellChangeAndStatusConnectionWiring"+m,i.listOfDeals[m])};var l=i.getWidgetParams(m);if(f!==undefined&&f!==null){jQuery.extend(true,l,f)}if(this.selectDealsRequestArgs[m]===undefined){this.selectDealsRequestArgs[m]=l}var e=this.requestArgsExist(l);if(!e){this.selectDealsRequestArgs[m]=l;this.uniqueSelectDealsRequestArgs.push(l)}if(this.firstGetDeals[m]===false&&!e){this.firstGetDeals[m]=true}if(this.firstGetDeals[m]===true){this.firstGetDeals[m]=false;if(e&&this.onGoingSelectDealsRequestForArgs(l)&&this.onGoingSelectDealsRequest[m]===undefined){this.onGoingSelectDealsRequest[m]=true;var a=function(q){delete n.onGoingSelectDealsRequest[m];i.trigger("selectdeals_change"+m,q)};var j=this.currentWidgetIdForArgs(l);if(j!==undefined||j!==null){i.on("selectdeals_change"+m,h);i.on("startGetDealsConnectionWiring"+m,p);i.on("selectdeals_change"+j,a)}}else{i.on("selectdeals_change"+m,h);i.on("startGetDealsConnectionWiring"+m,p);this.onGoingSelectDealsRequest[m]=true;this.recordArgs(m,l);this.select_deals(m,o,l,i)}}else{if(i.metadata.checkIfStatusFilterSeen(m,g)&&this.onGoingSelectDealsRequest[m]===undefined){i.on("startGetDealsConnectionWiring"+m,p);i.trigger("startGetDealsConnectionWiring"+m)}}},select_deals:function(i,l,a,e){var m=this;var k=a;var d=l;if(!e.disablePagination[i]){d*=2}var j=false;var c=null;var g=null;var b=e.getPrefetchedDeals(i);if(b!==null&&b!==undefined){m.parse_select_deals_response(b,e);if(b.dealDetails&&b.sortedDealIDs&&b.sortedDealIDs.length>0){var f=b.sortedDealIDs[0];deal=e.getDeal(b.sortedDealIDs[0]);if(b.dealDetails[f]&&b.dealDetails[f].type===Deal.dealTypes.DOTD){deal.swfContents=jQuery("#swfPrefetch_"+f).html()}if(b.dealDetails[f]&&b.dealDetails[f].type===Deal.dealTypes.DOTD&&b.dealDetails[f].itemType===Deal.itemTypes.SingleItem){deal.fastTrackMessage=jQuery("#ftPrefetch_"+f).html()}}b.selectDealsPageSize=d;e.trigger("selectdeals_change"+i,b);return}if(e.isWidgetAssociatedToWidgetGroup(i)){c=e.getWidgetGroupId(i);g=Deal.widgetGroupManager.getWidgetGroup(c);if(g.isWidgetGroupReady()){j=true;k=g.getWidgetGroupParams();d=g.getWidgetGroupTotalPageSize()}else{return}}var h={apiName:Deal.apiName.GET_DEAL_METADATA,clientId:m.client_id};m.call("/xa/dealcontent/v2/GetDealMetadata",m.get_select_deals_request_data(d,k,e,i),function(v){m.parse_select_deals_response(v,e);var p=Deal.controller.getLoadSwfWidget(i);if(p&&v.dealDetails&&v.sortedDealIDs&&v.sortedDealIDs.length>0){var u=v.sortedDealIDs[0];if(v.dealDetails[u]&&v.dealDetails[u].type===Deal.dealTypes.DOTD){deal=e.getDeal(v.sortedDealIDs[0]);var o="/gp/deal/ajax/getSWFData.html?dealID="+deal.dealID;var r={url:o,type:"POST",data:JSON.stringify({}),dataType:"json",success:function(w){deal.swfContents=w.swf;var x="#share_bar-sdl_"+u;var y=jQuery(x)[0];if(y){var z='<span class="bylinepipe">|</span><span id="gbShareFeature" class="gbsharefeature"></span>';jQuery(x).html(z);jQuery(x).find("#gbShareFeature").html(deal.swfContents)}}};jQuery.ajax(r)}}var q=Deal.controller.getEnableFastTrackMessage(i);if(q&&gbResources.getFeature("fasttrack-message")&&v.dealDetails&&v.dealDetails.itemType===Deal.itemTypes.singleItem&&v.sortedDealIDs&&v.sortedDealIDs.length>0){var u=v.sortedDealIDs[0];var n="#fastTrack_"+u;var s=jQuery(n)[0];if(s){var t='<span id="fastTrackMessage" class="fastTrackMessage"></span>';jQuery(n).html(t);jQuery(n).find("#fastTrackMessage").html(deal.fastTrackMessage)}}if(j){g.trigger("process_group_metadata",v)}else{v.selectDealsPageSize=d;e.trigger("selectdeals_change"+i,v)}},function(q){var n=[i];if(j){n=_.union(n,g.getWidgetIds())}for(var p=0;p<n.length;p++){var o=n[p];e.trigger("showLoading"+o)}},null,h)},parse_select_deals_response:function(a,b){var d=this;var f;if(a.dealDetails&&a.sortedDealIDs&&a.sortedDealIDs.length>0){for(var c=0;c<a.sortedDealIDs.length;c++){var e=a.sortedDealIDs[c];if(e in a.dealDetails){f=b.getDeal(e);d.translationHelper.populateFromGetDeals(f,a.dealDetails[e]);d.dealsWithDetails[e]=true}else{break}}}d.translationHelper.populateFromGetDealStatuses(a.dealStatus,b)},get_select_deals_request_data:function(d,h,b,e){var c=this;if(h===undefined||h===null){h={}}var g={};g.requestMetadata={};g.requestMetadata.marketplaceID=c.marketplace_id;if(c.customer_id!==null&&c.customer_id!==""){g.requestMetadata.customerID=c.customer_id}g.requestMetadata.sessionID=c.session_id;g.requestMetadata.clientID=c.client_id;var f=b.contentMetadata;g.widgetContext={};if(!_.isEmpty(f)){if(f.pageType){g.widgetContext.pageType=f.pageType}if(f.subPageType){g.widgetContext.subPageType=f.subPageType}if(f.deviceType){g.widgetContext.deviceType=f.deviceType}if(f.originRef){g.widgetContext.refTag=f.originRef}if(f.originRID){g.widgetContext.refRID=f.originRID}if(f.browseNode){g.widgetContext.pageTypeID=f.browseNode}}var a=b.getAmabotParams(e);if(!_.isEmpty(a)){if(a.placementID){g.widgetContext.widgetID=a.placementID}if(a.slotName){g.widgetContext.slotName=a.slotName}}g.page=c.page;g.dealsPerPage=(d?d:1);g.itemResponseSize="NONE";g.queryProfile={};if(h.featuredOnly!==undefined&&h.featuredOnly!==null){g.queryProfile.featuredOnly=h.featuredOnly}if(_.isArray(h.dealStates)&&h.dealStates.length>0){g.queryProfile.dealStates=h.dealStates}if(_.isArray(h.dealTypes)&&h.dealTypes.length>0){g.queryProfile.dealTypes=h.dealTypes}if(_.isNumber(h.expiringWithin)&&!isNaN(h.expiringWithin)&&h.expiringWithin>0){g.queryProfile.expiringWithin=h.expiringWithin}if(_.isArray(h.includedCategories)&&h.includedCategories.length>0){g.queryProfile.includedCategories=h.includedCategories}if(_.isArray(h.excludedCategories)&&h.excludedCategories.length>0){g.queryProfile.excludedCategories=h.excludedCategories}if(!_.isEmpty(h.inclusiveTargetValues)){g.queryProfile.inclusiveTargetValues=[];_.each(h.inclusiveTargetValues,function(j,i){_.each(j,function(k){g.queryProfile.inclusiveTargetValues.push({name:i,value:k})})})}if(!_.isEmpty(h.extendedFilters)){g.queryProfile.extendedFilters=h.extendedFilters}if(!_.isEmpty(h.excludedExtendedFilters)){g.queryProfile.excludedExtendedFilters=h.excludedExtendedFilters}if(_.isArray(h.includedDealIDs)&&h.includedDealIDs.length>0){g.queryProfile.includedDealIDs=h.includedDealIDs}if(_.isArray(h.excludedDealIDs)&&h.excludedDealIDs.length>0){g.queryProfile.excludedDealIDs=h.excludedDealIDs}if(_.isArray(h.includedMerchantIDs)&&h.includedMerchantIDs.length>0){g.queryProfile.merchantIDs=h.includedMerchantIDs}if(!_.isEmpty(h.dealGroups)){g.queryProfile.dealGroups=h.dealGroups}if(h.fromTime){g.queryProfile.fromTime=h.fromTime}if(h.toTime){g.queryProfile.toTime=h.toTime}if(_.contains(_.values(Deal.rankingStrategies),b.rankingStrategy[e])){g.sortOrder=b.rankingStrategy[e]}return g},redeem_deal:function(g,h,n,l,d,c,i){var o=this;d=d||"";if(i){var f=i.dealType;if(f===Deal.dealTypes.BD||f===Deal.dealTypes.DOTD){var b=Deal.getOfferListingID(i,h);var a="/gp/goldbox/purchase/ref="+d+"?offeringID="+b+"&asin="+h;var k=null;var e=null;var j=null;if(Deal.areNestedKeysPresent(i,"pricingData.dealPriceHash.max.currency")){k=i.pricingData.dealPriceHash.max.currency}if(Deal.areNestedKeysPresent(i,"auxiliaryData.merchantDetails.merchantID")){e=i.auxiliaryData.merchantDetails.merchantID}if(Deal.areNestedKeysPresent(i,"pricingData.dealPriceHash.max.price")){j=Deal.getCrypticPrice(i.pricingData.dealPriceHash.max.price)}if(e){a+="&mt"+e}if(k){a+="&cu="+k}if(j){a+="&pr="+j}if(c){a=Deal.addAmabotRecordClickParameters(a,c)}window.location=a}else{if(f===Deal.dealTypes.LD&&i.legacyDealID){var m={apiName:Deal.apiName.REDEEM_DEAL,clientId:o.client_id};o.call("/gp/deal/ajax/redeemDeal.html/ref="+d+"?marketplaceID="+o.marketplace_id+"&dealID="+i.legacyDealID+"&asin="+h+"&sessionID="+o.session_id,{},n,l,o.base_retry_interval/4,m)}}}},get_deal_statuses:function(a,b){var c=this;var e=c.get_getDealStatuses_request_data(a);var d={apiName:Deal.apiName.GET_DEAL_STATUS,clientId:c.client_id};c.call("/xa/dealcontent/v2/GetDealStatus",e,function(f){var g={};var l;var k;var j;for(l in f.dealStatus){k=f.dealStatus[l];a[l][0](k);g[l]=true}var h=c._deal_ids_to_item_ids_from_callbacks(a);for(j=0;j<h.length;j++){l=h[j].dealID;if(!g[l]){a[l][1](new Error("No status returned for dealID "+l))}}c.translationHelper.populateFromGetDealStatuses(f.dealStatus,b)},function(f){var h;var j;var g=c._deal_ids_to_item_ids_from_callbacks(a);for(h=0;h<g.length;h++){j=g[h].dealID;deal_ids_to_callbacks[j][1](f)}},null,d)},get_Deals:function(a,b,d){var c=this;var f=c.getDeals_request_Data(a,d);var e={apiName:Deal.apiName.GET_DEALS,clientId:c.client_id};c.call("/xa/dealcontent/v2/GetDeals",f,function(g){for(var h in g.dealDetails){deal=b.getDeal(h);c.translationHelper.populateFromGetDeals(deal,g.dealDetails[h])}c.translationHelper.populateFromGetDealStatuses(g.dealStatus,b)},function(h){for(var g=0;g<a.length;g++){var i=a[g];c.dealsWithDetails[i]=false}},null,e)},get_getDealStatuses_request_data:function(a){var d=this;var e=null;var b=null;var c=null;e=d._deal_ids_to_item_ids_from_callbacks(a);c="STATUS_ONLY";b={requestMetadata:{marketplaceID:d.marketplace_id,clientID:d.client_id,sessionID:d.session_id},dealTargets:e,responseSize:c,itemResponseSize:"NONE"};if(d.customer_id!==null&&d.customer_id!==""){b.requestMetadata.customerID=d.customer_id}return b},getDeals_request_Data:function(a,g){var e=this;var h=null;var b=null;var d=null;var f=a.sort();h=[];for(var c=0;c<f.length;c++){h.push({dealID:f[c]})}d="ALL";b={requestMetadata:{marketplaceID:e.marketplace_id,clientID:e.client_id,sessionID:e.session_id},dealTargets:h,responseSize:d,itemResponseSize:"NONE"};if(!g&&e.customer_id!==null&&e.customer_id!==""){b.requestMetadata.customerID=e.customer_id}return b},requestArgsExist:function(a){if(a===undefined||a===null){Deal.log("Cannot check if request args exist for undefined/null args.");return false}if(this.uniqueSelectDealsRequestArgs.length===0){return false}var c;for(var b=0;b<this.uniqueSelectDealsRequestArgs.length;b++){c=this.uniqueSelectDealsRequestArgs[b];if(Deal.objectsIdentical(c,a)){return true}}return false},onGoingSelectDealsRequestForArgs:function(a){if(a===undefined||a===null){Deal.log("Cannot check if onGoingSelectDealsRequestForArgs exist for undefined/null args.");return false}var b=this.currentWidgetIdForArgs(a);if(this.onGoingSelectDealsRequest[b]){return true}return false},currentWidgetIdForArgs:function(a){if(a===undefined||a===null){Deal.log("Cannot check if request args exist for undefined/null args.");return null}for(var c in this.widgetIdToArgs){for(var b=0;b<this.widgetIdToArgs[c].length;b++){if(Deal.objectsIdentical(a,this.widgetIdToArgs[c][b])){return c}}}return null},recordArgs:function(b,a){if(b===undefined||b===null){Deal.log("Cannot recordArgs for undefined/null widgetID.");return}if(a===undefined||a===null){Deal.log("Cannot recordArgs for undefined/null args.");return}if(this.widgetIdToArgs[b]===undefined){this.widgetIdToArgs[b]=[]}this.widgetIdToArgs[b].push(a)},_deal_ids_to_item_ids_from_callbacks:function(d){var c=_.keys(d).sort();var a=[];for(var b=0;b<c.length;b++){a.push({dealID:c[b],itemIDs:null})}return a},get_deal_status:function(d,e,c,a){var b=this;return b._add_request("get_deal_status",d,e,c,a)},next_id:100,_pending:{select_deals:{current:false,timeout:undefined,deal_ids:{}},get_deal_status:{current:false,timeout:undefined,deal_ids:{}}},_add_request:function(h,c,j,i,f){var k=this;var b=k._pending[h];if(b.deal_ids[c]===undefined){b.deal_ids[c]={}}var g=b.deal_ids[c];var a=k.next_id++;var e={cancel:function(){delete g[a];this.cancel=function(){throw new Error("already cancelled")}},success:j,error:i};g[a]=e;k._start_request_timer(h,f);return e},_start_request_timer:function(c,a){var b=this;var d=b._pending[c];if(!d.current){if(d.timeout){window.clearTimeout(d.timeout)}d.timeout=window.setTimeout(function(){d.timeout=undefined;b._start_request(c,a)},2000)}},_start_request:function(h,f){var i=this;var c=i._pending[h];if(c.timeout){window.clearTimeout(c.timeout);c.timeout=undefined}if(c.current){return}var g=[];var d={};for(var e in c.deal_ids){if(g.length>=10){break}var a=false;for(var b in c.deal_ids[e]){a=true;break}if(!a){delete c.deal_ids[e];break}if(c.deal_ids[e].current){continue}c.deal_ids[e].current=true;g.push(e);(function(j){d[j]=[function(k){i._request_success(h,j,k,f)},function(k){i._request_error(h,j,k,f)}]})(e)}if(g.length===0){return}if(h=="get_deal_status"){i.get_deal_statuses(d,f)}else{if(h=="select_deals"){}}},_request_success:function(e,c,g,a){var b=this;var f=b._pending[e];f.current=false;var h=f.deal_ids[c];if(h!==undefined){delete f.deal_ids[c];delete h.current;for(var i in h){h[i].success(g)}}b._start_request_timer(e,a)},_request_error:function(f,e,c,a){var b=this;var g=b._pending[f];g.current=false;var h=g.deal_ids[e];if(h!==undefined){delete g.deal_ids[e];delete h.current;for(var i in h){h[i].error(c)}}b._start_request_timer(f,a)},get_deal_asin_status2:function(){return{cancel:function(){}}},get_deal:function(){return{cancel:function(){}}}});
var DealRedemptionService=DealsInterface.extend({baseRetryIntervalMs:20000,translationHelper:null,clientId:"goldbox",initialize:function(a){this.translationHelper=new DealContentServiceTranslationHelper()},claimDeal:function(b,g,d,f,a){var e="/gp/deal/ajax/claimDeal.html/ref="+d+"?dealId="+b+"&itemId="+g;var c={apiName:Deal.apiName.CLAIM_DEAL,clientId:this.clientId};this.call(e,{},f,a,this.baseRetryIntervalMs,c)},call:function(b,d,g,a,f,c){var e={success:function(h){if(h.baseRetryInterval){this.baseRetryIntervalMs=h.baseRetryInterval}g(h)},error:a,url:b,type:"POST",data:JSON.stringify(d),dataType:"json"};e.retryInterval=this.baseRetryInterval;this.ajax_with_retries(e,c)}});
var DealConfigManager=Backbone.Model.extend({initialize:function(a){if(!a){throw new Error("Cannot initialize configManager with empty params.")}if(a.dealServiceConfig){this.dealServiceConfig=a.dealServiceConfig}if(a.dealContentServiceConfig){this.dealContentServiceConfig=a.dealContentServiceConfig}if(a.controllerConfig){this.controllerConfig=a.controllerConfig}},getWidgetConfig:function(a){return this[a]},getControllerConfig:function(){return this.controllerConfig},getABTestingConfig:function(){return this.abTestingConfig},getDealServiceConfig:function(){return this.dealServiceConfig},getDealContentServiceConfig:function(){return this.dealContentServiceConfig},getDealViewTemplate:function(c,a){var b="";if(!c||!a){Deal.log("No widget or template name specified.");return b}if(!Deal.configManager[c]||!Deal.configManager[c].dealViewConfig||!Deal.configManager[c].dealViewConfig.templates||!Deal.configManager[c].dealViewConfig.templates[a]){Deal.log("No entry exists for specified widgetName/templateName");return b}b=Deal.configManager[c].dealViewConfig.templates[a];return b},getWidgetViewTemplate:function(c,a){var b="";if(!c||!a){Deal.log("No widget or template name specified.");return b}if(!Deal.configManager[c]||!Deal.configManager[c].templates||!Deal.configManager[c].templates[a]){return b}b=Deal.configManager[c].templates[a];return b}});
var ConfigBootStrapper=Backbone.Model.extend({initialize:function(){},registerWidgetName:function(a){if(a&&!Deal.configManager[a]){Deal.configManager[a]={};return 1}return 0},registerWidgetDOMElement:function(b,a){if(!b||!a){Deal.log("Please provide a valid widgetName/Dom element.");return}if(Deal.configManager[b]){Deal.configManager[b].el=a}},registerABTestingConfig:function(b,a){if(!b||!a){return}if(Deal.configManager[b]){Deal.configManager[b].abTestingConfig=a}},registerMetricsConfig:function(b,a){if(!b||!a){return}if(Deal.configManager[b]){Deal.configManager[b].metricsConfig=a}},registerActionConfig:function(b,a){if(!b||!a){return}if(Deal.configManager[b]){Deal.configManager[b].actionConfig=a}},registerWidgetViewConfig:function(b,a){if(!b||!a){return}if(Deal.configManager[b]){Deal.configManager[b].widgetViewConfig=a}},registerDealViewConfig:function(b,a){if(!b||!a){return}if(Deal.configManager[b]){Deal.configManager[b].dealViewConfig=a}},registerFeatureScope:function(b,a){if(!b||!a){return}b.metricsConfig=b.metricsConfig||{};b.metricsConfig.CSM=b.metricsConfig.CSM||{};b.metricsConfig.CSM.featureScope=a},registerTemplates:function(c,a){if(!c||!a){return}var b=Deal.configManager[c];if(b){b.templates=this.getTemplates(a.widgetTemplates);if(b.dealViewConfig){b.dealViewConfig.templates=this.getTemplates(a.dealTemplates)}}},getTemplates:function(a){var b={};_.each(a,function(e,c){var d=Deal.Templates.convertNameToKey(e);b[c]=DealTemplates[d]});return b}});
var DealWatcher=Backbone.Collection.extend({activeDealsHash:{},callbackHash:{},asinImpressionsHash:{},hasRendered:{},hasImpressions:[],doesCallBackExist:function(b,a){if(b===undefined||b===null||a===undefined||a===null){Deal.log("DealWatcher.doesCallBackExist called with null/undefined dealID/signalName");return false}if(this.callbackHash[b]===undefined){return false}return _.contains(this.callbackHash[b],a)},addCallBack:function(b,a){if(b===undefined||b===null||a===undefined||a===null){Deal.log("DealWatcher.addCallBack called with null/undefined dealID/signalName");return}if(this.callbackHash[b]===undefined){this.callbackHash[b]=[]}if(!_.contains(this.callbackHash[b],a)){this.callbackHash[b].push(a)}},removeCallBack:function(b,a){if(b===undefined||b===null||a===undefined||a===null){Deal.log("DealWatcher.removeCallBack called with null/undefined dealID/signalName");return}if(this.callbackHash[b]===undefined){return}if(!_.contains(this.callbackHash[b],a)){return}this.callbackHash[b].splice(_.indexOf(this.callbackHash[b],a),1);if(this.callbackHash[b].length===0){delete this.callbackHash[b]}},isDealBeingWatched:function(b,a){if(b===undefined||b===null){Deal.log("DealWatcher.isDealBeingWatched called with null/undefined dealID");return false}if(this.activeDealsHash[b]===undefined){return false}if(a===undefined){return true}return _.contains(this.activeDealsHash[b].widgetIDs,a)},watchDeal:function(c,b){var a=c.dealID;if(a===undefined||a===null||b===undefined||b===null){Deal.log("DealWatcher.watchDeal called with null/undefined dealID/widgetID");return}if(this.activeDealsHash[a]===undefined){this.activeDealsHash[a]={deal:c,widgetIDs:[]}}if(!_.contains(this.activeDealsHash[a].widgetIDs,b)){this.activeDealsHash[a].widgetIDs.push(b)}},unwatchDeal:function(b,a){if(b===undefined||b===null||a===undefined||a===null){Deal.log("DealWatcher.unwatchDeal called with null/undefined dealID/widgetID");return}if(this.activeDealsHash[b]===undefined){return}if(!_.contains(this.activeDealsHash[b].widgetIDs,a)){return}this.activeDealsHash[b].widgetIDs.splice(_.indexOf(this.activeDealsHash[b].widgetIDs,a),1);if(this.activeDealsHash[b].widgetIDs.length===0){delete this.activeDealsHash[b]}},callClickStream:function(){var b=this;var a={};_.each(this.asinImpressionsHash,function(c,d){var f=Deal.getWidgetCDSRef(d);if(f!==null&&f!==undefined&&_.contains(b.hasImpressions,d)){var e=[];_.each(c,function(i,j){if(Deal.shouldRecordClickAction(j)){var k=Deal.controller.getDeal(j).impressionAsin;var h=[k,j,i.position];if(i.clicks!==undefined){var g=[];_.each(i.clicks,function(m,l){g.push(l,m)});h.push(g.join(""))}e.push(h.join("-"))}});if(e.length){a[f]=e.join()}}});this.splitCallClickStream(a)},splitCallClickStream:function(a){var k=JSON.stringify(a);var j=Deal.param_appender("/gp/deal/ajax/impressionTracker.html","sessionID="+gbResources.getCustomerData("sessionId"));var b=Deal.param_appender(j,"impressions="+k);var f=window.encodeURIComponent(b);if(f.length<=2000){jQuery.ajax({url:b,async:false})}else{var c=_.keys(a);if(!c.length){return}var g={};var d={};if(c.length===1){var e=a[c[0]].split(",");if(e.length<=1){return}var i=e.slice(0,Math.ceil(e.length/2));var h=e.slice(Math.ceil(e.length/2),e.length);g[c[0]]=i.join();d[c[0]]=h.join()}else{var m=c.slice(0,Math.ceil(c.length/2));var l=c.slice(Math.ceil(c.length/2),c.length);_.each(m,function(n){g[n]=a[n]});_.each(l,function(n){d[n]=a[n]})}this.splitCallClickStream(g);this.splitCallClickStream(d)}},recordPageChangeImpressions:function(b){if(b===undefined||b===null){Deal.log("DealWatcher.unwatchDeal called with null/undefined widgetID");return}var a=this;_.each(Deal.controller.listOfDeals[b],function(c){if(c.dealID){a.recordImpression(b,c.dealID)}})},recordImpression:function(b,a){if(b===undefined||b===null||a===undefined||a===null){Deal.log("DealWatcher.recordImpression called with undefined/null widgetID/dealID.");return null}if(this.asinImpressionsHash[b]===undefined){this.asinImpressionsHash[b]={}}if(this.asinImpressionsHash[b][a]===undefined){this.asinImpressionsHash[b][a]={position:_.indexOf(Deal.controller.dealIDs[b],a)+1}}},recordClickEvent:function(c,b,a){if(c===undefined||c===null||b===undefined||b===null||a===undefined||a===null){Deal.log("DealWatcher.recordClickEvent called with null/undefined widgetID/dealID/clickAction");return}if(!this.asinImpressionsHash[c]||!this.asinImpressionsHash[c][b]){return}if(this.asinImpressionsHash[c][b].clicks===undefined){this.asinImpressionsHash[c][b].clicks={}}if(this.asinImpressionsHash[c][b].clicks[a]===undefined){this.asinImpressionsHash[c][b].clicks[a]=0}this.asinImpressionsHash[c][b].clicks[a]++},sendClientSideLatencyMetrics:function(b,a){if(b===undefined||b===null||a===undefined||a===null){Deal.log("DealWatcher.sendClientSideLatencyMetrics called with null/undefined widgetID/featureScope");return}if(this.hasRendered[b]!==undefined&&this.hasRendered[b]!==null){return}this.hasRendered[b]=true;if(typeof uet=="function"){uet("cf",a,{wb:1})}if(typeof uex=="function"){uex("ld",a,{wb:1})}if(window.gbCSM){gbCSM.sendV3PageLevelMetrics(a)}},changeViewPort:function(){var a=this;var c=jQuery(window).scrollTop();var b=c+jQuery(window).height();_.each(Deal.Widgets,function(f){var d=f.widgetID.toString();var e=f.isInViewPort(c,b);if(e&&!_.contains(a.hasImpressions,d)){a.hasImpressions.push(d)}})}});
var DealBusinessRulesManager=Backbone.Collection.extend({applyBusinessRulesToView:function(a,c){if(a===undefined||a===null){Deal.log("Cannot applyBusinessRulesToView on an undefined/null view.");return}if(c===undefined||c===null){Deal.log("Cannot run business rules for LD on an undefined/null deal.");return}if(a.data===undefined||a.data===null){a.data={}}var b=Deal.stateBasedSubTemplates[c.dealState];a.generateArrayOfTemplates(b);a.renderTemplate(a.config.templates[c.dealState])},runBusinessRules:function(a,c){if(a===undefined||a===null){Deal.log("Cannot run business rules on an undefined/null view.");return}if(c===undefined||c===null){Deal.log("Cannot run business rules for LD on an undefined/null deal.");return}var b=this.runCommonBusinessRules(a,c);if(b){return}a.data.dealType=c.dealType;a.data.itemType=c.itemType;if(c.dealType===Deal.dealTypes.LD){this.runLDBusinessRules(a,c)}else{this.runNonLDBusinessRules(a,c)}},runCommonBusinessRules:function(c,f){if(c===undefined||c===null){Deal.log("Cannot run business rules on an undefined/null view.");return true}if(f===undefined||f===null){Deal.log("Cannot run business rules for LD on an undefined/null deal.");return true}if(c.data===undefined||c.data===null){c.data={}}c.data.deal=f;c.data.dealID=f.dealID;c.data.dealState=f.dealState;c.data.DealStateEnum=Deal.dealStateEnum;c.data.stateToTemplateMap=Deal.stateToTemplateMap;var b=Deal.availableStr;c.data.stateDisplayData=Deal.viewComponentBuilder.getStateDisplayData(f,c);Deal.viewComponentBuilder.setDealDetails(f,c.data);Deal.viewComponentBuilder.setDealStatusData(f,c);Deal.viewComponentBuilder.setPricingData(f,c);Deal.viewComponentBuilder.setAuxiliaryData(f,c.data);var d=Deal.findBackBoneDealAsin(f);if(!d){if(f.dealState===Deal.stateToTemplateMap.Upcoming){var e=Deal.stateBasedSubTemplates[f.dealState];c.generateArrayOfTemplates(e);c.el.removeClass("spinner");c.renderTemplate(c.config.templates[f.dealState]);return true}else{if(f.dealState===Deal.stateToTemplateMap.Loading){Deal.log("Waiting on GetDealAsinStatus to return.");var a=Deal.Templates.generateTemplate(c.config.templates.deal_loading,{});c.el.html(a);c.el.addClass("spinner");return true}}}c.el.removeClass("spinner");if(d!==undefined&&d!==null){c.ASIN=d.ASIN}else{if(f.buyAsin&&f.itemType==Deal.itemTypes.SingleItem){c.ASIN=f.buyAsin}}c.deal=f;Deal.viewComponentBuilder.setPurchaseStateData(f,c);Deal.viewComponentBuilder.setDealDisplayDetails(f,c);c.isVariationView=f.dealType===Deal.dealTypes.LD&&f.itemType===Deal.itemTypes.MultiItem&&c.data.purchaseState!==Deal.dealStateEnum.LearnMore&&c.data.purchaseState!==Deal.dealStateEnum.ViewDeal;c.data.checkingDealStatus=f.checkingDealStatus;Deal.log("DealState: "+f.dealState+" for dealID"+f.dealID);return false},runLDBusinessRules:function(a,d){if(a===undefined||a===null){Deal.log("Cannot run business rules on an undefined/null view.");return}if(d===undefined||d===null){Deal.log("Cannot run business rules for LD on an undefined/null deal.");return}if(a.data===undefined||a.data===null){a.data={}}this.applyBusinessRulesToView(a,d);if(a.isVariationView){var b=jQuery("#"+a.elementID).find(".btn");var c=new Deal.LegacyVariationPopover(b,d,a.widgetID)}else{if(Deal.controller.buying[a.deal.dealID]){var e=Deal.Templates.generateTemplate(a.config.templates.checking_deal_status,{});a.el.find("#dealActionContent").html(e)}}},runNonLDBusinessRules:function(a,b){if(a===undefined||a===null){Deal.log("Cannot run business rules on an undefined/null view.");return}if(b===undefined||b===null){Deal.log("Cannot run business rules for LD on an undefined/null deal.");return}if(a.data===undefined||a.data===null){a.data={}}a.data.stateDisplayData.hasActionableStatus=false;if(b.dealState===Deal.stateToTemplateMap.Available){a.data.purchaseState=Deal.dealStateEnum.Available;if(b.dealType==Deal.dealTypes.LOCAL){a.data.purchaseState=Deal.dealStateEnum.ViewDeal;a.purchaseState=Deal.dealStateEnum.ViewDeal}else{if(b.dealType==Deal.dealTypes.COUPON){a.data.purchaseState=Deal.dealStateEnum.ClipCoupon;a.purchaseState=Deal.dealStateEnum.ClipCoupon}else{if(b.itemType!=Deal.itemTypes.SingleItem){a.data.purchaseState=Deal.dealStateEnum.ViewDeal;a.purchaseState=Deal.dealStateEnum.ViewDeal}else{if((b.buyAsin===null||b.buyAsin===undefined)&&(b.dealType===Deal.dealTypes.DOTD||b.dealType===Deal.dealTypes.BD)&&(b.dealState===Deal.stateToTemplateMap[Deal.dealStates.AVAILABLE])){a.data.purchaseState=Deal.dealStateEnum.ViewDeal;a.purchaseState=Deal.dealStateEnum.ViewDeal}else{a.purchaseType=Deal.purchaseTypes.ADD_TO_CART}}}}if(b.itemType===Deal.itemTypes.SingleItem&&(b.dealType===Deal.dealTypes.DOTD||b.dealType===Deal.dealTypes.BD)&&Deal.controller.metadata.isDigitalDeal[b.dealID]){a.data.purchaseState=Deal.dealStateEnum.ViewDeal;a.purchaseState=Deal.dealStateEnum.ViewDeal}}else{a.data.purchaseState=Deal.dealStateEnum.InvalidPurchaseState}this.applyBusinessRulesToView(a,b)}});if(window.Deal===undefined){window.Deal={}}if(Deal.businessRulesManager===undefined){Deal.businessRulesManager=new DealBusinessRulesManager()};
var DealViewComponentBuilder=Backbone.Collection.extend({initialize:function(){},getStateDisplayData:function(d,a){if(a===undefined||a===null||d===undefined||d===null){Deal.log("Cannot getStateDisplayData for undefined/null deal/view obj.");return{}}var c=new Deal.PurchaseStatusGatherer(d);var b=c.getStateDisplayData();if(b[Deal.inCartStr]!==undefined&&b[Deal.inCartStr]!==null&&b[Deal.inCartStr][0]!==undefined&&b[Deal.inCartStr][0]!==null&&b[Deal.inCartStr][0].expiresDate!==null){b[Deal.inCartStr].timerObject=Deal.HeroTimer(b[Deal.inCartStr][0].expiresDate,a.config.timerCssClassName,true,false);a.timers.push(b[Deal.inCartStr].timerObject)}if(b[Deal.pendingAtcStr]!==undefined&&b[Deal.pendingAtcStr]!==null&&b[Deal.pendingAtcStr][0]!==undefined&&b[Deal.pendingAtcStr][0]!==null&&b[Deal.pendingAtcStr][0].expiresDate!==null){b[Deal.pendingAtcStr].timerObject=Deal.HeroTimer(b[Deal.pendingAtcStr][0].expiresDate,a.config.timerCssClassName,true,false);a.timers.push(b[Deal.pendingAtcStr].timerObject)}return b},setDealStatusData:function(c,a){if(!c||!c.status||!a||!a.data){Deal.log("Cannot setDealStatusData for undefined/null deal/deal.status/view/view.data object");return}var b=a.data;b.isPrimeEarlyAccessDeal=false;b.isPrimeOnlyDeal=false;b.isPrimeOnlyDotd=false;if(Deal.isPrimeEarlyAccessDeal(c)){b.isPrimeEarlyAccessDeal=true;b.primeAccessDurationInMs=c.detail.primeAccessDurationInMs}else{if(Deal.isPrimeOnlyDeal(c)){b.isPrimeOnlyDeal=true;if(Deal.isPrimeOnlyDotd(c)){b.isPrimeOnlyDotd=true}}}if(c.status.msToStart){b.msFromPost=-parseInt(c.status.msToStart,10)}if(c.dealState===Deal.stateToTemplateMap.Upcoming){Deal.log("DealView: Upcoming Deal: "+c.dealID);this._setUpcomingDealDetails(c,a)}else{if(c.dealState===Deal.stateToTemplateMap.Expired){Deal.log("DealView: Expired Deal: "+c.dealID)}else{if(c.dealState===Deal.stateToTemplateMap.SoldOut){Deal.log("DealView: SoldOut Deal: "+c.dealID);b.purchaseState=-1}}}if(c.status.percentClaimed!==undefined&&c.status.percentClaimed!==null){b.percentClaimed=Math.round(c.status.percentClaimed)}else{b.percentClaimed=0}if(c.status.percentSoldOut!==undefined&&c.status.percentSoldOut!==null){b.percentSoldOut=Math.round(c.status.percentSoldOut)}if(c.status.totalCouponsCount!==undefined&&c.status.totalCouponsCount!==null){b.totalCouponsCount=c.status.totalCouponsCount}this._setDealViewTimerData(a,c)},setPricingData:function(c,a){if(!c||!a||!a.data){Deal.log("Cannot setPricingData for undefined/null deal/view/view.data object");return}var b=a.data;b.hidePercentOff=Deal.controller.hidePercentOff[a.widgetID];if(Deal.Price.hasPriceData(c.pricingData.dealPriceHash)){b.dealPrice=c.pricingData.dealPriceHash;if(b.dealPrice.isRange===false&&c.percentOff.isRange===false){b.discountPercentage=Deal.Price.displayable_percent_off(c.percentOff.max)}if(Deal.Price.hasPriceData(c.pricingData.basisPriceHash)){if(c.pricingData.basisPriceHash.min.price!==0){b.originalPrice=c.pricingData.basisPriceHash;if(c.pricingData.basisPriceHash.isRange===false&&c.pricingData.dealPriceHash.isRange===false&&!b.discountPercentage&&c.pricingData.dealPriceHash.min.price<c.pricingData.basisPriceHash.min.price){b.discountPercentage=Deal.Price.percent_off(c.pricingData.basisPriceHash.min,c.pricingData.dealPriceHash.min)}}}}},setPurchaseStateData:function(d,b){if(d===undefined||d===null){Deal.log("Cannot setPurchaseStateData for undefined/null deal obj.");return}if(b===undefined||b===null){Deal.log("Cannot setPurchaseStateData on undefined/null view.");return}var c=Deal.findBackBoneDealAsin(d);if(c===undefined||c===null){Deal.log("Cannot setPurchaseData on undefined/null dealAsin.");return}if(d.itemType==Deal.itemTypes.MultiItem){if(!(d.dealState===Deal.stateToTemplateMap.SoldOut||d.dealState===Deal.stateToTemplateMap.Expired)){b.data.purchaseState=Deal.dealStateEnum.Variation}if((Deal.isDealInEarlyAccessWindow(d)||Deal.isPrimeOnlyDeal(d))&&!gbResources.customerData.hasEarlyAccessBenefit){b.data.purchaseState=Deal.dealStateEnum.LearnMore;b.purchaseState=Deal.dealStateEnum.LearnMore}return}if(d.lastPstatusExpireState!==undefined&&d.lastPstatusExpireState!==null&&d.lastPstatusExpireState===c.status.state){Deal.log("Returning as the data has not changed ever sincePstatus Expire was triggered");d.checkingDealStatus=true;if(!d.checkingDealStatusTimeout){window.setTimeout(function(){d.lastPstatusExpireState="";delete d.checkingDealStatusTimeout},40000)}}else{d.lastPstatusExpireState="";d.checkingDealStatus=false}if(c.status&&c.status.percentClaimed!==null&&c.status.state!==null){if(d.dealState===Deal.stateToTemplateMap.Available){if(c.status.percentClaimed>=100&&c.status.currentlyUnavailable){b.data.purchaseState=Deal.dealStateEnum.WaitListFull;b.purchaseState=Deal.dealStateEnum.WaitListFull}else{if(c.status.percentClaimed>=100){b.data.purchaseState=Deal.dealStateEnum.WaitListOnly;b.purchaseType=Deal.purchaseTypes.JOIN_WAITLIST}else{if(c.status.state===Deal.availableStr||c.status.state===Deal.expiredStr){b.data.purchaseState=Deal.dealStateEnum.Available;b.purchaseType=Deal.purchaseTypes.ADD_TO_CART}}}if(c.status.state===Deal.waitInLineStr){b.data.purchaseState=Deal.dealStateEnum.WaitListed}else{if(c.status.state===Deal.inCartStr){b.data.purchaseState=Deal.dealStateEnum.InCart}else{if(c.status.state===Deal.pendingAtcStr){b.data.purchaseState=Deal.dealStateEnum.PendingAddToCart;b.purchaseState=Deal.dealStateEnum.PendingAddToCart}}}if(d.itemType===Deal.itemTypes.SingleItem&&Deal.controller.metadata.isDigitalDeal[d.dealID]){b.data.purchaseState=Deal.dealStateEnum.ViewDeal;b.purchaseState=Deal.dealStateEnum.ViewDeal}if((Deal.isDealInEarlyAccessWindow(d)||Deal.isPrimeOnlyDeal(d))&&!gbResources.customerData.hasEarlyAccessBenefit){b.data.purchaseState=Deal.dealStateEnum.LearnMore;b.purchaseState=Deal.dealStateEnum.LearnMore}}if(d.dealState===Deal.stateToTemplateMap.Expired){if(c.status.state===Deal.pendingAtcStr){b.data.purchaseState=Deal.dealStateEnum.PendingAddToCart;b.purchaseState=Deal.dealStateEnum.PendingAddToCart}else{b.purchaseState=-1}}if(c.status.state===Deal.claimedStr){b.data.purchaseState=Deal.dealStateEnum.Claimed;b.purchaseState=Deal.dealStateEnum.Claimed}}var e="";var a=null;if(b.data.purchaseState===undefined||b.data.purchaseState===null){if(c.status!==undefined&&c.status!==null){if(c.status.customerState!==undefined&&c.status.customerState!==null){a=c.status.customerState}if(c.status.itemState!==undefined&&c.status.itemState!==null){e=c.status.itemState}}}else{return}b.data.purchaseState=Deal.itemStateToPurchaseStateMap[e];if(a!==null&&a!==Deal.availableStr.toUpperCase()){b.data.purchaseState=Deal.customerStateToPurchaseStateMap[a]}if(b.data.purchaseState===undefined){b.data.purchaseState=Deal.dealStateEnum.InvalidPurchaseState}b.purchaseState=b.data.purchaseState;if(b.purchaseState==Deal.dealStateEnum.WaitListOnly){b.purchaseType=Deal.purchaseTypes.JOIN_WAITLIST}else{if(b.purchaseState==Deal.dealStateEnum.Available){b.purchaseType=Deal.purchaseTypes.ADD_TO_CART}}},setAuxiliaryData:function(b,a){if(b===undefined||b===null){Deal.log("Cannot setAuxiliaryData for undefined/null deal obj.");return}if(a===undefined||a===null){Deal.log("Cannot setAuxiliaryData on undefined/null dataObj.");return}if(b.auxiliaryData===undefined||b.auxiliaryData===null){Deal.log("Cannot setAuxiliaryData for undefined/null deal auxiliaryData.");return}a.isPrimeEligible=gbResources.getCustomerData("isPrimeMarketplace")&&b.auxiliaryData.isPrimeEligible;a.breaksMAP=b.auxiliaryData.breaksMAP;if(b.auxiliaryData.merchantDetails){a.merchantID=b.auxiliaryData.merchantDetails.merchantID;a.merchantName=b.auxiliaryData.merchantDetails.merchantName}if(b.auxiliaryData.reviewData){a.reviews={};a.reviews.stars=Deal.getReviewStars(b.auxiliaryData.reviewData.averageRating);a.reviews.count=b.auxiliaryData.reviewData.totalReviews;a.reviews.reviewsURL=b.auxiliaryData.reviewData.reviewsURL}},getDealState:function(a){},_setUpcomingDealDetails:function(c,a){var b=a.data;if(c.teaser){b.teaserImage=c.teaser.teaserImage;b.teaserLine=c.teaser.teaserLine;b.teaserURL=c.teaser.teaserURL}b.isPrimeEarlyAccessDeal=false;b.isPrimeOnlyDeal=false;if(Deal.isPrimeEarlyAccessDeal(c)){b.isPrimeEarlyAccessDeal=true;b.primeAccessDurationInMs=c.detail.primeAccessDurationInMs}else{if(Deal.isPrimeOnlyDeal(c)){b.isPrimeOnlyDeal=true}}},setDealDetails:function(b,a){if(!b){Deal.log("Cannot setDealDetails for undefined/null deal object");return{}}if(!a){a={}}if(b.detail){a.dealTitle=b.detail.title;a.dealDescription=b.detail.description;a.imageURL=b.detail.imageAsin;a.detailPageLink=Deal.generateDetailPageUrl(b);a.marketingMessage=b.detail.marketingMessage;a.geoDisplayName=b.detail.geoDisplayName;a.isPrimeEarlyAccessDeal=false;a.isPrimeOnlyDeal=false;a.isPrimeOnlyDotd=false;if(Deal.isPrimeEarlyAccessDeal(b)){a.isPrimeEarlyAccessDeal=true;a.primeAccessDurationInMs=b.detail.primeAccessDurationInMs}else{if(Deal.isPrimeOnlyDeal(b)){a.isPrimeOnlyDeal=true;if(Deal.isPrimeOnlyDotd(b)){a.isPrimeOnlyDotd=true}}}}a.swfContents=b.swfContents;a.fastTrackMessage=b.fastTrackMessage;a.legacyDealID=b.legacyDealID;a.discussionBoardURL=b.discussionBoardURL;return a},_setDealViewTimerData:function(g,c){var a=g.data;var d=Deal.controller.showLocalTime[g.widgetID];var f=gbResources.customerData.hasEarlyAccessBenefit;a.timerSpanID=a.dealID+"_time_remaining";a.timeOrDateString="";a.timerPrecedingString="";a.alertTxt="";var e=Deal.isPrimeOnlyDeal(c);if(c.dealState===Deal.stateToTemplateMap.Available){if(!f&&Deal.isDealInEarlyAccessWindow(c)){var b=new Date(c.status.startDate.getTime()+a.primeAccessDurationInMs);a.showEarlyAccessTimer=true;a.timeRemainingTimer=Deal.HeroTimer(b,g.config.timerCssClassName,false,true);a.timeRemainingTimer.viewElement=a.viewElement;a.timeRemainingTimer.spanID=a.timerSpanID;g.timers.push(a.timeRemainingTimer);a.timerPrecedingString=gbResources.getString("gb_starts_for_you_in");a.timeOrDateString=a.timeRemainingTimer.timeString;a.alertTxt="green"}else{if(c.status.msToEnd>24*60*60*1000){a.timerPrecedingString=gbResources.getString("gb_ends");a.timeOrDateString=Deal.formatDate(c.status.endDate)}else{if(c.status.msToEnd>1*60*60*1000&&c.dealType==Deal.dealTypes.BD){a.timerPrecedingString=gbResources.getString("gb_ends_at");a.timeOrDateString=Deal.formatDealTime(c.status.endDate,d)}else{a.timeRemainingTimer=Deal.HeroTimer(c.status.endDate,g.config.timerCssClassName,false,true);a.timeRemainingTimer.viewElement=a.viewElement;a.timeRemainingTimer.spanID=a.timerSpanID;g.timers.push(a.timeRemainingTimer);a.timerPrecedingString=gbResources.getString("gb_ends_in");a.timeOrDateString=a.timeRemainingTimer.timeString;if(c.status.msToEnd<=1*60*60*1000){a.alertTxt="green"}}}}}else{if(c.dealState===Deal.stateToTemplateMap.Upcoming){a.timerSpanID=c.dealID+"_starts_in_timer";var h=c.status.startDate;if(c.detail.primeAccessType===Deal.primeAccessTypeEnum.PRIME_EARLY_ACCESS){a.showEarlyAccessTimer=true;if(!f){h=new Date(h.getTime()+c.detail.primeAccessDurationInMs)}}var i=h.getTime()-new Date().getTime();if(i>1*60*60*1000){a.timerPrecedingString=gbResources.getString("gb_starts_at");if(a.showEarlyAccessTimer){a.timerPrecedingString=f?gbResources.getString("gb_starts_for_prime_at"):gbResources.getString("gb_starts_for_you_at")}else{if(e){a.timerPrecedingString=gbResources.getString("gb_starts_for_prime_at")}}a.timeOrDateString=Deal.formatDealTime(h,d)}else{a.alertTxt="green";a.timerPrecedingString=gbResources.getString("gb_starts_in");if(a.showEarlyAccessTimer){a.timerPrecedingString=f?gbResources.getString("gb_starts_for_prime_in"):gbResources.getString("gb_starts_for_you_in")}else{if(e){a.timerPrecedingString=gbResources.getString("gb_starts_for_prime_in")}}a.startsInTimer=Deal.HeroTimer(h,g.config.timerCssClassName,false,true);a.startsInTimer.viewElement=a.viewElement;a.startsInTimer.spanID=a.timerSpanID;g.timers.push(a.startsInTimer);a.timeOrDateString=a.startsInTimer.timeString}}}},setDealDisplayDetails:function(e,b){if(!e||!b||!b.data){return}var c={};c.showEndTime=true;c.showButton=true;c.showReviews=true;c.showMerchantName=true;c.showDiscount=true;if(e.dealType===Deal.dealTypes.COUPON){c.showEndTime=false}var d=gbResources.getFeature("bd-dealview-experiement");var a=gbResources.getFeature("ld-dealview-experiement");if(e.dealType===Deal.dealTypes.BD){if(d===true){c.showButton=false;c.showReviews=false;c.showMerchantName=false}else{if(d==="2"){c.showEndTime=false}else{if(d==="4"){c.showDiscount=false}}}}if(e.dealType===Deal.dealTypes.LD){if(a===true){c.showDiscount=false}else{if(a==="2"){c.showButton=false;c.showReviews=false;c.showMerchantName=false}else{if(a==="3"){c.showDiscount=false;c.showButton=false;c.showReviews=false;c.showMerchantName=false}}}}b.data.elementDetails=c}});if(window.Deal===undefined){window.Deal={}}if(Deal.viewComponentBuilder===undefined){Deal.viewComponentBuilder=new DealViewComponentBuilder()};
var DealDAO=Backbone.Model.extend({initialize:function(a){if(!a){throw new Error("Cannot create a DealDAO object with undefined dealID")}this.timeouts={startTimeout:null,endTimeout:null,endTimeoutDelayed:null,statusExpireTimeout:null,expireTimeout:null,pstatusExpire:null,pstatusExpiresSoon:null};this.checkingDealStatus=false;this.lastPstatusExpireState="";this.dealID=a;this.loading=true;this.customerID=null;this.expired=false;this.parentAsin=null;this.parentItems=null;this.claimed=false;this.dealType=null;this.itemType=null;this.dealState=Deal.stateToTemplateMap.Loading;this.msToCacheExpires=null;this.cacheExpiresDate=null;this.legacyDealID=null;this.discussionBoardURL=null;this.buyAsin=null;this.impressionAsin=null;this.offerListingID=null;this.detail={title:null,description:null,marketplaceID:null,imageAsin:null,score:null,secondaryImages:null,URL:null,buyBoxURL:null,displayPriority:null,isFeatured:null,marketingMessage:null,geoDisplayName:null,primeAccessType:null,isPrimeOnly:null,isPrimeEarly:null,primeAccessDurationInMs:null};this.pricingData={dealPriceHash:{isRange:null,max:{price:null,formattedPrice:null,currency:null},min:{price:null,formattedPrice:null,currency:null}},basisPriceHash:{isRange:null,max:{price:null,formattedPrice:null,currency:null},min:{price:null,formattedPrice:null,currency:null}}};this.percentOff={isRange:null,max:null,min:null};this.status={dealState:null,currentlyUnavailable:false,percentClaimed:null,percentSoldOut:null,lastUpdated:null,totalCouponsCount:null,msToStart:null,msToEnd:null,startDate:null,endDate:null,ended:null,msToCacheExpires:null,cacheExpiresDate:null,started:null,expired:null};this.isLimitedQuantity=null;this.teaser={teaserLine:null,teaserImage:null,teaserURL:null,teaserAsin:null};this.swfContents=null;this.fastTrackMessage=null;this.dealAsins=[];this.dealAsinsHash={};this.auxiliaryData={isPrimeEligible:null,breaksMAP:null,merchantDetails:{merchantID:null,merchantName:null},reviewData:{averageRating:null,totalReviews:null,reviewsURL:null}};this.purchaseStatusWarningThreshold=2*60*1000;if(window.gbResources.getFeature("notifier-waitlist")&&window.gbResources.getFeature("notifier-waitlist")!="C"){this.purchaseStatusWarningThreshold=parseInt(window.gbResources.getFeature("notifier-waitlist"),10)*60*1000}},validate:function(a){},setItemType:function(a){if(this.dealAsins&&this.dealAsins.length>1){this.itemType=Deal.itemTypes.MultiItem}else{if(this.dealAsins&&this.dealAsins.length===1){this.itemType=Deal.itemTypes.SingleItem}else{if(a){this.itemType=Deal.responseItemTypeToItemType[a]}else{this.itemType=Deal.itemTypes.ContentOnly}}}},calculateStateData:function(){this.dealState=Deal.stateToTemplateMap.Available;if(this.status.msToStart>0&&!this.status.started){this.dealState=Deal.stateToTemplateMap.Upcoming}else{if(Deal.checkIfDealExpired(this)){this.dealState=Deal.stateToTemplateMap.Expired}else{if(this.isDealSoldOut()){this.dealState=Deal.stateToTemplateMap.SoldOut}}}},calculateStatusData:function(d,b){if(!d){Deal.log("Cannot set Deal DAO status for undefined/null statusObj.");return}this.status.currentlyUnavailable=d.currentlyUnavailable;this.status.percentClaimed=d.percentClaimed;var a;if(this.dealAsins){a=this.dealAsins.length}var e=0;if(a){for(var c=0;c<a;c++){if(this.dealAsins[c].status.percentClaimed===100){e++}}}if(this.isDealSoldOut()){this.status.percentClaimed=100}this.status.percentSoldOut=d.percentSoldOut;this.status.totalCouponsCount=d.totalAvailable;this.status.msToCacheExpires=d.msToCacheExpires;this.status.msToStart=d.msToStart;this.status.msToEnd=d.msToEnd;this.status.cacheExpiresDate=new Date(b.getTime()+parseInt(this.status.msToCacheExpires,10));this.status.endDate=new Date(b.getTime()+parseInt(this.status.msToEnd,10));this.status.startDate=new Date(b.getTime()+parseInt(this.status.msToStart,10))},isDealSoldOut:function(){if(!this.dealAsinsHash){return false}for(var b in this.dealAsinsHash){var a=this.dealAsinsHash[b];if(!a.status.offerServiceSoldOut){if(a.status.percentSoldOut<100){return false}}}return true},calculatePriceData:function(c){var a=this;var b=Deal.Price.findMaxMinPrices(a,c);if(!Deal.Price.isEmptyPriceObject(b)){a.pricingData.basisPriceHash.max=b.maxBasisPrice;a.pricingData.basisPriceHash.min=b.minBasisPrice;if(!Deal.Price.maxEqualMin(a.pricingData.basisPriceHash)){a.pricingData.basisPriceHash.isRange=true}else{a.pricingData.basisPriceHash.isRange=false}a.pricingData.dealPriceHash.max=b.maxDealPrice;a.pricingData.dealPriceHash.min=b.minDealPrice;if(!Deal.Price.maxEqualMin(a.pricingData.dealPriceHash)){a.pricingData.dealPriceHash.isRange=true}else{a.pricingData.dealPriceHash.isRange=false}}if(c){if(c.maxPercentOff){a.percentOff.max=parseInt(c.maxPercentOff)}if(c.minPercentOff){a.percentOff.min=parseInt(c.minPercentOff)}if(a.percentOff.max===a.percentOff.min){a.percentOff.isRange=false}else{a.percentOff.isRange=true}}},calculateAuxiliaryDataFromItem:function(){var a=Deal.findBackBoneDealAsin(this);if(a){if(this.auxiliaryData.isPrimeEligible===null||this.auxiliaryData.isPrimeEligible===undefined){this.auxiliaryData.isPrimeEligible=a.auxiliaryData.isPrimeEligible}if(this.auxiliaryData.breaksMAP===null||this.auxiliaryData.breaksMAP===undefined){this.auxiliaryData.breaksMAP=a.auxiliaryData.breaksMAP}if(this.auxiliaryData.merchantDetails===null||this.auxiliaryData.merchantDetails===undefined){this.auxiliaryData.merchantDetails=a.auxiliaryData.merchantDetails}if(this.auxiliaryData.reviewData===null||this.auxiliaryData.reviewData===undefined){this.auxiliaryData.reviewData=a.auxiliaryData.reviewData}}}});
var DealAsinDAO=Backbone.Model.extend({initialize:function(a){if(a===undefined||!a){throw new Error("Cannot create a DealAsinDAO object with undefined asin")}Deal.log("Created DealAsinDAO instance for: "+a);this.ASIN=a;this.timeouts={};this.dealID=null;this.parentDealDAO=null;this.marketplaceID=null;this.dealPrice=null;this.dealPriceFormatted=null;this.basisPrice=null;this.basisPriceFormatted=null;this.basisKind=null;this.imageURL=null;this.isParent=false;this.totalAvailable=null;this.percentOffBasisPrice=null;this.percentOff=null;this.status={state:null,itemState:null,expiresDate:null,offerServiceSoldOut:null,currentlyUnavailable:null,percentClaimed:null,percentSoldOut:null,lastUpdated:null,msToExpiry:null,totalCouponsCount:null};this.isCustomerClaimed=false;this.waitListStatus={position:null,chance:null,timeToWait:null};this.variationData=null;this.offerListingID=null;this.auxiliaryData={isPrimeEligible:null,breaksMAP:null,merchantDetails:{merchantID:null,merchantName:null},reviewData:{averageRating:null,totalReviews:null,reviewsURL:null}};this.egressUrl=null;this.ingressUrl=null;this.isParentItem=null;this.isOneClickable=null;this.isTimeLimited=null;this.isWaitlistable=null;this.offerID=null;this.perCustomerAmount=null},validate:function(a){}});
var DealMetadata=Backbone.Model.extend({dealIdBuckets:{},dealIdAttributes:{},dealCategoryHash:{},isDigitalDeal:{},initialize:function(){},registerResponseData:function(b,d){if(b===undefined||b===null){Deal.log("Cannot registerResponseData for undefined/null widgetId in DealMetadata");return}if(d===undefined||d===null){Deal.log("Cannot registerResponseData for undefined/null responseParams in DealMetadata");return}var a=this;var c={whitelistedCategories:gbResources.getAllCategories(),excludedCategories:Deal.controller.excludedCategories[b],includedCategories:Deal.controller.enforcedCategories[b],disableCategoryFilters:Deal.controller.disableCategoryFilter[b],disableStatusFilters:Deal.controller.disableStatusFilter[b],disableDeduping:Deal.controller.disableDeduping[b],disablePagination:Deal.controller.disablePagination[b],disableAdaptive:Deal.controller.disableAdaptiveResize[b],prioritizeBuyboxDeal:Deal.controller.prioritizeBuyboxDeal[b],prioritizedDealIDs:Deal.controller.prioritizedDealIDs[b]};a.parseSortedDealList(b,d,c);a.registerDealIdAttributesMap(b,d,c);a.registerDealCategoryHashMap(d);a.populateIsDigitalDeals();a.registerDealIdBucketsMap(b,d)},parseSortedDealList:function(f,b,h){var j=this;if(h.prioritizedDealIDs.length){var i=_.intersection(h.prioritizedDealIDs,b.sortedDealList);if(i.length){b.sortedDealList=_.difference(b.sortedDealList,i);b.sortedDealList=_.union(i,b.sortedDealList)}}if(h.prioritizeBuyboxDeal&&Deal.controller.dealServiceClassName[f]==="DealContentService"){var m=Deal.controller.buyboxDealID;var e=_.indexOf(b.sortedDealList,m);if(e!==-1){b.sortedDealList.splice(e,1);b.sortedDealList.unshift(m)}}if(h.disablePagination&&h.disableAdaptive){if(b.selectDealsPageSize===null||b.selectDealsPageSize===undefined){return}if(h.disableDeduping){b.sortedDealList=b.sortedDealList.splice(0,b.selectDealsPageSize)}else{var g=[];for(var a=100;a<f;a++){if(!Deal.controller.disableDeduping[a]){g.push(a)}}var l=[];for(var d=0;l.length<b.selectDealsPageSize&&d<b.sortedDealList.length;d++){var c=b.sortedDealList[d];if(j.dealIdAttributes[c]===undefined||j.dealIdAttributes[c]===null){l.push(c)}else{if(_.intersection(g,j.dealIdAttributes[c].widgetIdList).length===0){l.push(c)}}}b.sortedDealList=l}}},registerDealIdAttributesMap:function(d,f,e){var b=this;for(var a=0;a<f.sortedDealList.length;a++){var c=f.sortedDealList[a];b.registerDealIdAttributes(c,d,f,e)}},registerDealCategoryHashMap:function(b){var a=this;_.each(b.dealCategoryHash,function(c,d){_.each(c,function(e){if(a.dealCategoryHash[e]===undefined||a.dealCategoryHash[e]===null){a.dealCategoryHash[e]=[]}if(_.indexOf(a.dealCategoryHash[e],d)===-1){a.dealCategoryHash[e].push(d)}})})},populateIsDigitalDeals:function(){var a=this;_.each(a.dealCategoryHash,function(b,c){a.isDigitalDeal[c]=Deal.hasDigitalCategory(b)})},registerDealIdAttributes:function(c,f,a,h){var i=this;if(i.dealIdAttributes[c]===undefined||i.dealIdAttributes[c]===null){i.initializeDealIdAttributes(c)}var e=i.dealIdAttributes[c].widgetIdList;if(!h.disableDeduping&&!(h.disablePagination&&h.disableAdaptiveResize)){var b=true;for(var d=0;d<i.dealIdAttributes[c].widgetIdList.length;d++){var g=i.dealIdAttributes[c].widgetIdList[d];if(g!==f&&!Deal.controller.disableDeduping[g]){b=false;break}}if(!b){Deal.log("Already registered metadata found for DealId-"+c);return}}i.registerDealWidgetId(c,f);i.registerDealStatusFilters(c,f,a.dealStateHash,h.disableStatusFilters);if(!h.disableCategoryFilters){i.registerDealCategories(c,f,h.whitelistedCategories,a.dealCategoryHash,h.excludedCategories,h.includedCategories);i.registerDealAccessTypes(c,f,a.dealAccessTypeHash)}},initializeDealIdAttributes:function(b){var a=this;a.dealIdAttributes[b]={widgetIdList:[],statusFilters:{},categoryFilters:{}}},registerDealWidgetId:function(c,b){var a=this;a.dealIdAttributes[c].widgetIdList.push(b);a.dealIdAttributes[c].statusFilters[b]=[];a.dealIdAttributes[c].categoryFilters[b]=[Deal.categoryFilters.ALL]},registerDealStatusFilters:function(d,c,b,f){var a=this;var h=[];if(typeof(b)==="string"){h=[b]}else{for(var e in b){if(_.contains(b[e],d)){if(f){h=[Deal.statusFilters.AVAILABLE]}else{var g=Deal.dealStates[e];if(g===Deal.dealStates.AVAILABLE||g===Deal.dealStates.WAITLIST||g===Deal.dealStates.WAITLISTAVAILABLE||g===Deal.dealStates.WAITLISTFULL){h=[Deal.statusFilters.AVAILABLE]}else{if(g===Deal.dealStates.UPCOMING){h=[Deal.statusFilters.AVAILABLE,Deal.statusFilters.UPCOMING]}else{if(g===Deal.dealStates.SOLDOUT||g===Deal.dealStates.EXPIRED){h=[Deal.statusFilters.MISSED]}}}}break}}}a.dealIdAttributes[d].statusFilters[c]=_.union(a.dealIdAttributes[d].statusFilters[c],h)},registerDealCategories:function(d,f,k,i,h,e){var j=this;for(var g=0;g<k.length;++g){var b=k[g].nodeId.toString();var c=_.contains(h,b);var a=e.length==0||_.contains(e,b);if(b!=="all"&&_.contains(i[b],d)&&a&&!c&&!_.contains(j.dealIdAttributes[d].categoryFilters[f],b)){j.dealIdAttributes[d].categoryFilters[f].push(b)}}},registerDealAccessTypes:function(b,a,c){if(gbResources.getFeature("prime-early-access")&&_.contains(c[Deal.primeAccessTypeEnum.PRIME_EARLY_ACCESS],b)&&!_.contains(this.dealIdAttributes[b].categoryFilters[a],Deal.primeAccessTypeEnum.PRIME_EARLY_ACCESS)){this.dealIdAttributes[b].categoryFilters[a].push(Deal.primeAccessTypeEnum.PRIME_EARLY_ACCESS)}},registerDealIdBucketsMap:function(g,h){var c=this;c.registerWidgetBucket(g,h);for(var b=0;b<h.sortedDealList.length;b++){var f=h.sortedDealList[b];var d=c.dealIdAttributes[f];var e=d.statusFilters[g];var a=d.categoryFilters[g];if(!_.contains(c.dealIdAttributes[f].widgetIdList,g)){Deal.log("Skipping Bucket registration for dealId:"+f+" called by widgetId:"+g)}else{c.addDealIdToDealIdBucket(f,g,e,a)}}},registerWidgetBucket:function(b,c){var a=this;if(a.dealIdBuckets[b]===null||a.dealIdBuckets[b]===undefined){a.dealIdBuckets[b]={}}if(typeof(c.dealStateHash)==="string"&&(a.dealIdBuckets[b][c.dealStateHash]===undefined||a.dealIdBuckets[b][c.dealStateHash]===null)){a.dealIdBuckets[b][c.dealStateHash]={}}else{if(c.dealStateHash!==undefined||c.dealStateHash!==null){if(a.dealIdBuckets[b][Deal.statusFilters.AVAILABLE]===undefined||a.dealIdBuckets[b][Deal.statusFilters.AVAILABLE]===null){a.dealIdBuckets[b][Deal.statusFilters.AVAILABLE]={}}if(a.dealIdBuckets[b][Deal.statusFilters.UPCOMING]===undefined||a.dealIdBuckets[b][Deal.statusFilters.UPCOMING]===null){a.dealIdBuckets[b][Deal.statusFilters.UPCOMING]={}}if(a.dealIdBuckets[b][Deal.statusFilters.MISSED]===undefined||a.dealIdBuckets[b][Deal.statusFilters.MISSED]===null){a.dealIdBuckets[b][Deal.statusFilters.MISSED]={}}}}},addDealIdToDealIdBucket:function(b,f,g,h){if(b===undefined||b===null){Deal.log("Cannot addDealIdToDealIdBucket for undefined/null dealId in DealMetadata");return}if(f===undefined||f===null){Deal.log("Cannot addDealIdToDealIdBucket for undefined/null widgetId in DealMetadata");return}if(g===undefined||g===null){Deal.log("Cannot addDealIdToDealIdBucket for undefined/null statusFilterList in DealMetadata");return}if(h===undefined||h===null){Deal.log("Cannot addDealIdToDealIdBucket for undefined/null categoryList in DealMetadata");return}var k=this;for(var e=0;e<g.length;e++){for(var c=0;c<h.length;c++){var d=g[e];var a=h[c];if(k.dealIdBuckets[f][d]===null||k.dealIdBuckets[f][d]===undefined){k.dealIdBuckets[f][d]={}}if(k.dealIdBuckets[f][d][a]===null||k.dealIdBuckets[f][d][a]===undefined){k.dealIdBuckets[f][d][a]=[b]}else{if(!_.contains(k.dealIdBuckets[f][d][a],b)){k.dealIdBuckets[f][d][a].push(b)}}}}},getDealIds:function(g,a,d,b,h){var i=this;var e=[];if(g===null||g===undefined){return e}if(a===null||a===undefined){return e}if(d===null||d===undefined){return e}if(i.dealIdBuckets[g]===null||i.dealIdBuckets[g]===undefined){return e}if(i.dealIdBuckets[g][a]===null||i.dealIdBuckets[g][a]===undefined){return e}if(i.dealIdBuckets[g][a][d]===null||i.dealIdBuckets[g][a][d]===undefined){return e}if((b===null||b===undefined)&&(h===null||h===undefined)){e=i.dealIdBuckets[g][a][d];return e}if(b&&h){e=i.dealIdBuckets[g][a][d];var c=(b-1)*h;var f=c+h;return e.slice(c,f)}return e},getMetadataCategories:function(c,d){var b=this;var a=[];if(c===null||c===undefined){return a}if(d===null||d===undefined){return a}if(b.dealIdBuckets[c]===null||b.dealIdBuckets[c]===undefined){return a}if(b.dealIdBuckets[c][d]===null||b.dealIdBuckets[c][d]===undefined){return a}return Deal.keys(b.dealIdBuckets[c][d])},checkIfDeals:function(f,g,e,b,a){var d=this;var c=d.getDealIds(f,g,e,b,a);if(c.length){return true}return false},checkIfStatusFilterSeen:function(b,c){var a=this;if(b===undefined||b===null){return false}if(c===undefined||c===null){return false}if(a.dealIdBuckets[b]===undefined||a.dealIdBuckets[b]===null){return false}if(a.dealIdBuckets[b][c]===undefined||a.dealIdBuckets[b][c]===null){return false}return true},getTotalDealsCount:function(c){var b=0;if(c===undefined||c===null){return b}if(this.dealIdBuckets[c]===undefined||this.dealIdBuckets[c]===null){return b}var d=0;var e=0;var f=this.dealIdBuckets[c][Deal.statusFilters.AVAILABLE];if(f&&f[Deal.categoryFilters.ALL]){d=f[Deal.categoryFilters.ALL].length}var a=this.dealIdBuckets[c][Deal.statusFilters.MISSED];if(a&&a[Deal.categoryFilters.ALL]){e=a[Deal.categoryFilters.ALL].length}b=d+e;return b}});
var ControllerBase=Backbone.Collection.extend({initialize:function(a){},registerWidget:function(a){},buy:function(a,c,b){},registerDealWithNotifier:function(c,b){var a=this;if(!window.dealNotifier&&gbResources.getFeature("notifier-waitlist")!="C"){a.loadLightningDealNotifier(c,b)}else{if(window.dealNotifier){dealNotifier.registerDeal(c,b)}}},loadLightningDealNotifier:function(d,e){var h=this;var g=function(j,l,k){gbResources.registerFromJSON(j.resourceData);window.dealNotifier=window.dealNotifier||new window.DealNotifier({thresholdOffset:parseInt(window.gbResources.features["notifier-waitlist"],10),sessionId:j.sessionID,now:j.now,popupSkin:j.popupSkin,debug:j.debug,waitlistedAsins:[]});dealNotifier.registerDeal(l,k)};var f=function(j,m,l){if(window.P&&window.P.AUI_BUILD_DATE){if(j.forceSyncLoad){for(var k=0;k<j.jsFiles.length;k++){gbResources.loadJS(j.jsFiles[k],a)}}else{for(var k=0;k<j.jsFiles.length;k++){P.load.js(j.jsFiles[k])}}P.when("A","load","lightningDealNotifier").execute(function(){_.defer(function(){g(j,m,l)})})}else{if(window.amznJQ&&typeof(amznJQ)==="object"){if(j.forceSyncLoad){for(var k=0;k<j.jsFiles.length;k++){gbResources.loadJS(j.jsFiles[k],a)}}else{amznJQ.addLogical("lightningDealNotifier",j.jsFiles)}window.onload(function(){amznJQ.onReady("jQuery",function(){amznJQ.onReady("lightningDealNotifier",function(){_.defer(function(){g(j,m,l)})})})}())}}};var b=gbResources.getParamValueFromUrl("dealsJS",window.location);var a=gbResources.getParamValueFromUrl("forceSyncLoad",window.location);var i=gbResources.getParamValueFromUrl("dnDebug",window.location);var c={success:function(j){if(!j){return}f(j,d,e)},url:"/gp/deal/ajax/getNotifierResources.html?onATC="+true+"&dealsJS="+b+"&forceSyncLoad="+a+"&dnDebug="+i,type:"POST",data:{},dataType:"json"};if(window.P&&window.P.AUI_BUILD_DATE){P.when("A").execute(function(j){j.$.ajax(c)})}else{amznJQ.onReady("jQuery",function(){jQuery.ajax(c)})}}});
var DealController=ControllerBase.extend({contentMetadata:{pageType:null,subPageType:null,originRef:null,originRID:null,deviceType:null,browseNode:null},amabotParams:{},anchorNameToWidgetIdPair:{},buyboxDealID:null,buying:{},cartPopover:null,cells:{},cellToDeal:{},connections:{},dealIDs:{},dealIdToCell:{},dealRedemptionServiceClient:null,deals:{},dealServiceClients:{},dealServiceInstance:{},dealsInCurrentView:{},dealsInNextView:{},filter:{},hasMetadata:{},listOfDeals:{},loadSwfWidget:{},enableFastTrackMessage:{},loginURI:null,metadata:null,nextWidgetID:null,order:{},page:{},pages:{},prefetchedDeals:{},previouslyDrawnFirstPage:{},status:{},varPopCloseFunction:{},widgetIdToWidgetGroupIdMap:{},widgetIdToWidgetNameMap:{},autoTitleDotd:{},autoTitleLd:{},customRestrictionsApply:{},customSeeMoreString:{},customSeeMoreURL:{},dealGroups:{},dealServiceClassName:{},dealStateFilter:{},dealTypeFilter:{},disableAdaptiveResize:{},disableCategoryFilter:{},disableDeduping:{},disablePagination:{},disableRestrictionsApply:{},disableStatusFilter:{},disableTruncation:{},displayCouponsCount:{},displayFeaturedDeals:{},enforcedCategories:{},enforcedDealIDs:{},enforcedMerchantIDs:{},excludedCategories:{},excludedDealIDs:{},excludedExtendedFilters:{},exclusiveTargetValues:{},expiringWithin:{},extendedFilters:{},forceObfuscatedResponse:{},fromTime:{},hidePercentOff:{},inclusiveTargetValues:{},inDiscussionBoard:{},maxJitter:{},noDealsMessage:{},rankingStrategy:{},retainFilters:{},primeAccessType:{},prioritizeBuyboxDeal:{},prioritizedDealIDs:{},showLocalTime:{},title:{},toTime:{},widgetAnchorName:{},widgetCount:{},widgetGroupName:{},initialize:function(a,c){if(a!==undefined&&a.length!==0){var b=this;b.loginURI=a.login_uri;b.contentMetadata.pageType=c.pageType;b.contentMetadata.subPageType=c.subPageType;b.contentMetadata.originRef=c.refTag;b.contentMetadata.originRID=c.originRID;b.contentMetadata.deviceType=c.deviceType;b.contentMetadata.browseNode=c.browseNode;b.nextWidgetID=Deal.constants.WIDGET_ID_START;b.dealServiceClients.DealContentService=new DealContentService();b.dealRedemptionServiceClient=new DealRedemptionService();Deal.watcher=new DealWatcher();Deal.widgetGroupManager=new WidgetGroupManager();b.metadata=new DealMetadata();jQuery(window).bind("scroll",function(){Deal.watcher.changeViewPort()});jQuery(window).unload(function(){Deal.watcher.callClickStream()})}else{Deal.log("Error: Cannot instantiate Controller with no Model/Config data");return}},registerWidget:function(c,d){if(!c){Deal.log("Cannot register undefined/null widgetID");return null}var b=this.nextWidgetID;this.registerSchedulingParameters(b,d);this.amabotParams[b]={};this.cells[b]=1;this.cellToDeal[b]={};this.dealIDs[b]=[];this.dealIdToCell[b]={};this.dealServiceInstance[b]=this.dealServiceClients[d.dealServiceClassName];this.dealsInCurrentView[b]=[];this.dealsInNextView[b]=[];this.filter[b]=null;this.listOfDeals[b]=[];this.order[b]=null;this.page[b]=1;this.pages[b]=1;this.previouslyDrawnFirstPage[b]=false;this.status[b]=null;this.varPopCloseFunction[b]=null;this.widgetIdToWidgetNameMap[b]=c;if(d.widgetGroupName!==undefined&&d.widgetGroupName!==null){this.widgetIdToWidgetGroupIdMap[b]=Deal.widgetGroupManager.registerWidget(b,widgetGroupName)}if(d.maxJitter){var a=parseInt(d.maxJitter,10);if(a&&a>Deal.constants.GET_DEALS_MAX_JITTER&&a>this.dealServiceClients.DealContentService.getDealsMaxJitter){this.maxJitter[b]=a;this.dealServiceClients.DealContentService.getDealsMaxJitter=this.maxJitter[b]}}Deal.connectionManager.registerWidgetConnections(b);this.nextWidgetID++;return b},registerSchedulingParameters:function(b,d){if(!b||!d){Deal.log("Cannot registerSchedulingParameters for undefined/null widgetID/params");return}var a=this;var c=["inclusiveTargetKeys","inclusiveTargetValues","exclusiveTargetKeys","exclusiveTargetValues"];_.each(d,function(e,f){if(!_.contains(c,f)){a[f][b]=e}});if(d.inclusiveTargetKeys&&d.inclusiveTargetValues){a.registerTargetValues("inclusive",b,d.inclusiveTargetKeys,d.inclusiveTargetValues)}if(d.exclusiveTargetKeys&&d.exclusiveTargetValues){a.registerTargetValues("exclusive",b,d.exclusiveTargetKeys,d.exclusiveTargetValues)}if(d.customSeeMoreURL){if(d.customSeeMoreURL.indexOf("#")===0){a.registerWidgetAnchorName(b,d.customSeeMoreURL.substr(1))}}if(d.widgetAnchorName){a.registerWidgetAnchorName(b,d.widgetAnchorName)}},getWidgetParams:function(b){if(!b){Deal.log("Cannot getWidgetParams for an undefined/null widgetID.");return{}}var a={dealGroups:this.dealGroups[b],dealStates:this.dealStateFilter[b],dealTypes:this.dealTypeFilter[b],excludedCategories:this.excludedCategories[b],excludedDealIDs:this.excludedDealIDs[b],excludedExtendedFilters:this.excludedExtendedFilters[b],exclusiveTargetValues:this.getTargetValues("exclusive",b),expiringWithin:this.expiringWithin[b],extendedFilters:this.extendedFilters[b],featuredOnly:this.displayFeaturedDeals[b],fromTime:this.fromTime[b],includedCategories:this.enforcedCategories[b],includedDealIDs:this.enforcedDealIDs[b],includedMerchantIDs:this.enforcedMerchantIDs[b],inclusiveTargetValues:this.getTargetValues("inclusive",b),toTime:this.toTime[b]};return a},registerWidgetAnchorName:function(c,a){var b=this.anchorNameToWidgetIdPair[a]||[];this.anchorNameToWidgetIdPair[a]=_.union(b,c)},getPairedWidgetIdByAnchorName:function(c,a){var d=null;if(this.anchorNameToWidgetIdPair[a]!==undefined){var b=this.anchorNameToWidgetIdPair[a];d=_.find(b,function(e){return e!==c})}return d},registerTargetValues:function(d,c,e,b){if(!c||!e||!b){Deal.log("Cannot register TargetValues for empty widgetID/TargetKey-Value.");return}if(d!=="inclusive"&&d!=="exclusive"){Deal.log("Cannot register TargetValues with unsupported type.");return}var a=this;a[d+"TargetValues"][c]={};_.each(e,function(g,f){a[d+"TargetValues"][c][g]=b[f]})},getTargetValues:function(b,a){if(!a){Deal.log("Cannot get TargetValues for undefined/null widgetID");return{}}if(b!=="inclusive"&&b!=="exclusive"){Deal.log("Cannot get TargetValues for unsupported type.");return{}}if(!this[b+"TargetValues"][a]){Deal.log("Cannot return inclusiveTargetValues for unregistered widgetID.");return{}}return this[b+"TargetValues"][a]},isWidgetAssociatedToWidgetGroup:function(a){var b=this.widgetIdToWidgetGroupIdMap[a];if(b!==null&&b!==undefined){return true}return false},getWidgetGroupId:function(a){var b=this.widgetIdToWidgetGroupIdMap[a];if(b!==null&&b!==undefined){return b}return -1},setPrefetchedDeals:function(b,a){if(!b){Deal.log("Cannot register prefetchedDeals for undefined/null widgetID");return}this.prefetchedDeals[b]=a},getPrefetchedDeals:function(a){if(!a){Deal.log("Cannot get prefetchedDeals for undefined/null widgetID");return null}return this.prefetchedDeals[a]},setLoadSwfWidget:function(a,b){if(!a){Deal.log("Cannot register loadSwfWidget for undefined/null widgetID");return}this.loadSwfWidget[a]=b},getLoadSwfWidget:function(a){if(!a){Deal.log("Cannot get loadSwfWidget for undefined/null widgetID");return null}return this.loadSwfWidget[a]},setEnableFastTrackMessage:function(a,b){if(!a){Deal.log("Cannot register enableFastTrackMessage for undefined/null widgetID");return}this.enableFastTrackMessage[a]=b},getEnableFastTrackMessage:function(a){if(!a){Deal.log("Cannot get enableFastTrackMessage for undefined/null widgetID");return null}return this.enableFastTrackMessage[a]},setBuyboxDeal:function(b,a){if(!b){Deal.log("Cannot register prefetchedDeals for undefined/null widgetID");return}if(this.buyboxDealID===undefined||this.buyboxDealID===null){if(this.dealServiceClassName[b]==="DealContentService"){this.buyboxDealID=a.dealID;if(!this.dealServiceInstance[b].dealsWithDetails[this.buyboxDealID]){this.dealServiceInstance[b].dealsWithDetails[this.buyboxDealID]=true;var c=this.getDeal(this.buyboxDealID);this.dealServiceInstance[b].translationHelper.populateFromGetDeals(c,a.dealDetails);this.dealServiceInstance[b].translationHelper.populateFromGetDealStatus(c,a.dealStatus)}}}},registerAmabotParams:function(a,b){if(!a||!b){Deal.log("Cannot registerAmabotParams for undefined/null widgetID/params");return}this.amabotParams[a]=b},getAmabotParams:function(a){if(!a){Deal.log("Cannot getAmabotparams for undefined/null widgetID");return{}}return this.amabotParams[a]||{}},getDeal:function(a){if(this.deals!==undefined){if(this.deals[a]===undefined){this.deals[a]=new DealDAO(a);Deal.log("DealController.getDeal: Created a new DealDAO obj for dealID: "+a);return this.deals[a]}else{return this.deals[a]}}return null},closeVarPopover:function(a){if(this.varPopCloseFunction[a]){this.varPopCloseFunction[a]()}},setVarPopCloseFunction:function(b,a){this.closeVarPopover(b);this.varPopCloseFunction[b]=a},_calculateDealIDs:function(b){var a=this.status[b];if(a){this.dealIDs[b]=this.metadata.getDealIds(b,a,this.filter[b])}this._calculatePages(b)},_calculatePages:function(a){this.pages[a]=Math.ceil(this.dealIDs[a].length/this.cells[a])},setStatus:function(e,a,c,g,d,f){this.status[e]=a;this.filter[e]=d;this.order[e]=g;if(this.dealServiceInstance[e]!==undefined){var b=this;this.dealServiceInstance[e].getDeals(b,e,a,c,g,d,f)}},setFilter:function(c,b){if(!c||!b){Deal.log("Cannot call setFilter for undefined/null widgetID/filter");return}var a=this.status[c];if(!a){Deal.log("Error: Invalid status: "+a);return}this.filter[c]=b;this._calculateDealIDs(c)},getFilterID:function(a){if(!a){Deal.log("Must supply a WidgetID in order to get the filter set for it.");return}return this.filter[a]},setOrdering:function(b,c){if(!b||!c){Deal.log("Cannot call setOrdering on undefined/null widgetID/ordering");return}var a=this.status[b];if(!a){Deal.log("Error: Invalid status: "+a);return}this.order[b]=c;if(this.filter[b]){this._calculateDealIDs(b)}},getWidgetsToLoadMetadata:function(g){var j=[];if(this.disableDeduping[g]){return j}var b=this.dealServiceClassName[g];for(var i=100;i<g;i++){if(this.dealServiceClassName[i]===b&&!this.hasMetadata[i]&&!this.disableDeduping[i]){var f=false;var c=this.dealTypeFilter[i];var h=this.dealTypeFilter[g];if(c===null||c===undefined){f=true}else{if(c.length===0){f=true}else{if(_.intersection(c,h).length){f=true}}}var e=false;var d=this.dealStateFilter[i];var a=this.dealStateFilter[g];if(d===null||d===undefined){e=true}else{if(d.length===0){e=true}else{if(_.intersection(d,a).length){e=true}}}if(f||e){j.push(i)}}}return j},setCells:function(b,a){if(a<1){Deal.log("Invalid number of cells: "+a+"; setting to 1");a=1}this.cells[b]=a;this._calculatePages(b)},prevPage:function(b,a){if(this.page[b]===1){if(a){this.setPage(b,this.pages[b])}else{Deal.log("Error: Already at first page.");return}}else{this.setPage(b,this.page[b]-1)}if(Deal.controller.retainFilters[b]){Deal.setURLFilters(b)}},nextPage:function(b,a){if(this.page[b]<this.pages[b]){this.setPage(b,this.page[b]+1)}else{if(a){this.setPage(b,1)}else{Deal.log("Error: Already at last page");return}}if(Deal.controller.retainFilters[b]){Deal.setURLFilters(b)}},setPageToShowDeal:function(c,b){if(!b){this.setPage(c,1);return}var a;for(a=0;a<this.dealIDs[c].length;a++){if(this.dealIDs[c][a]===b){break}}if(a===this.dealIDs[c].length){Deal.log("Couldn't find deal id"+b);this.setPage(c,1);return}this.setPage(Math.floor(a/this.cells[c])+1)},setPage:function(g,e){var h;var c;var b;var f;var j=this;if(g===undefined||g===null){Deal.log("Cannot setPage on undefined widgetID");return}e=e||1;Deal.connectionManager.disconnectCurrentPageSignals(this,g);if(this.pages[g]===0){for(h=0;h<this.cells[g];h++){this.trigger("cell_change"+g,{cell:h,deal:null})}this.trigger("page_change"+g,{page:0,pages:0,from:0,to:0,of:0});return}if(e<1||Math.floor(e)!=e){throw new Error("Invalid page: "+e)}if(e>this.pages[g]){Deal.log("page:"+e+" exceeds pages: "+this.pages[g]);e=this.pages[g]}this.page[g]=e;this.cellToDeal[g]=[];this.dealIdToCell[g]={};this.trigger("page_change"+g,{page:this.page[g],pages:this.pages[g],from:(this.page[g]-1)*this.cells[g]+1,to:Deal.min(this.page[g]*this.cells[g],this.dealIDs[g].length),of:this.dealIDs[g].length});var d=function(p){var m;var k;var o;for(k=0;k<p.length;k++){o=p[k];j.dealIdToCell[g][o.dealID]=k;j.dealsInCurrentView[g].push(o);j.cellToDeal[g][k]=o;Deal.connectionManager.connectDealChange(j,g,k,o);Deal.connectionManager.connectPstatusExpire(j,g,k,o);Deal.connectionManager.connectDealStatusExpire(j,g,o);j.trigger("cell_change"+g,{cell:k,deal:o});Deal.watcher.watchDeal(o,g)}for(k=0;k<j.cells[g];k++){m=(j.page[g]-1)*j.cells[g]+k;if(m>=j.dealIDs[g].length){j.cellToDeal[g][k]=null;j.trigger("cell_change"+g,{cell:k,deal:null})}}if(!j.disableAdaptiveResize[g]){var n=j.page[g]*j.cells[g];var l=(j.page[g]+1)*j.cells[g];for(m=n;m<l&&m<j.dealIDs[g].length;m++){o=j.getDeal(this.dealIDs[g][m]);Deal.connectionManager.connectDealStatusExpire(j,g,o);j.dealsInNextView[g].push(o);Deal.watcher.watchDeal(o,g)}}j.off("startCellChangeAndStatusConnectionWiring"+g)};this.on("startCellChangeAndStatusConnectionWiring"+g,d);this.dealServiceInstance[g].getDeals(j,g,j.status[g],j.cells[g],j.order[g],j.filter[g],e);if(this.page[g]===1&&!this.previouslyDrawnFirstPage[g]){this.previouslyDrawnFirstPage[g]=true;for(var a in this.page){if(a==g){continue}this.trigger("page_change"+a,{page:this.page[a],pages:this.pages[a],from:(this.page[a]-1)*this.cells[a]+1,to:Deal.min(this.page[a]*this.cells[a],this.dealIDs[a].length),of:this.dealIDs[a].length})}}Deal.watcher.recordPageChangeImpressions(g)},buy:function(k,g,f,a,i,j){var l=this;var h;var c=this.getPurchaseRefTag(k,g.dealID,i,j);if(k&&g&&j){if(Deal.shouldRecordClickAction(g.dealID)){if(j===Deal.purchaseTypes.ADD_TO_CART){Deal.watcher.recordClickEvent(k,g.dealID,Deal.clientActions.ADD_TO_CART)}else{if(j===Deal.purchaseTypes.JOIN_WAITLIST){Deal.watcher.recordClickEvent(k,g.dealID,Deal.clientActions.JOIN_WAITLIST)}}}}if(g&&g.dealType===Deal.dealTypes.LD&&(!this.dealServiceInstance[k].customer_id)){var d=this.loginURI;var e=g.dealID;if(!window.gbResources.getFeature("deal-redemption-service")){e=g.legacyDealID}var b=null;if(j===Deal.purchaseTypes.ADD_TO_CART){b="atc"}else{if(j===Deal.purchaseTypes.JOIN_WAITLIST){b="jwl"}}if(f&&b){Deal.logRedirectPurchaseAttributes(g,b,f)}d=d.replace(/%257BdealID%257D/,e);d=d.replace(/%257Basin%257D/,f);d=d.replace(/%257BmarketplaceID%257D/,l.dealServiceInstance[k].marketplace_id);d=d.replace(/%257Bcategory%257D/,l.filter[k]);window.location=d;return}if(!this.buying[g.dealID]){this.buying[g.dealID]=true;if(g.dealType===Deal.dealTypes.LD&&window.gbResources.getFeature("deal-redemption-service")){this.dealRedemptionServiceClient.claimDeal(g.dealID,f,c,function(m){delete l.buying[g.dealID];if(m){l.dealRedemptionServiceClient.translationHelper.translateClaimDealResponse(g,f,m);l.redemptionResponseHandler(g,f,k,a,m.currentCartQuantity)}g.trigger("change",g)},function(m){delete l.buying[g.dealID];g.trigger("change",g)})}else{this.dealServiceInstance[k].redeem_deal(g.dealID,f,function(m){delete l.buying[g.dealID];if(m&&m.redeemed===1){l.dealServiceInstance[k].translationHelper.populateFromGetDeals(g,m.deal);l.redemptionResponseHandler(g,f,k,a,m.currentCartQuantity)}g.trigger("change",g)},function(m){delete l.buying[g.dealID];g.trigger("change",g)},c,this.getAmabotParams(k),g)}}},redemptionResponseHandler:function(c,e,d,a,f){var h=this;var j=_.find(c.dealAsins,function(k){if(k.ASIN==e){return k}});var g=c.legacyDeal;var i=function(){if(g&&c.legacyDealID){g.legacyDealID=c.legacyDealID;h.registerDealWithNotifier(j.ASIN,g)}};var b=_.find(g.asins,function(k){if(k.asin===e){return k}});h.cartPopover=new Deal.LegacyCartPopover(g,b,a,b.status.purchaseStatus.state,d,g.dealID,i);h.closeVarPopover(d);if(window.navbar&&typeof window.navbar.setCartCount==="function"){window.navbar.setCartCount(parseInt(f,10))}},getPurchaseRefTag:function(e,d,a,b){if(!e||!d||!a||!b){Deal.log("Cannot fetch purchaseRefTag for undefined/null args");return""}if((a!=="dealView")&&(a!=="widgetView")){Deal.log("ViewType can only be either dealView or widgetView");return""}if(b!==Deal.purchaseTypes.ADD_TO_CART&&b!==Deal.purchaseTypes.JOIN_WAITLIST){Deal.log("PurchaseType can only be add to cart or join waitlist.");return""}var f=this.widgetIdToWidgetNameMap[e];var g="";try{g=Deal.configManager[f].metricsConfig[a].refTags[b];g+=Deal.getSlotRefTag(this.getAmabotParams(e));g+=Deal.getPlacementID(this.getAmabotParams(e));g+=d;return g}catch(c){Deal.log("ERROR in fetching purchaseRefTag: "+c);return g}},getWidgetByID:function(a){return _.find(Deal.Widgets,function(b){return b.widgetID===a})}});
var DealView=Backbone.View.extend({tagName:"div",className:"deal-view",initialize:function(e,c,b,a,d){this.config=null;this.isVariationView=false;this.el=null;this.template=null;this.templates={};this.data=null;this.config=b;this.refTags={};this.amabotParams=Deal.controller.getAmabotParams(c);this.widgetName=d;this.truncatedTemplateData=null;this.initializeTruncationConfigs();if(b.templates){this.config.templates=b.templates}if(b.metricsConfig&&b.metricsConfig.refTags){this.refTags=b.metricsConfig.refTags}this.elementID=a;this.widgetID=c;this.clickStreamRefMarker=(this.config.clickStreamRefMarker!==null)?this.config.clickStreamRefMarker:"gb_def";this.clientSideLatencyFeatureScope=b.latencyFeatureScope;this.el=jQuery("#"+a);this.detailURL=null;this.timers=[];this.on("change",this.cleanup);this.on("change",this.render)},initializeTruncationConfigs:function(){var a=function(b){if(!b){jQuery("a#dealDescriptionReadMore").css("display","none")}};this.truncatedTemplateData={title:{id:"#dealTitle",truncationAttributes:{wrap:"letter",height:((this.config&&this.config.maxTitleHeight!==undefined&&this.config.maxTitleHeight!==null)?parseInt(this.config.maxTitleHeight,10):32)}},teaser:{id:"#dealTeaser",truncationAttributes:{wrap:"letter",height:((this.config&&this.config.maxTeaserHeight!==undefined&&this.config.maxTeaserHeight!==null)?parseInt(this.config.maxTeaserHeight,10):48)}},description:{id:"#dealDescription",truncationAttributes:{height:((this.config&&this.config.maxDescHeight!==undefined&&this.config.maxDescHeight!==null)?parseInt(this.config.maxDescHeight,10):100),after:"a#dealDescriptionReadMore",callback:a}},merchantName:{id:"#dealMerchantName",truncationAttributes:{height:((this.config&&this.config.maxMerchantHeight!==undefined&&this.config.maxMerchantHeight!==null)?parseInt(this.config.maxMerchantHeight,10):14)}},geoLocation:{id:"#dealGeoDisplayName",truncationAttributes:{height:((this.config&&this.config.maxLocationHeight!==undefined&&this.config.maxLocationHeight!==null)?parseInt(this.config.maxLocationHeight,10):14)}}}},enableClickActionRecording:function(){var b=this;var e;if(b.config){var a=b.config.titleLinkClass||"titleLink";var c=b.config.imageLinkClass||"imageLink";var d=b.config.reviewsLinkClass||"reviewsLink";var f=b.config.commentsLinkClass||"commentsLink";this.el.find("."+a).click(function(){Deal.watcher.recordClickEvent(b.widgetID,b.deal.dealID,Deal.clientActions.TITLE)});this.el.find("."+c).click(function(){Deal.watcher.recordClickEvent(b.widgetID,b.deal.dealID,Deal.clientActions.IMAGE)});this.el.find("."+d).click(function(){Deal.watcher.recordClickEvent(b.widgetID,b.deal.dealID,Deal.clientActions.REVIEWS)});this.el.find("."+f).click(function(){Deal.watcher.recordClickEvent(b.widgetID,b.deal.dealID,Deal.clientActions.DISCUSSION_BOARD)})}},button:function(){if(this.purchaseState===Deal.dealStateEnum.WaitListFull){Deal.log("Waitlist full. Cannot attempt buy.");return}if(this.purchaseState===Deal.dealStateEnum.Claimed){Deal.log("Cannot attempt buy on a Claimed Deal!");return}if(this.deal&&this.widgetID&&(this.purchaseState===Deal.dealStateEnum.LearnMore||this.purchaseState===Deal.dealStateEnum.ViewDeal)&&Deal.shouldRecordClickAction(this.deal.dealID)){Deal.watcher.recordClickEvent(this.widgetID,this.deal.dealID,Deal.clientActions.LEARN_MORE);var a=(this.deal.dealType===Deal.dealTypes.LD)?"learnMorePEA":"learnMore";Deal.logRedirectPurchaseAttributes(deal,a)}if(this.purchaseState===Deal.dealStateEnum.LearnMore||this.purchaseState===Deal.dealStateEnum.ClipCoupon||this.purchaseState===Deal.dealStateEnum.ViewDeal){Deal.log("Redirecting to learn more link");if(this.detailURL){window.location=this.detailURL}return}if(this.isVariationView){Deal.log("Variation view, not attempting to buy.");return}if(this.deal&&this.widgetID&&this.ASIN){if(Deal.controller.buying[this.deal.dealID]){Deal.log("Already buying. Returning.");return}var b=Deal.Templates.generateTemplate(this.config.templates.checking_deal_status,{});this.el.find("#dealActionContent").html(b);if(this.config.hideStateContentOnClick){this.el.find("#dealStateContent").html("")}Deal.controller.buy(this.widgetID,this.deal,this.ASIN,false,"dealView",this.purchaseType)}else{Deal.log("ERROR: Buy button was clicked but Deal is unavailable.");return}},updatePurchaseState:function(a){var c=this.el.find("#dealStateContent");if(c!==undefined&&c!==null){c.html("")}if(Deal.checkIfDealExpired(a)&&this.purchaseState!==undefined&&this.purchaseState!==null&&this.purchaseState===Deal.dealStateEnum.PendingAddToCart){var b=this.el.find("#dealActionButton");if(b!==undefined&&b!==null){b.html("")}}a.trigger("change",a)},cleanup:function(){if(!this.timers){Deal.log("No timers to clean up. Returning.");return}for(var a=0;a<this.timers.length;a++){this.timers[a].disconnect()}this.timers=[]},render:function(c){if(c===undefined||!c){Deal.log("DealView.render: Null params specified");return}if(c.state===undefined||c.deal===undefined||!this.config||!c.state||!c.deal){Deal.log("DealView.render: Unknown state / Null deal object");this.el.html("");return}this.cleanup();this.detailURL=null;var a=c.state;if(this.deal!==null&&this.deal!==undefined&&this.deal.dealID!=c.deal.dealID){for(var l in this.truncatedTemplateData){var d=this.truncatedTemplateData[l];delete d.truncatedHtml}}this.deal=c.deal;if(this.deal.detail!==undefined&&this.deal.detail!==null&&this.deal.detail.URL){var b=gbResources.getCustomerData("customerId");var f=b?this.refTags.rec_learn_more:this.refTags.unrec_learn_more;if(this.deal.dealType===Deal.dealTypes.LD){this.detailURL=Deal.generateDetailPageUrl(this.deal)}else{this.detailURL=this.deal.detail.URL}if(this.deal.dealType==Deal.dealTypes.LOCAL){this.detailURL=Deal.generateRefTaggedExternalRedirectURL(this.detailURL,this.deal.dealID,f,this.amabotParams)}else{this.detailURL=Deal.ref_tag_appender(this.detailURL,this.deal.dealID,f,this.amabotParams)}}this.isVariationView=false;this.purchaseState=1;var e=c.deal;var m=this.config.templates.available;this.data={};this.data.viewElement=this.el;this.data.refTags=this.refTags;this.data.amabotParams=this.amabotParams;this.data.displayCouponsCount=this.config.displayCouponsCount;this.data.inDiscussionBoard=this.config.inDiscussionBoard;this.data.disableTruncation=this.config.disableTruncation;var k;if(this.config.enableAutoWidgetTitle){if(this.config.prioritizeBuyboxDeal&&this.deal.dealID===Deal.controller.buyboxDealID&&this.config.disablePagination&&Deal.controller.cells[this.widgetID]===1){k=gbResources.getString("csld_buybox_deal_message")}else{if(this.config.autoTitleDotd&&e.dealType===Deal.dealTypes.DOTD){k=gbResources.getString("deal-of-the-day-title")}else{if(this.config.autoTitleLd&&e.dealType===Deal.dealTypes.LD){k=gbResources.getString("lightning-deal-title")}else{k=this.config.widgetTitle}}}var g=jQuery(this.el).closest(this.config.contentCssSelector);g.find(this.config.titleCssSelector).html(k)}if(this.config.widgetAnchorName){var h=Deal.controller.metadata.getTotalDealsCount(this.widgetID);var i=(h>0);var j=jQuery('a[href="#'+this.config.widgetAnchorName+'"]');j.closest(".SeeMoreLink").toggle(i)}this.data.disablePagination=this.config.disablePagination;Deal.businessRulesManager.runBusinessRules(this,e);Deal.watcher.sendClientSideLatencyMetrics(this.widgetID,this.clientSideLatencyFeatureScope)},renderTemplate:function(b){if(b===undefined||!b){Deal.log("No template specified to render. Rendering loading template");var a=Deal.Templates.generateTemplate(this.config.templates.deal_loading,{});this.el.html(a);this.el.addClass("spinner");return}this.template=Deal.Templates.generateTemplate(b,this.data);this.el.html(this.template);this.truncateTemplateData();if(this.data.swfContents!==null&&this.data.swfContents!==undefined&&this.el.find("#gbShareFeature").length>0){this.el.find("#gbShareFeature").html(this.data.swfContents)}if(gbResources.getFeature("fasttrack-message")&&this.deal.dealType===Deal.dealTypes.DOTD&&this.deal.itemType===Deal.itemTypes.SingleItem&&this.data.fastTrackMessage!==null&&this.data.fastTrackMessage!==undefined&&this.el.find("#fastTrackMessage").length>0){this.el.find("#fastTrackMessage").html(this.data.fastTrackMessage)}if(window.P&&window.P.AUI_BUILD_DATE){var c=this.el.find("#prime-img"+this.deal.dealID);if(c.length>0){c[0].style.position="static"}}if(this.widgetID&&this.deal){if(Deal.shouldRecordClickAction(this.deal.dealID)){this.enableClickActionRecording()}}},truncateTemplateData:function(){if(this.data.noPriceBlock&&this.data.noMerchantDisplay){this.truncatedTemplateData.title.truncationAttributes.height=64}else{if(this.data.noPriceBlock||this.data.noMerchantDisplay){this.truncatedTemplateData.title.truncationAttributes.height=48}else{this.truncatedTemplateData.title.truncationAttributes.height=(this.config&&this.config.maxTitleHeight!==undefined&&this.config.maxTitleHeight!==null)?parseInt(this.config.maxTitleHeight,10):32}}for(var a in this.truncatedTemplateData){if(!((this.data.disableTruncation||this.data.inDiscussionBoard)&&(a==="title"||a==="description"))){var c=this.truncatedTemplateData[a];var b=this.el.find(c.id);if(b.length>0){if(c.truncatedHtml){b.html(c.truncatedHtml);b.css("word-wrap","break-word")}else{c.truncatedHtml=jQuery.trim(b.dotdotdot(c.truncationAttributes).html())}}}}},generateArrayOfTemplates:function(b){if(b===undefined||!b){Deal.log("No templates defined to generateArrayOfTemplates.");return}if(!this.data){this.data={}}this.data.generatedTemplates={};for(var a=0;a<b.length;a++){this.data.generatedTemplates[b[a]]=Deal.Templates.generateTemplate(Deal.configManager.getDealViewTemplate(this.widgetName,b[a]),this.data)}}});
var WidgetView=Backbone.View.extend({events:{},initialize:function(c,d,a,b){this.processSchedulingParameters(c);if(d!==undefined&&d!==null){this.widgetID=Deal.controller.registerWidget(d,this.schedulingParameters)}this.defaultInitialize(c,d,a,b)},processSchedulingParameters:function(b,d){var a=this;var c={autoTitleDotd:false,autoTitleLd:false,customRestrictionsApply:null,customSeeMoreString:null,customSeeMoreURL:null,dealServiceClassName:"DealService",dealStateFilter:[],dealTypeFilter:[],disableAdaptiveResize:false,disableCategoryFilter:false,disableDeduping:false,disablePagination:false,disableRestrictionsApply:false,disableStatusFilter:false,disableTruncation:false,displayCouponsCount:false,displayFeaturedDeals:false,enforcedCategories:[],enforcedDealIDs:[],enforcedMerchantIDs:[],excludedCategories:[],excludedDealIDs:[],exclusiveTargetKeys:null,exclusiveTargetValues:null,forceObfuscatedResponse:false,hidePercentOff:false,inclusiveTargetKeys:null,inclusiveTargetValues:null,inDiscussionBoard:false,noDealsMessage:gbResources.getString("csld-no_deals"),prioritizeBuyboxDeal:false,prioritizedDealIDs:[],rankingStrategy:null,showLocalTime:false,title:"",widgetAnchorName:null,widgetCount:null,widgetGroupName:null};if(d===null||d===undefined){d={}}_.each(d,function(e,f){if(e!==null&&e!==undefined){c[f]=e}});a.schedulingParameters=c;if(b.dealViewConfig===null||b.dealViewConfig===undefined){b.dealViewConfig={}}if(b.widgetViewConfig===null||b.widgetViewConfig===undefined){b.widgetViewConfig={}}_.each(a.schedulingParameters,function(e,f){a[f]=e;b.dealViewConfig[f]=e;b.widgetViewConfig[f]=e})},defaultInitialize:function(b,e,d,i){if(!b){throw new Error("Config is undefined.")}if(!b.templates){throw new Error("No templates defined.")}if(!b.dealViewConfig){throw new Error("No dealViewConfig is defiend.")}if(!b.actionConfig){throw new Error("No action config is defined.")}if(!b.abTestingConfig){throw new Error("No AB Testing config is defined.")}this.widgetName=e||"HERO";this.clientSideLatencyFeatureScope=d;this.currentStatusFilter=Deal.statusFilters.AVAILABLE;this.currentStatusFilterID="#"+Deal.statusFilters.AVAILABLE+"_filter";this.tagName="div";this.versionInfo="";this.template=null;this.generatedTemplate=null;this.dealViews={};this.triggered={};this.templates=b.templates;this.dealViewConfig={};for(var g in b.dealViewConfig){this.dealViewConfig[g]=b.dealViewConfig[g]}if(b.widgetViewConfig){this.dealViewConfig.clickStreamRefMarker=b.widgetViewConfig.clickStreamRefMarker;this.dealViewConfig.enableAutoWidgetTitle=b.widgetViewConfig.enableAutoWidgetTitle;this.dealViewConfig.titleCssSelector=b.widgetViewConfig.titleCssSelector;this.dealViewConfig.contentCssSelector=b.widgetViewConfig.contentCssSelector}this.dealViewConfig.widgetTitle=this.title;this.actionConfig=b.actionConfig;this.abTestingConfig=b.abTestingConfig;this.widgetViewConfig=b.widgetViewConfig;this.metricsConfig={};if(b.metricsConfig){this.metricsConfig=b.metricsConfig.widgetView;this.dealViewConfig.metricsConfig=b.metricsConfig.dealView}this.dealViewConfig.latencyFeatureScope=d;Deal.ConfigBootStrapper.registerFeatureScope(this.dealViewConfig,d);this.refTags={};if(this.metricsConfig){this.refTags=this.metricsConfig.refTags}this.config=b;this.template=b.templates.skin;this.pageNumberTemplate=b.templates.page_number;this.widgetLoadingTemplate=b.templates.widget_loading;this.noDealsMessageTemplate=b.templates.no_deals_message;this.categoriesTemplate=b.templates.categories;Deal.log("WidgetView.initialize:  Registered widget: "+this.widgetID);Deal.connectionManager.connectSignal(Deal.controller,"page_change",this.widgetID,"pageChange",this);Deal.connectionManager.connectSignal(Deal.controller,"metadata_change",this.widgetID,"metadataChange",this);Deal.log("WidgetView.initialize:  Connecting cell_change signal for widget: "+this.widgetID);Deal.connectionManager.connectSignal(Deal.controller,"cell_change",this.widgetID,"cellChange",this);Deal.log("WidgetView.initialize:  Connecting pstatus_expire signal for widget: "+this.widgetID);Deal.connectionManager.connectSignal(Deal.controller,"pstatus_expire",this.widgetID,"purchaseStatusExpire",this);if(i!==undefined&&i!==null){this.el=jQuery("#"+i);this.elementID=i}else{this.el=jQuery(this.config.el)}this.amabotDomID=i+"-amabot";this.amabotParams=Deal.stripRecordClickParams(this.amabotDomID);Deal.controller.registerAmabotParams(this.widgetID,this.amabotParams);this.setMinWidth();this.clientWidth=this.el.width();this.cellWidth=b.dealViewConfig.cellWidth;this.bufferPadding=b.dealViewConfig.bufferPadding;if(!this.cellWidth){Deal.log("No cell width specified in dealViewConfig. Defaulting to 230");this.cellWidth=230}if(!this.bufferPadding){Deal.log("No button width specified. Defaulting to zero.");this.bufferPadding=0}var j=this.calculateCells();Deal.controller.setCells(this.widgetID,j);this.myDealView=DealView;if(this.actionConfig&&this.actionConfig.dealActionConfig){this.myDealView=DealView.extend(this.actionConfig.dealActionConfig)}this.showLoading(this.schedulingParameters);if(Deal.controller.retainFilters[this.widgetID]){var f=Deal.getURLFilters(this.widgetID);var h=parseInt(f.p,10);if(!h){h=1}var a=f.c;if(!a){a=Deal.categoryFilters.ALL}var c=f.s;if(!c){c=Deal.statusFilters.AVAILABLE}this.currentStatusFilter=c;this.currentStatusFilterID="#"+c+"_filter";Deal.controller.setStatus(this.widgetID,c,j,"start",a,h)}else{Deal.controller.setStatus(this.widgetID,Deal.statusFilters.AVAILABLE,j,"start",Deal.categoryFilters.ALL,1)}},setMinWidth:function(){this.el.css("min-width","1000px");if(jQuery.browser.msie){this.el.css("min-width","62.6em")}},evenlySpaceCells:function(b){if(b===undefined||b===null){Deal.log("Cannot evenly space cells for undefined/null cells");return}if(!this.clientWidth||!this.bufferPadding||!this.cellWidth){Deal.log("Cannot space out cells as clientWidth/bufferPadding/cellWidth are undefined/null");return}if(Deal.controller.dealIDs!==undefined&&Deal.controller.dealIDs!==null&&Deal.controller.dealIDs[this.widgetID]!==undefined&&Deal.controller.dealIDs[this.widgetID]!==null&&Deal.controller.dealIDs[this.widgetID].length>0){if(b>=Deal.controller.dealIDs[this.widgetID].length){return}}try{var f=this.clientWidth-(b*this.cellWidth)-this.bufferPadding;var e=Math.floor(f/(b-1));e+="px";var d="";for(var c=1;c<b;c++){d="#"+this.widgetID+"_dealView"+c;this.el.find(d).css({"margin-left":e})}}catch(a){Deal.log("Error caught in evenlySpacingOutCells in WidgetView.");return}},resize:function(a){this.defaultResize(a)},defaultResize:function(c){var b=this.el.width();if(b===this.clientWidth){if(!c){return}}else{this.clientWidth=b}var a=this.calculateCells();this.updateViewTemplate(a);if(!Deal.controller.metadata.checkIfDeals(this.widgetID,this.currentStatusFilter,Deal.controller.filter[this.widgetID])){this.showNoDealsMessage(this.schedulingParameters)}this.redrawDealViews(a);Deal.controller.setCells(this.widgetID,a);this.evenlySpaceCells(a);Deal.controller.setPage(this.widgetID,Deal.controller.page[this.widgetID]);jQuery(".gbwshoveler-content ul li").delegate("#dealHoverContent","mouseenter",function(){jQuery(this).find(".hoversm").fadeIn("fast")});jQuery(".gbwshoveler-content ul li").delegate("#dealHoverContent","mouseleave",function(){jQuery(this).find(".hoversm").fadeOut("fast")});this.bindCategoryButton();this.updateFilterCSS()},currentNotchPosition:function(){if(this.currentStatusFilter===undefined||!this.currentStatusFilter){Deal.log("CurrentStatus Filter is set to undefined/null.");return"0px"}var c="#"+Deal.statusFilters.AVAILABLE+"_filter";var f="#"+Deal.statusFilters.UPCOMING+"_filter";var e="#"+Deal.statusFilters.MISSED+"_filter";var d=null;var a=this.el.find(c);var b="-105px";if(this.currentStatusFilter===Deal.statusFilters.UPCOMING){d=this.el.find(c);a=this.el.find(f)}else{if(this.currentStatusFilter===Deal.statusFilters.MISSED){d=this.el.find(f);a=this.el.find(e)}}if(d!==null&&a!==null){b=a.position().left+a.width()/2-d.width()/2-105-5;b+="px"}this.currentNotchLocation=b;return b},metadataChange:function(c){var a=this;var b=function(){a.resize()};jQuery(window).resize(b);a.resize(true)},cellChange:function(c){if(c===undefined||!c){Deal.log("WidgetView.cellChange: Null params");return}var b="empty";if(c.deal===undefined||!c.deal){Deal.log("WidgetView.cellChange: Null deal object");b="empty"}else{b="available"}var a=this.widgetID+"_dealView"+c.cell;if(this.dealViews[a]!==undefined){Deal.log("WidgetView.cellChange:  Triggering change signal for dealView: "+a);this.dealViews[a].trigger("change",{state:b,deal:c.deal})}},purchaseStatusExpire:function(b){if(b===undefined||!b){Deal.log("WidgetView.cellChange: Null params.");return}if(b.deal===undefined||!b.deal){Deal.log("WidgetView.purchaseStatusExpire: Null deal object.");return}if(b.cell===undefined||b.cell===null){Deal.log("WidgetView.purchaseStatusExpire: Null/undefined cell");return}var a=this.widgetID+"_dealView"+b.cell;if(this.dealViews[a]!==undefined){this.dealViews[a].updatePurchaseState(b.deal)}},calculateCells:function(){if(this.config){if(this.config.widgetViewConfig){if(this.widgetViewConfig.dealsPerPage!==undefined&&this.widgetViewConfig.dealsPerPage!==null){return parseInt(this.widgetViewConfig.dealsPerPage,10)}}}if(!this.clientWidth||!this.bufferPadding||!this.cellWidth){Deal.log("Cannot calculate cells for null clientWidth/bufferPadding/cellWidth");return 0}try{var b=Math.floor((this.clientWidth-this.bufferPadding)/this.cellWidth);return b}catch(a){Deal.log("Error caught in calculating number of cells in WidgetView.");return 0}},showLoading:function(b){var a={};if(b!==undefined&&b!==null){jQuery.extend(true,a,b)}a.showLoadingTemplate=true;a.title=this.title;a.widget_loading=Deal.Templates.generateTemplate(this.widgetLoadingTemplate,{});this.updateViewTemplate(0,a)},setTitle:function(){this.el.find(".gbWidgetTitle").html(this.title)},showNoDealsMessage:function(b){var a={};if(b!==undefined&&b!==null){jQuery.extend(true,a,b)}a.showNoDealsMessage=true;if(this.currentStatusFilter===Deal.statusFilters.AVAILABLE||this.currentStatusFilter===Deal.statusFilters.UPCOMING){a.noDealsMessage=this.noDealsMessage}if(this.currentStatusFilter==Deal.statusFilters.MISSED){a.noDealsMessage=gbResources.getString("csld-no_deals")}a.title=this.title;a.no_deals_message=Deal.Templates.generateTemplate(this.noDealsMessageTemplate,a);this.updateViewTemplate(0,a);this.updateFilterCSS();this.pageChange({from:0,to:0,of:0,page:0,pages:0});this.setTitle();if(this.clientSideLatencyFeatureScope!==undefined&&this.clientSideLatencyFeatureScope!==null){Deal.watcher.sendClientSideLatencyMetrics(this.widgetID,this.clientSideLatencyFeatureScope)}},updateViewTemplate:function(c,e){if(c===undefined||c===null){Deal.log("Not updatingViewTemplate as the number of cells is undefined/null");return}var d={};if(e!==undefined&&e!==null){jQuery.extend(true,d,e)}d.numberOfCells=c;d.widgetID=this.widgetID;if(this.currentNotchLocation!==undefined&&this.currentNotchLocation!==null){d.notchStyle="left: "+this.currentNotchLocation}var a=Deal.controller.getFilterID(this.widgetID);if(!a){a=Deal.categoryFilters.ALL}d.filterName=gbResources.nodeIdToCategoryMap[a];this.generatedTemplate=Deal.Templates.generateTemplate(this.template,d);this.el.html(this.generatedTemplate);var b=this;var f="#"+Deal.statusFilters.AVAILABLE+"_filter";var h="#"+Deal.statusFilters.UPCOMING+"_filter";var g="#"+Deal.statusFilters.MISSED+"_filter";this.el.find(f).click(function(){b.statusFilterChange(Deal.statusFilters.AVAILABLE)});this.el.find(h).click(function(){b.statusFilterChange(Deal.statusFilters.UPCOMING)});this.el.find(g).click(function(){b.statusFilterChange(Deal.statusFilters.MISSED)});this.el.find("#leftShovel").click(function(){b.leftShovel()});this.el.find("#rightShovel").click(function(){b.rightShovel()})},redrawDealViews:function(a){if(!this.myDealView||!this.config||!this.dealViewConfig||!this.widgetID){Deal.log("Cannot redrawDealViews for null view/config/widgetID");return}this.cleanUpDealViews();this.dealViews={};for(var b=0;b<a;b++){var c=this.widgetID+"_dealView"+b;if(this.dealViews[c]===undefined){this.dealViews[c]=new this.myDealView({el:jQuery("#"+c)},this.widgetID,this.dealViewConfig,c,this.widgetName)}}},cleanUpDealViews:function(){var a=this;for(var b in this.dealViews){this.dealViews[b].cleanup()}},pageChange:function(a){this.defaultPageChange(a)},defaultPageChange:function(c){if(c===undefined||!c){Deal.log("Null data for page change.");return}var b=c;b.currentPage=c.page;b.totalPages=c.pages;if(b.totalPages===0){b.totalPages=1}if(b.currentPage===0){b.currentPage=1}if(c.customRestrictionsApply){b.restrictionsApplyURL=Deal.ref_tag_appender(c.customRestrictionsApply,"",this.refTags.restrictionsApply,this.amabotParams)}else{b.restrictionsApplyURL=Deal.ref_tag_appender(gbResources.getString("csld-help_link"),"",this.refTags.restrictionsApply,this.amabotParams)+gbResources.getString("csld-restrictions_anchor_link")}b.forceHideSeeMoreURL=true;if(c.customSeeMoreURL){if(c.customSeeMoreURL.indexOf("#")===0){b.seeMoreURL=c.customSeeMoreURL;var a=Deal.controller.getPairedWidgetIdByAnchorName(this.widgetID,c.customSeeMoreURL.substr(1));var d=Deal.controller.metadata.getTotalDealsCount(a);if(d){b.forceHideSeeMoreURL=false}}else{b.seeMoreURL=Deal.ref_tag_appender(c.customSeeMoreURL,"",this.refTags.seeMoreURL,this.amabotParams);b.forceHideSeeMoreURL=false}}else{b.seeMoreURL=null}var e=Deal.Templates.generateTemplate(this.pageNumberTemplate,b);this.el.find("#dealPaginationContent").html(e);this.enableOrDisableButtons(b.totalPages)},enableOrDisableButtons:function(d){var b=this.el.find("#leftShovelBg");var c=this.el.find("#rightShovelBg");var a=this.el.find("#leftShovelTxt");var e=this.el.find("#rightShovelTxt");if(d==1){b.removeClass("bg-image").addClass("bg-image-disabled");c.removeClass("bg-image").addClass("bg-image-disabled");a.addClass("bg-text-disabled");e.addClass("bg-text-disabled")}else{b.removeClass("bg-image-disabled").addClass("bg-image");c.removeClass("bg-image-disabled").addClass("bg-image");a.removeClass("bg-text-disabled");e.removeClass("bg-text-disabled")}},leftShovel:function(){Deal.log("WidgetView.leftShovel: left shovel was clicked");Deal.controller.prevPage(this.widgetID,true)},rightShovel:function(){Deal.log("WidgetView.rightShovel: Right shovel was clicked");Deal.controller.nextPage(this.widgetID,true)},statusFilterChange:function(a){if(a===undefined||a===null){Deal.log("WARN: Cannot change status for undefined/null fitler.");return}if(a!==Deal.statusFilters.AVAILABLE&&a!==Deal.statusFilters.UPCOMING&&a!==Deal.statusFilters.MISSED){Deal.log("ERROR: Cannot call statusChange on unknown status type.");return}this.el.find(this.currentStatusFilterID).removeClass("selected");this.currentStatusFilter=a;this.currentStatusFilterID="#"+a+"_filter";if(Deal.controller.metadata.checkIfStatusFilterSeen(this.widgetID,a)){Deal.controller.status[this.widgetID]=a;Deal.controller.setOrdering(this.widgetID,"start");Deal.controller.setFilter(this.widgetID,Deal.controller.filter[this.widgetID]);Deal.controller.setCells(this.widgetID,this.calculateCells());Deal.controller.setPage(this.widgetID,1);if(!Deal.controller.metadata.checkIfDeals(this.widgetID,this.currentStatusFilter,Deal.controller.filter[this.widgetID])){if(Deal.controller.filter[this.widgetID]!=Deal.categoryFilters.ALL&&Deal.controller.metadata.checkIfDeals(this.widgetID,this.currentStatusFilter,Deal.categoryFilters.ALL)){this.showNoFilterDealsMessage(this.schedulingParameters)}else{this.showNoDealsMessage(this.schedulingParameters)}}else{this.resize(true)}}else{this.showLoading(this.schedulingParameters);Deal.controller.setStatus(this.widgetID,a,this.calculateCells(),"start",Deal.categoryFilters.ALL,1);Deal.controller.setPage(this.widgetID,1)}this.updateFilterCSS();if(Deal.controller.retainFilters[this.widgetID]){Deal.setURLFilters(this.widgetID)}},showNoFilterDealsMessage:function(b){var a={};if(b!==undefined&&b!==null){jQuery.extend(true,a,b)}a.showNoDealsMessage=true;a.noDealsMessage=gbResources.getString("csld-no_filter_deals");a.title=this.title;a.no_deals_message=Deal.Templates.generateTemplate(this.noDealsMessageTemplate,a);this.el.find(".gbwshoveler-content").html(a.no_deals_message);this.el.find("#gbwcategories").removeAmazonPopoverTrigger();this.bindCategoryButton()},updateFilterCSS:function(){this.el.find(this.currentStatusFilterID).addClass("selected");this.el.find(".gbwnotch").animate({left:this.currentNotchPosition()},400)},bindCategoryButton:function(){var a=this;var d=null;var e=0;var b=this.el.find("#gbwcategories");d=this.getDisplayableCategories();if(d){if(d.length){e=parseInt((d.length-1)/15,10)+1;e=(e>3)?3:e}}if(!e||!d){return Deal.log("ERROR: No columnCount/displayableCategories specified to drawCategoryOptions.")}var f={};f.widgetID=this.widgetID;f.categories=d;f.columnCount=e;var c=Deal.Templates.generateTemplate(this.categoriesTemplate,f);if(window.P&&window.P.AUI_BUILD_DATE){P.when("A","a-popover","ready").execute(function(h,i){var j="DealCategoryPopover"+(+new Date());var g=b.find("#dealsCategories");h.$(b).click(function(l){var k=i.create(g,{content:"<div class='inAuiPopover'>"+c+"</div>",position:"triggerBottom",width:e*160+40,closeButton:false,name:j});l.preventDefault()});g.trigger("click");h.on("a:popover:show:"+j,function(l){var k=l.popover;k.$container.find(".a-popover-inner").css("padding","0px")})})}else{if(window.amznJQ){amznJQ.available("popover",function(){Deal.controller.popover=jQuery(b).amazonPopoverTrigger({showOnHover:true,skin:"",width:e*160+90,showCloseButton:true,location:["bottom"],literalContent:"<div>"+c+"</div>"})})}}},getDisplayableCategories:function(){var d=[];var b=gbResources.getAllCategories();var a=Deal.controller.metadata.getMetadataCategories(this.widgetID,this.currentStatusFilter);for(var c=0;c<b.length;c++){if(_.contains(a,b[c].nodeId.toString())){d.push(b[c])}}return d},render:function(){},getDealViewByDealID:function(a){return _.find(this.dealViews,function(b){return b.deal.dealID===a})}});
var OneHero=WidgetView.extend({initialize:function(e,g,b,c,h,f,a){var d=this;d.processSchedulingParameters(e,h);if(g!==undefined&&g!==null){d.widgetID=Deal.controller.registerWidget(g,d.schedulingParameters)}if(f!==undefined&&f!==null){Deal.controller.setPrefetchedDeals(d.widgetID,f)}if(a!==undefined&&a!==null){Deal.controller.setBuyboxDeal(d.widgetID,a)}d.processWidgetTitle(e);d.defaultInitialize(e,g,b,c);if(d.widgetViewConfig.loadSwfWidget!==undefined&&d.widgetViewConfig.loadSwfWidget!==null){Deal.controller.setLoadSwfWidget(d.widgetID,d.widgetViewConfig.loadSwfWidget)}if(d.widgetViewConfig.enableFastTrackMessage!==undefined&&d.widgetViewConfig.enableFastTrackMessage!==null){Deal.controller.setEnableFastTrackMessage(d.widgetID,d.widgetViewConfig.enableFastTrackMessage)}d.showLoading(d.schedulingParameters);d.setMinWidth();d.resize(true);if(d.widgetViewConfig.postLoadResize){jQuery(document).ready(function(){var i=d.el.width();if(i!==d.clientWidth){d.resize(true)}})}},processWidgetTitle:function(a){if(a===undefined||a===null){Deal.log("config not defined while calling OneHero::processWidgetTitle");return}var b=null;if(Deal.controller.buyboxDealID!==null&&Deal.controller.buyboxDealID!==undefined){if(this.prioritizeBuyboxDeal&&this.dealServiceClassName=="DealContentService"){if(this.disablePagination&&Deal.controller.cells[this.widgetID]===1){b=gbResources.getString("csld_buybox_deal_message")}}}if(b){this.title=b;a.dealViewConfig.title=b;a.widgetViewConfig.title=b;Deal.controller.title[this.widgetID]=b}},setMinWidth:function(){if(this.disableStatusFilter){this.changeMinWidth(215)}else{this.changeMinWidth(320)}},pageChange:function(b){var a={};if(b!==null&&b!==undefined){jQuery.extend(true,a,b)}jQuery.extend(true,a,this.schedulingParameters);this.defaultPageChange(a)},resize:function(a){if(!this.disableAdaptiveResize||(a!==undefined&&a)){this.adaptiveResize(a)}this.applySchedulingParameters()},applySchedulingParameters:function(){if(this.disableAdaptiveResize){this.changeMinWidth(this.clientWidth);if(jQuery.browser.msie===true){this.el.width(this.clientWidth)}}},adaptiveResize:function(c){var b=this.el.width();if(b===this.clientWidth){Deal.watcher.changeViewPort();if(c===undefined||!c){return}}else{this.clientWidth=b}if(this.checkIfDataLoading()){this.showLoading(this.schedulingParameters);return}var a=this.calculateCells();this.updateViewTemplate(a,this.schedulingParameters);if(!Deal.controller.metadata.checkIfDeals(this.widgetID,this.currentStatusFilter,Deal.controller.filter[this.widgetID])){this.showNoDealsMessage(this.schedulingParameters)}this.redrawDealViews(a);Deal.controller.setCells(this.widgetID,a);this.evenlySpaceCells(a);Deal.controller.setPage(this.widgetID,Deal.controller.page[this.widgetID]);jQuery(".gbwshoveler-content ul li").delegate("#dealHoverContent","mouseenter",function(){jQuery(this).find(".hoversm").fadeIn("fast")});jQuery(".gbwshoveler-content ul li").delegate("#dealHoverContent","mouseleave",function(){jQuery(this).find(".hoversm").fadeOut("fast")});this.bindCategoryButton();this.updateFilterCSS();if(this.calculateCells()<3){this.hideFilterOptions()}else{this.showFilterOptions()}this.applySchedulingParameters()},evenlySpaceCells:function(c){if(c===undefined||c===null){Deal.log("Cannot evenly space cells for undefined/null cells");return}if(!this.clientWidth||!this.bufferPadding||!this.cellWidth){Deal.log("Cannot space out cells as clientWidth/bufferPadding/cellWidth are undefined/null");return}if(Deal.controller.dealIDs!==undefined&&Deal.controller.dealIDs!==null&&Deal.controller.dealIDs[this.widgetID]!==undefined&&Deal.controller.dealIDs[this.widgetID]!==null&&Deal.controller.dealIDs[this.widgetID].length>0){if(c>=Deal.controller.dealIDs[this.widgetID].length&&this.clientWidth>300){return}}if(this.widgetViewConfig.disableEvenlySpacedCells){return}try{var h=this.clientWidth-(c*this.cellWidth)-this.bufferPadding;var f=Math.floor(h/(c));var g=f;f+="px";var a=0;if((c===1)||(g==h/(c))){a=1}var e="";for(var d=0;d<c;d++){e="#"+this.widgetID+"_dealView"+d;this.el.find(e).css({"margin-left":f})}if(a){if(c===1){f=(g-1)/2+"px"}else{f=g-1+"px"}this.el.find(e).css({"margin-left":f})}}catch(b){Deal.log("Error caught in evenlySpacingOutCells in WidgetView.");return}},hideFilterOptions:function(){this.el.find(".filtersl").css("display","none");this.el.find(".gbwnotch").css("display","none")},showFilterOptions:function(){if(!this.disableStatusFilter){this.el.find(".filtersl").css("display","block");this.el.find(".gbwnotch").css("display","block")}},changeMinWidth:function(b){if(b===undefined||b===null){return}var a=Math.round(b);this.el.css("min-width",b+"px")},checkIfDataLoading:function(){if(Deal.controller.metadata.checkIfStatusFilterSeen(this.widgetID,this.currentStatusFilter)){return false}return true},isInViewPort:function(e,b){var c=jQuery("#"+this.elementID).position().top;var a=c+parseInt(this.widgetViewConfig.impressionTop,10);var d=c+parseInt(this.widgetViewConfig.impressionBottom,10);if(a<b&&a>e&&d<b&&d>e){return true}return false}});
if(typeof(amznJQ)==='object'){amznJQ.declareAvailable('deals_one_hero_js');}if(typeof(P)==='object'){window.gbRegistered=window.gbRegistered||{};if(!window.gbRegistered.deals_one_hero_js){window.gbRegistered.deals_one_hero_js=true;P.register('deals_one_hero_js');}}